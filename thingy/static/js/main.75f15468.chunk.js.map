{"version":3,"sources":["3rdparty/litegraph.js","app.jsx","index.jsx"],"names":["global","LiteGraph","VERSION","CANVAS_GRID_SIZE","NODE_TITLE_HEIGHT","NODE_TITLE_TEXT_Y","NODE_SLOT_HEIGHT","NODE_WIDGET_HEIGHT","NODE_WIDTH","NODE_MIN_WIDTH","NODE_COLLAPSED_RADIUS","NODE_COLLAPSED_WIDTH","NODE_TITLE_COLOR","NODE_TEXT_SIZE","NODE_TEXT_COLOR","NODE_SUBTEXT_SIZE","NODE_DEFAULT_COLOR","NODE_DEFAULT_BGCOLOR","NODE_DEFAULT_BOXCOLOR","NODE_DEFAULT_SHAPE","DEFAULT_SHADOW_COLOR","DEFAULT_GROUP_FONT","WIDGET_BGCOLOR","WIDGET_OUTLINE_COLOR","WIDGET_TEXT_COLOR","WIDGET_SECONDARY_TEXT_COLOR","LINK_COLOR","EVENT_LINK_COLOR","CONNECTING_LINK_COLOR","MAX_NUMBER_OF_NODES","DEFAULT_POSITION","VALID_SHAPES","BOX_SHAPE","ROUND_SHAPE","CIRCLE_SHAPE","CARD_SHAPE","ARROW_SHAPE","INPUT","OUTPUT","EVENT","ACTION","ALWAYS","ON_EVENT","NEVER","ON_TRIGGER","UP","DOWN","LEFT","RIGHT","CENTER","STRAIGHT_LINK","LINEAR_LINK","SPLINE_LINK","NORMAL_TITLE","NO_TITLE","TRANSPARENT_TITLE","AUTOHIDE_TITLE","proxy","node_images_path","debug","catch_exceptions","throw_errors","allow_scripts","registered_node_types","node_types_by_file_extension","Nodes","searchbox_extras","registerNodeType","type","base_class","prototype","console","log","categories","split","classname","name","pos","lastIndexOf","category","substr","title","length","i","LGraphNode","Object","hasOwnProperty","defineProperty","set","v","this","_shape","get","enumerable","prev","constructor","onNodeTypeRegistered","onNodeTypeReplaced","onPropertyChange","warn","supported_extensions","toLowerCase","wrapFunctionAsNode","func","param_types","return_type","properties","params","Array","code","names","getParameterNames","JSON","stringify","classobj","Function","pop","desc","onExecute","getInputData","r","apply","setOutputData","addNodeMethod","createNode","options","node","err","error","properties_info","flags","size","computeSize","concat","mode","getNodeType","getNodeTypesInCategory","filter","push","getNodeTypesCategories","skip_list","result","reloadNodes","folder_wildcard","tmp","document","getElementsByTagName","script_files","docHeadObj","location","href","src","dynamicScript","createElement","appendChild","removeChild","cloneObject","obj","target","parse","isValidConnection","type_a","type_b","String","indexOf","supported_types_a","supported_types_b","j","registerSearchboxExtra","node_type","description","data","LGraph","o","list_of_graphcanvas","clear","configure","LLink","id","origin_id","origin_slot","target_id","target_slot","_data","_pos","Float32Array","_ctor","LGraphGroup","DragAndScale","element","skip_events","offset","scale","max_scale","min_scale","onredraw","enabled","last_mouse","visible_area","bindEvents","LGraphCanvas","canvas","graph","background_image","querySelector","ds","zoom_modify_alpha","title_text_font","inner_text_font","node_title_color","default_link_color","default_connection_color","input_off","input_on","output_off","output_on","highquality_render","use_gradients","editor_alpha","pause_rendering","clear_background","read_only","render_only_selected","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","allow_reconnect_links","drag_mode","dragging_rectangle","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_curved_connections","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip","links_render_mode","canvas_mouse","onSearchBox","onSearchBoxSelection","onMouse","onDrawBackground","onDrawForeground","onDrawOverlay","onDrawLinkTooltip","onNodeMoved","onSelectionChange","connections_width","round_radius","current_node","node_widget","over_link_center","last_mouse_position","visible_links","attachCanvas","setCanvas","skip_render","startRendering","autoresize","performance","getTime","now","bind","Date","process","t","hrtime","supported_types","getSupportedTypes","STATUS_STOPPED","STATUS_RUNNING","stop","status","last_node_id","last_link_id","_version","_nodes","onRemoved","_nodes_by_id","_nodes_in_order","_nodes_executable","_groups","links","iteration","config","vars","globaltime","runningtime","fixedtime","fixedtime_lapse","elapsed_time","last_update_time","starttime","catch_errors","inputs","outputs","change","sendActionToCanvas","graphcanvas","detachCanvas","splice","start","interval","onPlayEvent","sendEventToAllNodes","that","window","requestAnimationFrame","execution_timer_id","on_frame","runStep","setInterval","onStopEvent","clearInterval","num","do_not_catch_errors","limit","nodes","onExecuteStep","onAfterExecute","errors_in_execution","elapsed","execution_time","updateExecutionOrder","computeExecutionOrder","only_onExecute","set_level","L","S","M","visited_links","remaining_links","l","l2","link","_level","shift","output","link_id","target_node","getNodeById","order","sort","A","B","Ap","priority","Bp","getAncestors","ancestors","pending","visited","current","input","getInputNode","a","b","arrange","margin","columns","col","x","column","max_size","y","setDirtyCanvas","getFixedTime","getElapsedTime","eventname","Subgraph","undefined","action","c","add","skip_compute_order","onAdded","align_to_grid","alignToGrid","onNodeAdded","remove","index","ignore_remove","slot","disconnectInput","disconnectOutput","selected_nodes","node_dragged","onNodeRemoved","findNodesByClass","classObject","findNodesByType","findNodeByTitle","findNodesByTitle","getNodeOnPos","nodes_list","n","isPointInside","getGroupOnPos","g","checkNodeTypes","ctor","newnode","serialize","onAction","param","_input_nodes","GraphInput","trigger","onTrigger","addInput","value","onInputAdded","onInputsOutputsChange","setInputData","renameInput","old_name","onInputRenamed","changeInputType","onInputTypeChanged","removeInput","onInputRemoved","addOutput","onOutputAdded","getOutputData","renameOutput","onOutputRenamed","changeOutputType","onOutputTypeChanged","removeOutput","onOutputRemoved","triggerInput","setCallback","setTrigger","connectionChange","link_info","onConnectionChange","isLive","clearTriggeredSlots","_last_time","on_change","fg","bg","removeLink","nodes_info","link2","groups_info","groups","version","keep_old","link_data","n_info","last_serialization","has_errors","group","load","url","req","XMLHttpRequest","open","send","onload","oEvent","response","onerror","onNodeTrace","msg","color","connections","info","k","onPropertyChanged","onConnectionsChange","widgets","w","property","widgets_values","onConfigure","serialize_widgets","bgcolor","boxcolor","shape","onSerialize","clone","toString","getTitle","setProperty","prev_value","output_info","setOutputDataType","force_update","updateOutputData","getInputDataType","getInputDataByName","slot_name","findInputSlot","isInputConnected","clearInput","getInputInfo","getInputNodeByName","getInputLinkByName","getInputOrProperty","input_info","getOutputInfo","isOutputConnected","isAnyOutputConnected","getOutputNodes","_last_trigger_time","triggerSlot","target_connection","clearTriggeredSlot","addProperty","default_value","extra_info","addOutputs","array","addInputs","removeInputByName","removeOutputByName","addConnection","direction","minHeight","out","rows","Math","max","font_size","slot_start_y","widgets_height","widgets_up","widgets_start_y","title_width","compute_text_size","input_width","output_width","text_width","label","text","onResize","min_height","addWidget","callback","values","addCustomWidget","custom_widget","getBounding","onBounding","skip_title","margin_top","collapsed","isInsideRectangle","_collapsed_width","getSlotInPosition","link_pos","getConnectionPos","findOutputSlot","connect","Number","onConnectInput","onNodeConnectionChange","is_input","slot_number","num_slots","horizontal","round","trace","MAX_CONSOLE","dirty_foreground","dirty_background","loadImage","img","Image","ready","captureInput","list","node_capturing_input","collapse","force","collapsable","pin","pinned","localToScreen","node_colors","pale_blue","groupcolor","_bounding","subarray","_size","bounding","font","move","deltax","deltay","ignore_nodes","recomputeInsideNodes","node_bounding","overlapBounding","_binded_mouse_callback","addEventListener","computeVisibleArea","width","height","startx","starty","endx","endy","e","rect","getBoundingClientRect","clientX","left","clientY","top","canvasx","canvasy","dragging","ignore","onmouse","removeEventListener","body","mouseDrag","eventType","wheel","deltaY","wheelDeltaY","detail","delta","wheelDelta","changeDeltaScale","preventDefault","stopPropagation","toCanvasContext","ctx","translate","convertOffsetToCanvas","convertCanvasToOffset","changeScale","zooming_center","center","abs","new_center","delta_offset","reset","link_type_colors","number","gradients","frame","last_draw_time","render_time","fps","selected_group","visible_nodes","node_over","connecting_node","highlighted_links","dirty_canvas","dirty_bgcanvas","dirty_area","node_in_panel","last_mouseclick","onClear","setGraph","skip_clear","setDirty","openSubgraph","_graph_stack","closeSubgraph","subgraph_node","_subgraph_node","centerOnNode","selectNodes","getCurrentGraph","getElementById","unbindEvents","className","tabindex","bgcanvas","getContext","localName","webgl_enabled","enableWebGL","_mousemove_callback","processMouseMove","_mouseup_callback","processMouseUp","_doNothing","_doReturnTrue","_events_binded","getCanvasWindow","_mousedown_callback","processMouseDown","_mousewheel_callback","processMouseWheel","touchHandler","_key_callback","processKey","_ondrop_callback","processDrop","getFileExtension","question","point","GL","enableWebGLCanvas","gl","webgl","bgctx","fgcanvas","doc","ownerDocument","defaultView","parentWindow","is_rendering","renderFrame","draw","call","stopRendering","adjustMouseEvent","ref_window","active_canvas","canvasX","canvasY","skip_action","is_double_click","focus","closeAllContextMenus","which","ctrlKey","clicking_canvas_bg","bringToFront","resizable","resizing_node","style","cursor","connecting_output","connecting_pos","connecting_slot","shiftKey","onOutputDblClick","onOutputClick","onInputDblClick","onInputClick","block_drag_node","widget","processNodeWidgets","onDblClick","processNodeDblClicked","onMouseDown","processNodeSelected","showLinkMenu","selected_group_resizing","distance","showSearchBox","dragging_canvas","processContextMenu","localX","localY","last_mouse_dragging","activeElement","nodeName","resize","mouse","mouseOver","onMouseLeave","onMouseEnter","onMouseMove","_highlight_input","isOverNodeBox","isOverNodeInput","slot_type","over_link","click_time","diffx","diffy","deselectAllNodes","h","to_select","onMouseUp","title_height","slot_pos","block_default","keyCode","metaKey","copyToClipboard","pasteFromClipboard","deleteSelectedNodes","onKeyDown","onKeyUp","stopImmediatePropagation","clipboard_info","selected_nodes_array","_relative_id","cloned","localStorage","setItem","getItem","node_data","origin_node","onDropItem","event","checkDropItem","onDropFile","onDropData","files","dataTransfer","file","filename","reader","FileReader","readAsText","readAsDataURL","readAsArrayBuffer","ext","nodetype","onShowNodePanel","onNodeDblClicked","selectNode","onNodeSelected","add_to_current_selection","is_selected","onSelected","deselectNode","onDeselected","onNodeDeselected","input_link","output_link","input_node","output_node","deltaX","setZoom","convertEventToCanvasOffset","sendToBack","unshift","temp","computeVisibleNodes","force_canvas","force_bgcanvas","drawBackCanvas","drawFrontCanvas","start2D","restore","setTransform","save","beginPath","clip","clearRect","drawImage","onRender","renderInfo","drawNode","drawExecutionOrder","links_ontop","drawConnections","lineWidth","link_color","renderLink","dir","arc","PI","fill","fillStyle","strokeStyle","strokeRect","drawLinkTooltip","visible_rect","finish2D","fillText","toFixed","textAlign","bg_already_painted","onRenderBackground","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","imageSmoothingEnabled","globalAlpha","_bg_img","pattern","_pattern","createPattern","_pattern_img","fillRect","drawGroups","onBackgroundRender","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","finish","temp_vec2","low_quality","onDrawCollapsed","min","measureText","clip_area","roundRect","drawNodeShape","render_text","out_slot","max_y","input_slot","output_slot","moveTo","lineTo","closePath","color_on","color_off","stroke","widgets_y","drawNodeWidgets","Boolean","toToolTip","tmp_area","fgcolor","selected","mouse_over","title_mode","render_title","area","old_alpha","onDrawTitleBar","title_color","grad","createLinearGradient","addColorStop","onDrawTitleBox","box_size","onDrawTitleText","title_text_color","measure","onDrawTitle","margin_area","link_bounding","tempA","tempB","sqrt","A_end_x","A_end_y","B_end_x","B_end_y","ContextMenu","parentMenu","lock","current_submenu","MouseEvent","CustomEvent","PointerEvent","root","on_mouse_wheel","parseInt","scroll_speed","minWidth","pointerEvents","setTimeout","button","close","innerHTML","content","addItem","closing_timer","clearTimeout","root_document","fullscreenElement","body_rect","root_rect","transform","CurveEditor","points","nearest","must_update","start_node","start_node_slot","start_node_slotpos","end_node_slotpos","start_slot","end_slot","start_dir","end_dir","f","skip_border","flow","num_sublines","dist","lineJoin","offsety","start_offset_x","start_offset_y","end_offset_x","end_offset_y","bezierCurveTo","start_x","start_y","end_x","end_y","computeConnectionPoint","posA","posB","posC","posD","angleA","angleB","atan2","rotate","p0","p1","p2","p3","c1","c2","c3","c4","posY","active_widget","H","show_text","outline_color","background_color","text_color","secondary_text_color","last_y","disabled","clicked","on","off","range","nvalue","marker","marker_nvalue","precision","clamp","inner_value_change","old_value","step","option","prompt","DEFAULT_GROUP_FONT_SIZE","adjustNodesSize","parent","parentNode","offsetWidth","offsetHeight","switchLiveMode","transition","self","onNodeSelectionChange","first","changedTouches","simulatedEvent","createEvent","initMouseEvent","screenX","screenY","dispatchEvent","onGroupAdd","entry","mouse_event","onMenuAdd","prev_menu","entries","has_submenu","menu","node_types","inner_create","first_event","getFirstEvent","onMenuCollapseAll","onMenuNodeEdit","showMenuNodeOptionalInputs","optional_inputs","onGetInputs","onMenuNodeInputs","showMenuNodeOptionalOutputs","optional_outputs","onGetOutputs","skip_repeated_outputs","onMenuNodeOutputs","inner_clicked","onShowMenuNodeProperties","decodeHTML","showEditPropertyValue","position","allow_html","str","innerText","onResizeNode","node_left","node_right","onShowPropertyEditor","item","dialog","inner","offsetx","setValue","modified","prompt_box","search_limit","search_box","overflow","timeout_close","helper","timeout","changeSelection","refreshHelper","select","extra","json","forward","classList","nextSibling","previousSibling","childNodes","scrollIntoView","block","behavior","addResult","inner_test_filter","filtered","keys","help","dataset","escape","unescape","layerY","maxHeight","getPropertyInfo","input_html","createDialog","checked","_graph","html","onMenuNodeCollapse","onMenuNodePin","onMenuNodeMode","onMenuNodeColors","onMenuNodeShapes","onMenuNodeRemove","removable","onMenuNodeClone","clonable","red","brown","green","blue","cyan","purple","yellow","black","getCanvasMenuOptions","getMenuOptions","getExtraMenuOptions","getNodeMenuOptions","onGetNodeMenuOptions","getGroupMenuOptions","menu_info","slot_info","active_node","_slot","locked","nameLocked","submenu","CanvasRenderingContext2D","radius","radius_low","quadraticCurveTo","compareObjects","colorToString","growBounding","isInsideBounding","p","bb","hex2num","hex","charAt","slice","toUpperCase","int1","int2","num2hex","triplet","inner_onclick","close_parent","ignore_item_callbacks","autoopen","onclick_callback","ignore_parent_menu","isCursorOverElement","event_name","origin","evt","initCustomEvent","srcElement","__events","getTopMenu","elements","querySelectorAll","extendClass","__lookupGetter__","__defineGetter__","__lookupSetter__","__defineSetter__","sampleCurve","pn","local_f","line_color","inactive","localpos","max_dist","getCloserPoint","s","curvepos","_nearest","is_edge_point","min_dist","closest","vec2","replace","webkitRequestAnimationFrame","mozRequestAnimationFrame","exports","LG","require","isSetsEqual","every","has","assert","condition","Error","global_state","init_litegraph","litegraph","_on_reset_table","on_select","on_deselect","litegraph_canvas","_after_table","_onselect_table","exec_after","cmd_type","fn","exec_on_select","onselect","ondeselect","exec_selected","exec_deselected","exec","cmd","src_name","srcs","viewport","on_reset","exec_reset","reload","get_src","_scr_change_table","on_src_change","set_src","forEach","draw_triangle","vsSource","fsSource","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","useProgram","triangleArray","createVertexArray","bindVertexArray","positions","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","vertexAttribPointer","FLOAT","enableVertexAttribArray","colors","colorBuffer","disable","CULL_FACE","frontFace","CW","DEPTH_TEST","SCISSOR_TEST","depthFunc","LEQUAL","BLEND","blendFunc","ONE","drawArrays","TRIANGLES","deleteBuffer","deleteShader","deleteProgram","render_texture","tex","format","flipy","pipeline","vs","ps","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","uniform1i","getUniformLocation","deleteVertexArray","get_texture_data","targetTextureWidth","floor","targetTextureHeight","targetTexture","createTexture","internalFormat","RGBA","UNSIGNED_BYTE","texImage2D","LINEAR","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","drawBuffers","clearColor","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","Uint8Array","readPixels","deleteFramebuffer","deleteTexture","Uint8ClampedArray","ImageData","_dirty_set","Set","_dirty_deferred_set","set_dirty","is_recursive","update","set_to_check","new_set","sorted_list","backlog","loop_counter","has_dirty_input","input_id","delete","notify","periodic_update","toposort","sorted","sorted_set","unsorted_set","unsorted","is_ready","frame_count","sorted_nodes","gl_init","gl_render","from","reverse","gl_release","update_thumbnails","graph_list","LoadGraphButton","props","context","setShow","vis","setState","visible","handleClose","handleShow","handleApply","on_submit","myInput","state","Button","variant","onClick","Modal","show","onHide","Header","closeButton","Title","Footer","DropdownButton","map","Dropdown","Item","key","fetch","then","React","Component","gltf_loader","GLTFLoader","MyLGraphNode","subscribe","subscribers","unsubscribe","clean_inputs","clean_outputs","set_inputs","new_outputs","last_attributes","attr","set_outputs","FrameCountNode","get_value","Mesh","init","attributes","indices","init_gltf","mesh","BufferGeometryUtils","computeTangents","geometry","attr_name","raw_attr","normalized","itemSize","pbr_material","material","images","field","image","get_attrib_data","get_index_data","ModelNode","traverse","meshes","children","child","get_meshes","display","propnode","canvas1","canvas2","div","cssText","controls","camera","scene","alpha","renderer","THREE","render","datgui","domElement","setSize","pmremGenerator","compileEquirectangularShader","RGBELoader","setDataType","setPath","texture","envMap","fromEquirectangular","background","environment","dispose","gltf","setPixelRatio","outputEncoding","boundingBox","setFromObject","getSize","maxDim","z","fov","cameraZ","tan","minZ","cameraToFarEdge","OrbitControls","minDistance","maxDistance","aspect","far","updateProjectionMatrix","fileurl","prop","val","yoffset","GLComponent","exec_graph","getExtension","alert","glcanvas","BackBufferNode","in_node","get_texture","displayWidth","clientWidth","displayHeight","clientHeight","BACK","thumbnail","image_data","tmp_canvas","tmp_canvasContext","putImageData","toDataURL","border","PipelineNode","set_vs","set_ps","is_valid","valid","get_uniform_location","vs_source","ps_source","depthMask","enable","get_attrib_location","getAttribLocation","src_list","datgui_state","select_vs","select_ps","onChange","parse_shaders","get_info","uniforms","uniform_set","glslang","parse_attributes","attrib","uniform","VertexBufferNode","folder","addFolder","buf","parse_src","TextureBufferNode","get_buffer","loc","RGBA32F","UNSIGNED_INT","RGBA32UI","RGBA_INTEGER","Uint32Array","DrawCallNode","update_inputs","sat","pipeline_info","default_uniforms","to_remove","uni_name","mesh_input","arrays","buffers","arr","out_attrib","gl_buffer","comps","draw_size","indexBuffer","ELEMENT_ARRAY_BUFFER","Uint16Array","index_type","UNSIGNED_SHORT","new_rt","add_vec","strs","uni","gl_draw","tu_cnt","getParameter","VIEWPORT","uniform2fv","tu","drawElements","c_type","flag","FeedbackNode","texStorage2D","RGBA8","clone_texture","PassNode","clear_outputs","dc_cnt","update_outputs","rts","depth","push_rt","rt_params","pop_rt","add_depth","d_params","remove_depth","set_width","set_height","draw_buffers","gen_texture","DEPTH_ATTACHMENT","checkFramebufferStatus","DRAW_FRAMEBUFFER","FRAMEBUFFER_COMPLETE","srcTexture","rt","DEPTH_COMPONENT16","DEPTH_COMPONENT32F","clearDepth","thumbnails","depth_thumbnail","vfbs","tmp_rt_state","tmp_d_state","clear_gui","display_node","rt_state","new_d","vp","addDC","local_pos","GraphNodeComponent","dumpJson","_selected_nodes","new_selected","new_deselected","glContainer","postMessage","textArea","padding","outline","boxShadow","execCommand","copyTextToClipboard","CreateSrc","FormControl","placeholder","TextEditorComponent","rebuildGui","dat","autoPlace","select_src","selected_src","remove_src","edit_src","customContainer","lastElementChild","refs","editor","setOptions","fontSize","setAutoScrollEditorIntoView","getSession","tabSize","useSoftTabs","navigateWithinSoftTabs","add_src","newValue","ref","theme","editorProps","$blockScrolling","enableBasicAutocompletion","enableLiveAutocompletion","autoScrollEditorIntoView","wrapEnabled","PropertiesNode","selected_node","deselected_node","GoldenLayoutWrapper","globals","isClosable","component","layout","GoldenLayout","registerComponent","ReactDOM","updateSize"],"mappings":"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","file":"static/js/main.75f15468.chunk.js","sourcesContent":["/* eslint-disable */\n// https://github.com/jagenjo/litegraph.js\n/*\nCopyright (C) 2013 by Javi Agenjo\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n(function(global) {\n  // *************************************************************\n  //   LiteGraph CLASS                                     *******\n  // *************************************************************\n\n  /**\n   * The Global Scope. It contains all the registered node classes.\n   *\n   * @class LiteGraph\n   * @constructor\n   */\n\n  var LiteGraph = (global.LiteGraph = {\n      VERSION: 0.4,\n\n      CANVAS_GRID_SIZE: 10,\n\n      NODE_TITLE_HEIGHT: 30,\n      NODE_TITLE_TEXT_Y: 20,\n      NODE_SLOT_HEIGHT: 20,\n      NODE_WIDGET_HEIGHT: 20,\n      NODE_WIDTH: 140,\n      NODE_MIN_WIDTH: 50,\n      NODE_COLLAPSED_RADIUS: 10,\n      NODE_COLLAPSED_WIDTH: 80,\n      NODE_TITLE_COLOR: \"#999\",\n      NODE_TEXT_SIZE: 14,\n      NODE_TEXT_COLOR: \"#AAA\",\n      NODE_SUBTEXT_SIZE: 12,\n      NODE_DEFAULT_COLOR: \"#333\",\n      NODE_DEFAULT_BGCOLOR: \"#353535\",\n      NODE_DEFAULT_BOXCOLOR: \"#666\",\n      NODE_DEFAULT_SHAPE: \"box\",\n      DEFAULT_SHADOW_COLOR: \"rgba(0,0,0,0.5)\",\n      DEFAULT_GROUP_FONT: 24,\n\n  WIDGET_BGCOLOR: \"#222\",\n  WIDGET_OUTLINE_COLOR: \"#666\",\n  WIDGET_TEXT_COLOR: \"#DDD\",\n  WIDGET_SECONDARY_TEXT_COLOR: \"#999\",\n\n      LINK_COLOR: \"#9A9\",\n      EVENT_LINK_COLOR: \"#A86\",\n      CONNECTING_LINK_COLOR: \"#AFA\",\n\n      MAX_NUMBER_OF_NODES: 1000, //avoid infinite loops\n      DEFAULT_POSITION: [100, 100], //default node position\n      VALID_SHAPES: [\"default\", \"box\", \"round\", \"card\"], //,\"circle\"\n\n      //shapes are used for nodes but also for slots\n      BOX_SHAPE: 1,\n      ROUND_SHAPE: 2,\n      CIRCLE_SHAPE: 3,\n      CARD_SHAPE: 4,\n      ARROW_SHAPE: 5,\n\n      //enums\n      INPUT: 1,\n      OUTPUT: 2,\n\n      EVENT: -1, //for outputs\n      ACTION: -1, //for inputs\n\n      ALWAYS: 0,\n      ON_EVENT: 1,\n      NEVER: 2,\n      ON_TRIGGER: 3,\n\n      UP: 1,\n      DOWN: 2,\n      LEFT: 3,\n      RIGHT: 4,\n      CENTER: 5,\n\n      STRAIGHT_LINK: 0,\n      LINEAR_LINK: 1,\n      SPLINE_LINK: 2,\n\n      NORMAL_TITLE: 0,\n      NO_TITLE: 1,\n      TRANSPARENT_TITLE: 2,\n      AUTOHIDE_TITLE: 3,\n\n      proxy: null, //used to redirect calls\n      node_images_path: \"\",\n\n      debug: false,\n      catch_exceptions: true,\n      throw_errors: true,\n      allow_scripts: false, //if set to true some nodes like Formula would be allowed to evaluate code that comes from unsafe sources (like node configuration), which could lead to exploits\n      registered_node_types: {}, //nodetypes by string\n      node_types_by_file_extension: {}, //used for dropping files in the canvas\n      Nodes: {}, //node types by classname\n\n      searchbox_extras: {}, //used to add extra features to the search box\n\n      /**\n       * Register a node class so it can be listed when the user wants to create a new one\n       * @method registerNodeType\n       * @param {String} type name of the node and path\n       * @param {Class} base_class class containing the structure of a node\n       */\n\n      registerNodeType: function(type, base_class) {\n          if (!base_class.prototype) {\n              throw \"Cannot register a simple object, it must be a class with a prototype\";\n          }\n          base_class.type = type;\n\n          if (LiteGraph.debug) {\n              console.log(\"Node registered: \" + type);\n          }\n\n          var categories = type.split(\"/\");\n          var classname = base_class.name;\n\n          var pos = type.lastIndexOf(\"/\");\n          base_class.category = type.substr(0, pos);\n\n          // if (!base_class.title) {\n          base_class.title = categories[categories.length - 1];\n          // }\n          //info.name = name.substr(pos+1,name.length - pos);\n\n          //extend class\n          if (base_class.prototype) {\n              //is a class\n              for (var i in LGraphNode.prototype) {\n                  if (!base_class.prototype[i]) {\n                      base_class.prototype[i] = LGraphNode.prototype[i];\n                  }\n              }\n          }\n\n    if( !Object.hasOwnProperty( base_class.prototype, \"shape\") )\n    {\n      Object.defineProperty(base_class.prototype, \"shape\", {\n        set: function(v) {\n          switch (v) {\n            case \"default\":\n              delete this._shape;\n              break;\n            case \"box\":\n              this._shape = LiteGraph.BOX_SHAPE;\n              break;\n            case \"round\":\n              this._shape = LiteGraph.ROUND_SHAPE;\n              break;\n            case \"circle\":\n              this._shape = LiteGraph.CIRCLE_SHAPE;\n              break;\n            case \"card\":\n              this._shape = LiteGraph.CARD_SHAPE;\n              break;\n            default:\n              this._shape = v;\n          }\n        },\n        get: function(v) {\n          return this._shape;\n        },\n        enumerable: true\n      });\n    }\n\n          var prev = this.registered_node_types[type];\n    if(prev)\n      console.log(\"replacing node type: \" + type);\n\n          this.registered_node_types[type] = base_class;\n          if (base_class.constructor.name) {\n              this.Nodes[classname] = base_class;\n          }\n          if (LiteGraph.onNodeTypeRegistered) {\n              LiteGraph.onNodeTypeRegistered(type, base_class);\n          }\n          if (prev && LiteGraph.onNodeTypeReplaced) {\n              LiteGraph.onNodeTypeReplaced(type, base_class, prev);\n          }\n\n          //warnings\n          if (base_class.prototype.onPropertyChange) {\n              console.warn(\n                  \"LiteGraph node class \" +\n                      type +\n                      \" has onPropertyChange method, it must be called onPropertyChanged with d at the end\"\n              );\n          }\n\n    //used to know which nodes create when dragging files to the canvas\n          if (base_class.supported_extensions) {\n              for (var i in base_class.supported_extensions) {\n                  this.node_types_by_file_extension[\n                      base_class.supported_extensions[i].toLowerCase()\n                  ] = base_class;\n              }\n          }\n      },\n\n      /**\n       * Create a new nodetype by passing a function, it wraps it with a proper class and generates inputs according to the parameters of the function.\n       * Useful to wrap simple methods that do not require properties, and that only process some input to generate an output.\n       * @method wrapFunctionAsNode\n       * @param {String} name node name with namespace (p.e.: 'math/sum')\n       * @param {Function} func\n       * @param {Array} param_types [optional] an array containing the type of every parameter, otherwise parameters will accept any type\n       * @param {String} return_type [optional] string with the return type, otherwise it will be generic\n       * @param {Object} properties [optional] properties to be configurable\n       */\n      wrapFunctionAsNode: function(\n          name,\n          func,\n          param_types,\n          return_type,\n          properties\n      ) {\n          var params = Array(func.length);\n          var code = \"\";\n          var names = LiteGraph.getParameterNames(func);\n          for (var i = 0; i < names.length; ++i) {\n              code +=\n                  \"this.addInput('\" +\n                  names[i] +\n                  \"',\" +\n                  (param_types && param_types[i]\n                      ? \"'\" + param_types[i] + \"'\"\n                      : \"0\") +\n                  \");\\n\";\n          }\n          code +=\n              \"this.addOutput('out',\" +\n              (return_type ? \"'\" + return_type + \"'\" : 0) +\n              \");\\n\";\n          if (properties) {\n              code +=\n                  \"this.properties = \" + JSON.stringify(properties) + \";\\n\";\n          }\n          var classobj = Function(code);\n          classobj.title = name.split(\"/\").pop();\n          classobj.desc = \"Generated from \" + func.name;\n          classobj.prototype.onExecute = function onExecute() {\n              for (var i = 0; i < params.length; ++i) {\n                  params[i] = this.getInputData(i);\n              }\n              var r = func.apply(this, params);\n              this.setOutputData(0, r);\n          };\n          this.registerNodeType(name, classobj);\n      },\n\n      /**\n       * Adds this method to all nodetypes, existing and to be created\n       * (You can add it to LGraphNode.prototype but then existing node types wont have it)\n       * @method addNodeMethod\n       * @param {Function} func\n       */\n      addNodeMethod: function(name, func) {\n          LGraphNode.prototype[name] = func;\n          for (var i in this.registered_node_types) {\n              var type = this.registered_node_types[i];\n              if (type.prototype[name]) {\n                  type.prototype[\"_\" + name] = type.prototype[name];\n              } //keep old in case of replacing\n              type.prototype[name] = func;\n          }\n      },\n\n      /**\n       * Create a node of a given type with a name. The node is not attached to any graph yet.\n       * @method createNode\n       * @param {String} type full name of the node class. p.e. \"math/sin\"\n       * @param {String} name a name to distinguish from other nodes\n       * @param {Object} options to set options\n       */\n\n      createNode: function(type, title, options) {\n          var base_class = this.registered_node_types[type];\n          if (!base_class) {\n              if (LiteGraph.debug) {\n                  console.log(\n                      'GraphNode type \"' + type + '\" not registered.'\n                  );\n              }\n              return null;\n          }\n\n          var prototype = base_class.prototype || base_class;\n\n          title = title || base_class.title || type;\n\n          var node = null;\n\n          if (LiteGraph.catch_exceptions) {\n              try {\n                  node = new base_class(title);\n              } catch (err) {\n                  console.error(err);\n                  return null;\n              }\n          } else {\n              node = new base_class(title);\n          }\n\n          node.type = type;\n\n          if (!node.title && title) {\n              node.title = title;\n          }\n          if (!node.properties) {\n              node.properties = {};\n          }\n          if (!node.properties_info) {\n              node.properties_info = [];\n          }\n          if (!node.flags) {\n              node.flags = {};\n          }\n          if (!node.size) {\n              node.size = node.computeSize();\n          }\n          if (!node.pos) {\n              node.pos = LiteGraph.DEFAULT_POSITION.concat();\n          }\n          if (!node.mode) {\n              node.mode = LiteGraph.ALWAYS;\n          }\n\n          //extra options\n          if (options) {\n              for (var i in options) {\n                  node[i] = options[i];\n              }\n          }\n\n          return node;\n      },\n\n      /**\n       * Returns a registered node type with a given name\n       * @method getNodeType\n       * @param {String} type full name of the node class. p.e. \"math/sin\"\n       * @return {Class} the node class\n       */\n      getNodeType: function(type) {\n          return this.registered_node_types[type];\n      },\n\n      /**\n       * Returns a list of node types matching one category\n       * @method getNodeType\n       * @param {String} category category name\n       * @return {Array} array with all the node classes\n       */\n\n      getNodeTypesInCategory: function(category, filter) {\n          var r = [];\n          for (var i in this.registered_node_types) {\n              var type = this.registered_node_types[i];\n              if (filter && type.filter && type.filter != filter) {\n                  continue;\n              }\n\n              if (category == \"\") {\n                  if (type.category == null) {\n                      r.push(type);\n                  }\n              } else if (type.category == category) {\n                  r.push(type);\n              }\n          }\n\n          return r;\n      },\n\n      /**\n       * Returns a list with all the node type categories\n       * @method getNodeTypesCategories\n       * @return {Array} array with all the names of the categories\n       */\n\n      getNodeTypesCategories: function( filter ) {\n          var categories = { \"\": 1 };\n          for (var i in this.registered_node_types) {\n      var type = this.registered_node_types[i];\n              if ( type.category && !type.skip_list )\n              {\n        if(filter && type.filter != filter)\n          continue;\n                  categories[type.category] = 1;\n              }\n          }\n          var result = [];\n          for (var i in categories) {\n              result.push(i);\n          }\n          return result;\n      },\n\n      //debug purposes: reloads all the js scripts that matches a wildcard\n      reloadNodes: function(folder_wildcard) {\n          var tmp = document.getElementsByTagName(\"script\");\n          //weird, this array changes by its own, so we use a copy\n          var script_files = [];\n          for (var i in tmp) {\n              script_files.push(tmp[i]);\n          }\n\n          var docHeadObj = document.getElementsByTagName(\"head\")[0];\n          folder_wildcard = document.location.href + folder_wildcard;\n\n          for (var i in script_files) {\n              var src = script_files[i].src;\n              if (\n                  !src ||\n                  src.substr(0, folder_wildcard.length) != folder_wildcard\n              ) {\n                  continue;\n              }\n\n              try {\n                  if (LiteGraph.debug) {\n                      console.log(\"Reloading: \" + src);\n                  }\n                  var dynamicScript = document.createElement(\"script\");\n                  dynamicScript.type = \"text/javascript\";\n                  dynamicScript.src = src;\n                  docHeadObj.appendChild(dynamicScript);\n                  docHeadObj.removeChild(script_files[i]);\n              } catch (err) {\n                  if (LiteGraph.throw_errors) {\n                      throw err;\n                  }\n                  if (LiteGraph.debug) {\n                      console.log(\"Error while reloading \" + src);\n                  }\n              }\n          }\n\n          if (LiteGraph.debug) {\n              console.log(\"Nodes reloaded\");\n          }\n      },\n\n      //separated just to improve if it doesn't work\n      cloneObject: function(obj, target) {\n          if (obj == null) {\n              return null;\n          }\n          var r = JSON.parse(JSON.stringify(obj));\n          if (!target) {\n              return r;\n          }\n\n          for (var i in r) {\n              target[i] = r[i];\n          }\n          return target;\n      },\n\n      isValidConnection: function(type_a, type_b) {\n          if (\n              !type_a || //generic output\n              !type_b || //generic input\n              type_a == type_b || //same type (is valid for triggers)\n              (type_a == LiteGraph.EVENT && type_b == LiteGraph.ACTION)\n          ) {\n              return true;\n          }\n\n          // Enforce string type to handle toLowerCase call (-1 number not ok)\n          type_a = String(type_a);\n          type_b = String(type_b);\n          type_a = type_a.toLowerCase();\n          type_b = type_b.toLowerCase();\n\n          // For nodes supporting multiple connection types\n          if (type_a.indexOf(\",\") == -1 && type_b.indexOf(\",\") == -1) {\n              return type_a == type_b;\n          }\n\n          // Check all permutations to see if one is valid\n          var supported_types_a = type_a.split(\",\");\n          var supported_types_b = type_b.split(\",\");\n          for (var i = 0; i < supported_types_a.length; ++i) {\n              for (var j = 0; j < supported_types_b.length; ++j) {\n                  if (supported_types_a[i] == supported_types_b[j]) {\n                      return true;\n                  }\n              }\n          }\n\n          return false;\n      },\n\n      registerSearchboxExtra: function(node_type, description, data) {\n          this.searchbox_extras[description.toLowerCase()] = {\n              type: node_type,\n              desc: description,\n              data: data\n          };\n      }\n  });\n\n  //timer that works everywhere\n  if (typeof performance != \"undefined\") {\n      LiteGraph.getTime = performance.now.bind(performance);\n  } else if (typeof Date != \"undefined\" && Date.now) {\n      LiteGraph.getTime = Date.now.bind(Date);\n  } else if (typeof process != \"undefined\") {\n      LiteGraph.getTime = function() {\n          var t = process.hrtime();\n          return t[0] * 0.001 + t[1] * 1e-6;\n      };\n  } else {\n      LiteGraph.getTime = function getTime() {\n          return new Date().getTime();\n      };\n  }\n\n  //*********************************************************************************\n  // LGraph CLASS\n  //*********************************************************************************\n\n  /**\n   * LGraph is the class that contain a full graph. We instantiate one and add nodes to it, and then we can run the execution loop.\n   *\n   * @class LGraph\n   * @constructor\n   * @param {Object} o data from previous serialization [optional]\n   */\n\n  function LGraph(o) {\n      if (LiteGraph.debug) {\n          console.log(\"Graph created\");\n      }\n      this.list_of_graphcanvas = null;\n      this.clear();\n\n      if (o) {\n          this.configure(o);\n      }\n  }\n\n  global.LGraph = LiteGraph.LGraph = LGraph;\n\n  //default supported types\n  LGraph.supported_types = [\"number\", \"string\", \"boolean\"];\n\n  //used to know which types of connections support this graph (some graphs do not allow certain types)\n  LGraph.prototype.getSupportedTypes = function() {\n      return this.supported_types || LGraph.supported_types;\n  };\n\n  LGraph.STATUS_STOPPED = 1;\n  LGraph.STATUS_RUNNING = 2;\n\n  /**\n   * Removes all nodes from this graph\n   * @method clear\n   */\n\n  LGraph.prototype.clear = function() {\n      this.stop();\n      this.status = LGraph.STATUS_STOPPED;\n\n      this.last_node_id = 0;\n      this.last_link_id = 0;\n\n      this._version = -1; //used to detect changes\n\n      //safe clear\n      if (this._nodes) {\n          for (var i = 0; i < this._nodes.length; ++i) {\n              var node = this._nodes[i];\n              if (node.onRemoved) {\n                  node.onRemoved();\n              }\n          }\n      }\n\n      //nodes\n      this._nodes = [];\n      this._nodes_by_id = {};\n      this._nodes_in_order = []; //nodes that are executable sorted in execution order\n      this._nodes_executable = null; //nodes that contain onExecute\n\n      //other scene stuff\n      this._groups = [];\n\n      //links\n      this.links = {}; //container with all the links\n\n      //iterations\n      this.iteration = 0;\n\n      //custom data\n      this.config = {};\n  this.vars = {};\n\n      //timing\n      this.globaltime = 0;\n      this.runningtime = 0;\n      this.fixedtime = 0;\n      this.fixedtime_lapse = 0.01;\n      this.elapsed_time = 0.01;\n      this.last_update_time = 0;\n      this.starttime = 0;\n\n      this.catch_errors = true;\n\n      //subgraph_data\n      this.inputs = {};\n      this.outputs = {};\n\n      //notify canvas to redraw\n      this.change();\n\n      this.sendActionToCanvas(\"clear\");\n  };\n\n  /**\n   * Attach Canvas to this graph\n   * @method attachCanvas\n   * @param {GraphCanvas} graph_canvas\n   */\n\n  LGraph.prototype.attachCanvas = function(graphcanvas) {\n      if (graphcanvas.constructor != LGraphCanvas) {\n          throw \"attachCanvas expects a LGraphCanvas instance\";\n      }\n      if (graphcanvas.graph && graphcanvas.graph != this) {\n          graphcanvas.graph.detachCanvas(graphcanvas);\n      }\n\n      graphcanvas.graph = this;\n      if (!this.list_of_graphcanvas) {\n          this.list_of_graphcanvas = [];\n      }\n      this.list_of_graphcanvas.push(graphcanvas);\n  };\n\n  /**\n   * Detach Canvas from this graph\n   * @method detachCanvas\n   * @param {GraphCanvas} graph_canvas\n   */\n  LGraph.prototype.detachCanvas = function(graphcanvas) {\n      if (!this.list_of_graphcanvas) {\n          return;\n      }\n\n      var pos = this.list_of_graphcanvas.indexOf(graphcanvas);\n      if (pos == -1) {\n          return;\n      }\n      graphcanvas.graph = null;\n      this.list_of_graphcanvas.splice(pos, 1);\n  };\n\n  /**\n   * Starts running this graph every interval milliseconds.\n   * @method start\n   * @param {number} interval amount of milliseconds between executions, if 0 then it renders to the monitor refresh rate\n   */\n\n  LGraph.prototype.start = function(interval) {\n      if (this.status == LGraph.STATUS_RUNNING) {\n          return;\n      }\n      this.status = LGraph.STATUS_RUNNING;\n\n      if (this.onPlayEvent) {\n          this.onPlayEvent();\n      }\n\n      this.sendEventToAllNodes(\"onStart\");\n\n      //launch\n      this.starttime = LiteGraph.getTime();\n      this.last_update_time = this.starttime;\n      interval = interval || 0;\n      var that = this;\n\n      if (\n          interval == 0 &&\n          typeof window != \"undefined\" &&\n          window.requestAnimationFrame\n      ) {\n          function on_frame() {\n              if (that.execution_timer_id != -1) {\n                  return;\n              }\n              window.requestAnimationFrame(on_frame);\n              that.runStep(1, !this.catch_errors);\n          }\n          this.execution_timer_id = -1;\n          on_frame();\n      } else {\n          this.execution_timer_id = setInterval(function() {\n              //execute\n              that.runStep(1, !this.catch_errors);\n          }, interval);\n      }\n  };\n\n  /**\n   * Stops the execution loop of the graph\n   * @method stop execution\n   */\n\n  LGraph.prototype.stop = function() {\n      if (this.status == LGraph.STATUS_STOPPED) {\n          return;\n      }\n\n      this.status = LGraph.STATUS_STOPPED;\n\n      if (this.onStopEvent) {\n          this.onStopEvent();\n      }\n\n      if (this.execution_timer_id != null) {\n          if (this.execution_timer_id != -1) {\n              clearInterval(this.execution_timer_id);\n          }\n          this.execution_timer_id = null;\n      }\n\n      this.sendEventToAllNodes(\"onStop\");\n  };\n\n  /**\n   * Run N steps (cycles) of the graph\n   * @method runStep\n   * @param {number} num number of steps to run, default is 1\n   * @param {Boolean} do_not_catch_errors [optional] if you want to try/catch errors \n   * @param {number} limit max number of nodes to execute (used to execute from start to a node)\n   */\n\n  LGraph.prototype.runStep = function(num, do_not_catch_errors, limit ) {\n      num = num || 1;\n\n      var start = LiteGraph.getTime();\n      this.globaltime = 0.001 * (start - this.starttime);\n\n      var nodes = this._nodes_executable\n          ? this._nodes_executable\n          : this._nodes;\n      if (!nodes) {\n          return;\n      }\n\n  limit = limit || nodes.length;\n\n      if (do_not_catch_errors) {\n          //iterations\n          for (var i = 0; i < num; i++) {\n              for (var j = 0; j < limit; ++j) {\n                  var node = nodes[j];\n                  if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                      node.onExecute(); //hard to send elapsed time\n                  }\n              }\n\n              this.fixedtime += this.fixedtime_lapse;\n              if (this.onExecuteStep) {\n                  this.onExecuteStep();\n              }\n          }\n\n          if (this.onAfterExecute) {\n              this.onAfterExecute();\n          }\n      } else {\n          try {\n              //iterations\n              for (var i = 0; i < num; i++) {\n                  for (var j = 0; j < limit; ++j) {\n                      var node = nodes[j];\n                      if (node.mode == LiteGraph.ALWAYS && node.onExecute) {\n                          node.onExecute();\n                      }\n                  }\n\n                  this.fixedtime += this.fixedtime_lapse;\n                  if (this.onExecuteStep) {\n                      this.onExecuteStep();\n                  }\n              }\n\n              if (this.onAfterExecute) {\n                  this.onAfterExecute();\n              }\n              this.errors_in_execution = false;\n          } catch (err) {\n              this.errors_in_execution = true;\n              if (LiteGraph.throw_errors) {\n                  throw err;\n              }\n              if (LiteGraph.debug) {\n                  console.log(\"Error during execution: \" + err);\n              }\n              this.stop();\n          }\n      }\n\n      var now = LiteGraph.getTime();\n      var elapsed = now - start;\n      if (elapsed == 0) {\n          elapsed = 1;\n      }\n      this.execution_time = 0.001 * elapsed;\n      this.globaltime += 0.001 * elapsed;\n      this.iteration += 1;\n      this.elapsed_time = (now - this.last_update_time) * 0.001;\n      this.last_update_time = now;\n  };\n\n  /**\n   * Updates the graph execution order according to relevance of the nodes (nodes with only outputs have more relevance than\n   * nodes with only inputs.\n   * @method updateExecutionOrder\n   */\n  LGraph.prototype.updateExecutionOrder = function() {\n      this._nodes_in_order = this.computeExecutionOrder(false);\n      this._nodes_executable = [];\n      for (var i = 0; i < this._nodes_in_order.length; ++i) {\n          if (this._nodes_in_order[i].onExecute) {\n              this._nodes_executable.push(this._nodes_in_order[i]);\n          }\n      }\n  };\n\n  //This is more internal, it computes the executable nodes in order and returns it\n  LGraph.prototype.computeExecutionOrder = function(\n      only_onExecute,\n      set_level\n  ) {\n      var L = [];\n      var S = [];\n      var M = {};\n      var visited_links = {}; //to avoid repeating links\n      var remaining_links = {}; //to a\n\n      //search for the nodes without inputs (starting nodes)\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          var node = this._nodes[i];\n          if (only_onExecute && !node.onExecute) {\n              continue;\n          }\n\n          M[node.id] = node; //add to pending nodes\n\n          var num = 0; //num of input connections\n          if (node.inputs) {\n              for (var j = 0, l2 = node.inputs.length; j < l2; j++) {\n                  if (node.inputs[j] && node.inputs[j].link != null) {\n                      num += 1;\n                  }\n              }\n          }\n\n          if (num == 0) {\n              //is a starting node\n              S.push(node);\n              if (set_level) {\n                  node._level = 1;\n              }\n          } //num of input links\n          else {\n              if (set_level) {\n                  node._level = 0;\n              }\n              remaining_links[node.id] = num;\n          }\n      }\n\n      while (true) {\n          if (S.length == 0) {\n              break;\n          }\n\n          //get an starting node\n          var node = S.shift();\n          L.push(node); //add to ordered list\n          delete M[node.id]; //remove from the pending nodes\n\n          if (!node.outputs) {\n              continue;\n          }\n\n          //for every output\n          for (var i = 0; i < node.outputs.length; i++) {\n              var output = node.outputs[i];\n              //not connected\n              if (\n                  output == null ||\n                  output.links == null ||\n                  output.links.length == 0\n              ) {\n                  continue;\n              }\n\n              //for every connection\n              for (var j = 0; j < output.links.length; j++) {\n                  var link_id = output.links[j];\n                  var link = this.links[link_id];\n                  if (!link) {\n                      continue;\n                  }\n\n                  //already visited link (ignore it)\n                  if (visited_links[link.id]) {\n                      continue;\n                  }\n\n                  var target_node = this.getNodeById(link.target_id);\n                  if (target_node == null) {\n                      visited_links[link.id] = true;\n                      continue;\n                  }\n\n                  if (\n                      set_level &&\n                      (!target_node._level ||\n                          target_node._level <= node._level)\n                  ) {\n                      target_node._level = node._level + 1;\n                  }\n\n                  visited_links[link.id] = true; //mark as visited\n                  remaining_links[target_node.id] -= 1; //reduce the number of links remaining\n                  if (remaining_links[target_node.id] == 0) {\n                      S.push(target_node);\n                  } //if no more links, then add to starters array\n              }\n          }\n      }\n\n      //the remaining ones (loops)\n      for (var i in M) {\n          L.push(M[i]);\n      }\n\n      if (L.length != this._nodes.length && LiteGraph.debug) {\n          console.warn(\"something went wrong, nodes missing\");\n      }\n\n      var l = L.length;\n\n      //save order number in the node\n      for (var i = 0; i < l; ++i) {\n          L[i].order = i;\n      }\n\n      //sort now by priority\n      L = L.sort(function(A, B) {\n          var Ap = A.constructor.priority || A.priority || 0;\n          var Bp = B.constructor.priority || B.priority || 0;\n          if (Ap == Bp) {\n              //if same priority, sort by order\n              return A.order - B.order;\n          }\n          return Ap - Bp; //sort by priority\n      });\n\n      //save order number in the node, again...\n      for (var i = 0; i < l; ++i) {\n          L[i].order = i;\n      }\n\n      return L;\n  };\n\n  /**\n   * Returns all the nodes that could affect this one (ancestors) by crawling all the inputs recursively.\n   * It doesn't include the node itself\n   * @method getAncestors\n   * @return {Array} an array with all the LGraphNodes that affect this node, in order of execution\n   */\n  LGraph.prototype.getAncestors = function(node) {\n      var ancestors = [];\n      var pending = [node];\n      var visited = {};\n\n      while (pending.length) {\n          var current = pending.shift();\n          if (!current.inputs) {\n              continue;\n          }\n          if (!visited[current.id] && current != node) {\n              visited[current.id] = true;\n              ancestors.push(current);\n          }\n\n          for (var i = 0; i < current.inputs.length; ++i) {\n              var input = current.getInputNode(i);\n              if (input && ancestors.indexOf(input) == -1) {\n                  pending.push(input);\n              }\n          }\n      }\n\n      ancestors.sort(function(a, b) {\n          return a.order - b.order;\n      });\n      return ancestors;\n  };\n\n  /**\n   * Positions every node in a more readable manner\n   * @method arrange\n   */\n  LGraph.prototype.arrange = function(margin) {\n      margin = margin || 100;\n\n      var nodes = this.computeExecutionOrder(false, true);\n      var columns = [];\n      for (var i = 0; i < nodes.length; ++i) {\n          var node = nodes[i];\n          var col = node._level || 1;\n          if (!columns[col]) {\n              columns[col] = [];\n          }\n          columns[col].push(node);\n      }\n\n      var x = margin;\n\n      for (var i = 0; i < columns.length; ++i) {\n          var column = columns[i];\n          if (!column) {\n              continue;\n          }\n          var max_size = 100;\n          var y = margin + LiteGraph.NODE_TITLE_HEIGHT;\n          for (var j = 0; j < column.length; ++j) {\n              var node = column[j];\n              node.pos[0] = x;\n              node.pos[1] = y;\n              if (node.size[0] > max_size) {\n                  max_size = node.size[0];\n              }\n              y += node.size[1] + margin + LiteGraph.NODE_TITLE_HEIGHT;\n          }\n          x += max_size + margin;\n      }\n\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * Returns the amount of time the graph has been running in milliseconds\n   * @method getTime\n   * @return {number} number of milliseconds the graph has been running\n   */\n  LGraph.prototype.getTime = function() {\n      return this.globaltime;\n  };\n\n  /**\n   * Returns the amount of time accumulated using the fixedtime_lapse var. This is used in context where the time increments should be constant\n   * @method getFixedTime\n   * @return {number} number of milliseconds the graph has been running\n   */\n\n  LGraph.prototype.getFixedTime = function() {\n      return this.fixedtime;\n  };\n\n  /**\n   * Returns the amount of time it took to compute the latest iteration. Take into account that this number could be not correct\n   * if the nodes are using graphical actions\n   * @method getElapsedTime\n   * @return {number} number of milliseconds it took the last cycle\n   */\n\n  LGraph.prototype.getElapsedTime = function() {\n      return this.elapsed_time;\n  };\n\n  /**\n   * Sends an event to all the nodes, useful to trigger stuff\n   * @method sendEventToAllNodes\n   * @param {String} eventname the name of the event (function to be called)\n   * @param {Array} params parameters in array format\n   */\n  LGraph.prototype.sendEventToAllNodes = function(eventname, params, mode) {\n      mode = mode || LiteGraph.ALWAYS;\n\n      var nodes = this._nodes_in_order ? this._nodes_in_order : this._nodes;\n      if (!nodes) {\n          return;\n      }\n\n      for (var j = 0, l = nodes.length; j < l; ++j) {\n          var node = nodes[j];\n\n          if (\n              node.constructor === LiteGraph.Subgraph &&\n              eventname != \"onExecute\"\n          ) {\n              if (node.mode == mode) {\n                  node.sendEventToAllNodes(eventname, params, mode);\n              }\n              continue;\n          }\n\n          if (!node[eventname] || node.mode != mode) {\n              continue;\n          }\n          if (params === undefined) {\n              node[eventname]();\n          } else if (params && params.constructor === Array) {\n              node[eventname].apply(node, params);\n          } else {\n              node[eventname](params);\n          }\n      }\n  };\n\n  LGraph.prototype.sendActionToCanvas = function(action, params) {\n      if (!this.list_of_graphcanvas) {\n          return;\n      }\n\n      for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n          var c = this.list_of_graphcanvas[i];\n          if (c[action]) {\n              c[action].apply(c, params);\n          }\n      }\n  };\n\n  /**\n   * Adds a new node instance to this graph\n   * @method add\n   * @param {LGraphNode} node the instance of the node\n   */\n\n  LGraph.prototype.add = function(node, skip_compute_order) {\n      if (!node) {\n          return;\n      }\n\n      //groups\n      if (node.constructor === LGraphGroup) {\n          this._groups.push(node);\n          this.setDirtyCanvas(true);\n          this.change();\n          node.graph = this;\n          this._version++;\n          return;\n      }\n\n      //nodes\n      if (node.id != -1 && this._nodes_by_id[node.id] != null) {\n          console.warn(\n              \"LiteGraph: there is already a node with this ID, changing it\"\n          );\n          node.id = ++this.last_node_id;\n      }\n\n      if (this._nodes.length >= LiteGraph.MAX_NUMBER_OF_NODES) {\n          throw \"LiteGraph: max number of nodes in a graph reached\";\n      }\n\n      //give him an id\n      if (node.id == null || node.id == -1) {\n          node.id = ++this.last_node_id;\n      } else if (this.last_node_id < node.id) {\n          this.last_node_id = node.id;\n      }\n\n      node.graph = this;\n      this._version++;\n\n      this._nodes.push(node);\n      this._nodes_by_id[node.id] = node;\n\n      if (node.onAdded) {\n          node.onAdded(this);\n      }\n\n      if (this.config.align_to_grid) {\n          node.alignToGrid();\n      }\n\n      if (!skip_compute_order) {\n          this.updateExecutionOrder();\n      }\n\n      if (this.onNodeAdded) {\n          this.onNodeAdded(node);\n      }\n\n      this.setDirtyCanvas(true);\n      this.change();\n\n      return node; //to chain actions\n  };\n\n  /**\n   * Removes a node from the graph\n   * @method remove\n   * @param {LGraphNode} node the instance of the node\n   */\n\n  LGraph.prototype.remove = function(node) {\n      if (node.constructor === LiteGraph.LGraphGroup) {\n          var index = this._groups.indexOf(node);\n          if (index != -1) {\n              this._groups.splice(index, 1);\n          }\n          node.graph = null;\n          this._version++;\n          this.setDirtyCanvas(true, true);\n          this.change();\n          return;\n      }\n\n      if (this._nodes_by_id[node.id] == null) {\n          return;\n      } //not found\n\n      if (node.ignore_remove) {\n          return;\n      } //cannot be removed\n\n      //disconnect inputs\n      if (node.inputs) {\n          for (var i = 0; i < node.inputs.length; i++) {\n              var slot = node.inputs[i];\n              if (slot.link != null) {\n                  node.disconnectInput(i);\n              }\n          }\n      }\n\n      //disconnect outputs\n      if (node.outputs) {\n          for (var i = 0; i < node.outputs.length; i++) {\n              var slot = node.outputs[i];\n              if (slot.links != null && slot.links.length) {\n                  node.disconnectOutput(i);\n              }\n          }\n      }\n\n      //node.id = -1; //why?\n\n      //callback\n      if (node.onRemoved) {\n          node.onRemoved();\n      }\n\n      node.graph = null;\n      this._version++;\n\n      //remove from canvas render\n      if (this.list_of_graphcanvas) {\n          for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n              var canvas = this.list_of_graphcanvas[i];\n              if (canvas.selected_nodes[node.id]) {\n                  delete canvas.selected_nodes[node.id];\n              }\n              if (canvas.node_dragged == node) {\n                  canvas.node_dragged = null;\n              }\n          }\n      }\n\n      //remove from containers\n      var pos = this._nodes.indexOf(node);\n      if (pos != -1) {\n          this._nodes.splice(pos, 1);\n      }\n      delete this._nodes_by_id[node.id];\n\n      if (this.onNodeRemoved) {\n          this.onNodeRemoved(node);\n      }\n\n      this.setDirtyCanvas(true, true);\n      this.change();\n\n      this.updateExecutionOrder();\n  };\n\n  /**\n   * Returns a node by its id.\n   * @method getNodeById\n   * @param {Number} id\n   */\n\n  LGraph.prototype.getNodeById = function(id) {\n      if (id == null) {\n          return null;\n      }\n      return this._nodes_by_id[id];\n  };\n\n  /**\n   * Returns a list of nodes that matches a class\n   * @method findNodesByClass\n   * @param {Class} classObject the class itself (not an string)\n   * @return {Array} a list with all the nodes of this type\n   */\n  LGraph.prototype.findNodesByClass = function(classObject, result) {\n      result = result || [];\n      result.length = 0;\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].constructor === classObject) {\n              result.push(this._nodes[i]);\n          }\n      }\n      return result;\n  };\n\n  /**\n   * Returns a list of nodes that matches a type\n   * @method findNodesByType\n   * @param {String} type the name of the node type\n   * @return {Array} a list with all the nodes of this type\n   */\n  LGraph.prototype.findNodesByType = function(type, result) {\n      var type = type.toLowerCase();\n      result = result || [];\n      result.length = 0;\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].type.toLowerCase() == type) {\n              result.push(this._nodes[i]);\n          }\n      }\n      return result;\n  };\n\n  /**\n   * Returns the first node that matches a name in its title\n   * @method findNodeByTitle\n   * @param {String} name the name of the node to search\n   * @return {Node} the node or null\n   */\n  LGraph.prototype.findNodeByTitle = function(title) {\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].title == title) {\n              return this._nodes[i];\n          }\n      }\n      return null;\n  };\n\n  /**\n   * Returns a list of nodes that matches a name\n   * @method findNodesByTitle\n   * @param {String} name the name of the node to search\n   * @return {Array} a list with all the nodes with this name\n   */\n  LGraph.prototype.findNodesByTitle = function(title) {\n      var result = [];\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          if (this._nodes[i].title == title) {\n              result.push(this._nodes[i]);\n          }\n      }\n      return result;\n  };\n\n  /**\n   * Returns the top-most node in this position of the canvas\n   * @method getNodeOnPos\n   * @param {number} x the x coordinate in canvas space\n   * @param {number} y the y coordinate in canvas space\n   * @param {Array} nodes_list a list with all the nodes to search from, by default is all the nodes in the graph\n   * @return {LGraphNode} the node at this position or null\n   */\n  LGraph.prototype.getNodeOnPos = function(x, y, nodes_list, margin) {\n      nodes_list = nodes_list || this._nodes;\n      for (var i = nodes_list.length - 1; i >= 0; i--) {\n          var n = nodes_list[i];\n          if (n.isPointInside(x, y, margin)) {\n              return n;\n          }\n      }\n      return null;\n  };\n\n  /**\n   * Returns the top-most group in that position\n   * @method getGroupOnPos\n   * @param {number} x the x coordinate in canvas space\n   * @param {number} y the y coordinate in canvas space\n   * @return {LGraphGroup} the group or null\n   */\n  LGraph.prototype.getGroupOnPos = function(x, y) {\n      for (var i = this._groups.length - 1; i >= 0; i--) {\n          var g = this._groups[i];\n          if (g.isPointInside(x, y, 2, true)) {\n              return g;\n          }\n      }\n      return null;\n  };\n\n  /**\n   * Checks that the node type matches the node type registered, used when replacing a nodetype by a newer version during execution\n   * this replaces the ones using the old version with the new version\n   * @method checkNodeTypes\n   */\n  LGraph.prototype.checkNodeTypes = function() {\n      var changes = false;\n      for (var i = 0; i < this._nodes.length; i++) {\n          var node = this._nodes[i];\n          var ctor = LiteGraph.registered_node_types[node.type];\n          if (node.constructor == ctor) {\n              continue;\n          }\n          console.log(\"node being replaced by newer version: \" + node.type);\n          var newnode = LiteGraph.createNode(node.type);\n          changes = true;\n          this._nodes[i] = newnode;\n          newnode.configure(node.serialize());\n          newnode.graph = this;\n          this._nodes_by_id[newnode.id] = newnode;\n          if (node.inputs) {\n              newnode.inputs = node.inputs.concat();\n          }\n          if (node.outputs) {\n              newnode.outputs = node.outputs.concat();\n          }\n      }\n      this.updateExecutionOrder();\n  };\n\n  // ********** GLOBALS *****************\n\n  LGraph.prototype.onAction = function(action, param) {\n      this._input_nodes = this.findNodesByClass(\n          LiteGraph.GraphInput,\n          this._input_nodes\n      );\n      for (var i = 0; i < this._input_nodes.length; ++i) {\n          var node = this._input_nodes[i];\n          if (node.properties.name != action) {\n              continue;\n          }\n          node.onAction(action, param);\n          break;\n      }\n  };\n\n  LGraph.prototype.trigger = function(action, param) {\n      if (this.onTrigger) {\n          this.onTrigger(action, param);\n      }\n  };\n\n  /**\n   * Tell this graph it has a global graph input of this type\n   * @method addGlobalInput\n   * @param {String} name\n   * @param {String} type\n   * @param {*} value [optional]\n   */\n  LGraph.prototype.addInput = function(name, type, value) {\n      var input = this.inputs[name];\n      if (input) {\n          //already exist\n          return;\n      }\n\n      this.inputs[name] = { name: name, type: type, value: value };\n      this._version++;\n\n      if (this.onInputAdded) {\n          this.onInputAdded(name, type);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Assign a data to the global graph input\n   * @method setGlobalInputData\n   * @param {String} name\n   * @param {*} data\n   */\n  LGraph.prototype.setInputData = function(name, data) {\n      var input = this.inputs[name];\n      if (!input) {\n          return;\n      }\n      input.value = data;\n  };\n\n  /**\n   * Returns the current value of a global graph input\n   * @method getInputData\n   * @param {String} name\n   * @return {*} the data\n   */\n  LGraph.prototype.getInputData = function(name) {\n      var input = this.inputs[name];\n      if (!input) {\n          return null;\n      }\n      return input.value;\n  };\n\n  /**\n   * Changes the name of a global graph input\n   * @method renameInput\n   * @param {String} old_name\n   * @param {String} new_name\n   */\n  LGraph.prototype.renameInput = function(old_name, name) {\n      if (name == old_name) {\n          return;\n      }\n\n      if (!this.inputs[old_name]) {\n          return false;\n      }\n\n      if (this.inputs[name]) {\n          console.error(\"there is already one input with that name\");\n          return false;\n      }\n\n      this.inputs[name] = this.inputs[old_name];\n      delete this.inputs[old_name];\n      this._version++;\n\n      if (this.onInputRenamed) {\n          this.onInputRenamed(old_name, name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Changes the type of a global graph input\n   * @method changeInputType\n   * @param {String} name\n   * @param {String} type\n   */\n  LGraph.prototype.changeInputType = function(name, type) {\n      if (!this.inputs[name]) {\n          return false;\n      }\n\n      if (\n          this.inputs[name].type &&\n          String(this.inputs[name].type).toLowerCase() ==\n              String(type).toLowerCase()\n      ) {\n          return;\n      }\n\n      this.inputs[name].type = type;\n      this._version++;\n      if (this.onInputTypeChanged) {\n          this.onInputTypeChanged(name, type);\n      }\n  };\n\n  /**\n   * Removes a global graph input\n   * @method removeInput\n   * @param {String} name\n   * @param {String} type\n   */\n  LGraph.prototype.removeInput = function(name) {\n      if (!this.inputs[name]) {\n          return false;\n      }\n\n      delete this.inputs[name];\n      this._version++;\n\n      if (this.onInputRemoved) {\n          this.onInputRemoved(name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n      return true;\n  };\n\n  /**\n   * Creates a global graph output\n   * @method addOutput\n   * @param {String} name\n   * @param {String} type\n   * @param {*} value\n   */\n  LGraph.prototype.addOutput = function(name, type, value) {\n      this.outputs[name] = { name: name, type: type, value: value };\n      this._version++;\n\n      if (this.onOutputAdded) {\n          this.onOutputAdded(name, type);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Assign a data to the global output\n   * @method setOutputData\n   * @param {String} name\n   * @param {String} value\n   */\n  LGraph.prototype.setOutputData = function(name, value) {\n      var output = this.outputs[name];\n      if (!output) {\n          return;\n      }\n      output.value = value;\n  };\n\n  /**\n   * Returns the current value of a global graph output\n   * @method getOutputData\n   * @param {String} name\n   * @return {*} the data\n   */\n  LGraph.prototype.getOutputData = function(name) {\n      var output = this.outputs[name];\n      if (!output) {\n          return null;\n      }\n      return output.value;\n  };\n\n  /**\n   * Renames a global graph output\n   * @method renameOutput\n   * @param {String} old_name\n   * @param {String} new_name\n   */\n  LGraph.prototype.renameOutput = function(old_name, name) {\n      if (!this.outputs[old_name]) {\n          return false;\n      }\n\n      if (this.outputs[name]) {\n          console.error(\"there is already one output with that name\");\n          return false;\n      }\n\n      this.outputs[name] = this.outputs[old_name];\n      delete this.outputs[old_name];\n      this._version++;\n\n      if (this.onOutputRenamed) {\n          this.onOutputRenamed(old_name, name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n  };\n\n  /**\n   * Changes the type of a global graph output\n   * @method changeOutputType\n   * @param {String} name\n   * @param {String} type\n   */\n  LGraph.prototype.changeOutputType = function(name, type) {\n      if (!this.outputs[name]) {\n          return false;\n      }\n\n      if (\n          this.outputs[name].type &&\n          String(this.outputs[name].type).toLowerCase() ==\n              String(type).toLowerCase()\n      ) {\n          return;\n      }\n\n      this.outputs[name].type = type;\n      this._version++;\n      if (this.onOutputTypeChanged) {\n          this.onOutputTypeChanged(name, type);\n      }\n  };\n\n  /**\n   * Removes a global graph output\n   * @method removeOutput\n   * @param {String} name\n   */\n  LGraph.prototype.removeOutput = function(name) {\n      if (!this.outputs[name]) {\n          return false;\n      }\n      delete this.outputs[name];\n      this._version++;\n\n      if (this.onOutputRemoved) {\n          this.onOutputRemoved(name);\n      }\n\n      if (this.onInputsOutputsChange) {\n          this.onInputsOutputsChange();\n      }\n      return true;\n  };\n\n  LGraph.prototype.triggerInput = function(name, value) {\n      var nodes = this.findNodesByTitle(name);\n      for (var i = 0; i < nodes.length; ++i) {\n          nodes[i].onTrigger(value);\n      }\n  };\n\n  LGraph.prototype.setCallback = function(name, func) {\n      var nodes = this.findNodesByTitle(name);\n      for (var i = 0; i < nodes.length; ++i) {\n          nodes[i].setTrigger(func);\n      }\n  };\n\n  LGraph.prototype.connectionChange = function(node, link_info) {\n      this.updateExecutionOrder();\n      if (this.onConnectionChange) {\n          this.onConnectionChange(node);\n      }\n      this._version++;\n      this.sendActionToCanvas(\"onConnectionChange\");\n  };\n\n  /**\n   * returns if the graph is in live mode\n   * @method isLive\n   */\n\n  LGraph.prototype.isLive = function() {\n      if (!this.list_of_graphcanvas) {\n          return false;\n      }\n\n      for (var i = 0; i < this.list_of_graphcanvas.length; ++i) {\n          var c = this.list_of_graphcanvas[i];\n          if (c.live_mode) {\n              return true;\n          }\n      }\n      return false;\n  };\n\n  /**\n   * clears the triggered slot animation in all links (stop visual animation)\n   * @method clearTriggeredSlots\n   */\n  LGraph.prototype.clearTriggeredSlots = function() {\n      for (var i in this.links) {\n          var link_info = this.links[i];\n          if (!link_info) {\n              continue;\n          }\n          if (link_info._last_time) {\n              link_info._last_time = 0;\n          }\n      }\n  };\n\n  /* Called when something visually changed (not the graph!) */\n  LGraph.prototype.change = function() {\n      if (LiteGraph.debug) {\n          console.log(\"Graph changed\");\n      }\n      this.sendActionToCanvas(\"setDirty\", [true, true]);\n      if (this.on_change) {\n          this.on_change(this);\n      }\n  };\n\n  LGraph.prototype.setDirtyCanvas = function(fg, bg) {\n      this.sendActionToCanvas(\"setDirty\", [fg, bg]);\n  };\n\n  /**\n   * Destroys a link\n   * @method removeLink\n   * @param {Number} link_id\n   */\n  LGraph.prototype.removeLink = function(link_id) {\n      var link = this.links[link_id];\n      if (!link) {\n          return;\n      }\n      var node = this.getNodeById(link.target_id);\n      if (node) {\n          node.disconnectInput(link.target_slot);\n      }\n  };\n\n  //save and recover app state ***************************************\n  /**\n   * Creates a Object containing all the info about this graph, it can be serialized\n   * @method serialize\n   * @return {Object} value of the node\n   */\n  LGraph.prototype.serialize = function() {\n      var nodes_info = [];\n      for (var i = 0, l = this._nodes.length; i < l; ++i) {\n          nodes_info.push(this._nodes[i].serialize());\n      }\n\n      //pack link info into a non-verbose format\n      var links = [];\n      for (var i in this.links) {\n          //links is an OBJECT\n          var link = this.links[i];\n          if (!link.serialize) {\n              //weird bug I havent solved yet\n              console.warn(\n                  \"weird LLink bug, link info is not a LLink but a regular object\"\n              );\n              var link2 = new LLink();\n              for (var i in link) {\n                  link2[i] = link[i];\n              }\n              this.links[i] = link2;\n              link = link2;\n          }\n\n          links.push(link.serialize());\n      }\n\n      var groups_info = [];\n      for (var i = 0; i < this._groups.length; ++i) {\n          groups_info.push(this._groups[i].serialize());\n      }\n\n      var data = {\n          last_node_id: this.last_node_id,\n          last_link_id: this.last_link_id,\n          nodes: nodes_info,\n          links: links,\n          groups: groups_info,\n          config: this.config,\n          version: LiteGraph.VERSION\n      };\n\n      return data;\n  };\n\n  /**\n   * Configure a graph from a JSON string\n   * @method configure\n   * @param {String} str configure a graph from a JSON string\n   * @param {Boolean} returns if there was any error parsing\n   */\n  LGraph.prototype.configure = function(data, keep_old) {\n      if (!data) {\n          return;\n      }\n\n      if (!keep_old) {\n          this.clear();\n      }\n\n      var nodes = data.nodes;\n\n      //decode links info (they are very verbose)\n      if (data.links && data.links.constructor === Array) {\n          var links = [];\n          for (var i = 0; i < data.links.length; ++i) {\n              var link_data = data.links[i];\n      if(!link_data) //weird bug\n      {\n        console.warn(\"serialized graph link data contains errors, skipping.\");\n        continue;\n      }\n              var link = new LLink();\n              link.configure(link_data);\n              links[link.id] = link;\n          }\n          data.links = links;\n      }\n\n      //copy all stored fields\n      for (var i in data) {\n    if(i == \"nodes\" || i == \"groups\")\n      continue;\n          this[i] = data[i];\n      }\n\n      var error = false;\n\n      //create nodes\n      this._nodes = [];\n      if (nodes) {\n          for (var i = 0, l = nodes.length; i < l; ++i) {\n              var n_info = nodes[i]; //stored info\n              var node = LiteGraph.createNode(n_info.type, n_info.title);\n              if (!node) {\n                  if (LiteGraph.debug) {\n                      console.log(\n                          \"Node not found or has errors: \" + n_info.type\n                      );\n                  }\n\n                  //in case of error we create a replacement node to avoid losing info\n                  node = new LGraphNode();\n                  node.last_serialization = n_info;\n                  node.has_errors = true;\n                  error = true;\n                  //continue;\n              }\n\n              node.id = n_info.id; //id it or it will create a new id\n              this.add(node, true); //add before configure, otherwise configure cannot create links\n          }\n\n          //configure nodes afterwards so they can reach each other\n          for (var i = 0, l = nodes.length; i < l; ++i) {\n              var n_info = nodes[i];\n              var node = this.getNodeById(n_info.id);\n              if (node) {\n                  node.configure(n_info);\n              }\n          }\n      }\n\n      //groups\n      this._groups.length = 0;\n      if (data.groups) {\n          for (var i = 0; i < data.groups.length; ++i) {\n              var group = new LiteGraph.LGraphGroup();\n              group.configure(data.groups[i]);\n              this.add(group);\n          }\n      }\n\n      this.updateExecutionOrder();\n      this._version++;\n      this.setDirtyCanvas(true, true);\n      return error;\n  };\n\n  LGraph.prototype.load = function(url) {\n      var that = this;\n      var req = new XMLHttpRequest();\n      req.open(\"GET\", url, true);\n      req.send(null);\n      req.onload = function(oEvent) {\n          if (req.status !== 200) {\n              console.error(\"Error loading graph:\", req.status, req.response);\n              return;\n          }\n          var data = JSON.parse(req.response);\n          that.configure(data);\n      };\n      req.onerror = function(err) {\n          console.error(\"Error loading graph:\", err);\n      };\n  };\n\n  LGraph.prototype.onNodeTrace = function(node, msg, color) {\n      //TODO\n  };\n\n  //this is the class in charge of storing link information\n  function LLink(id, type, origin_id, origin_slot, target_id, target_slot) {\n      this.id = id;\n      this.type = type;\n      this.origin_id = origin_id;\n      this.origin_slot = origin_slot;\n      this.target_id = target_id;\n      this.target_slot = target_slot;\n\n      this._data = null;\n      this._pos = new Float32Array(2); //center\n  }\n\n  LLink.prototype.configure = function(o) {\n      if (o.constructor === Array) {\n          this.id = o[0];\n          this.origin_id = o[1];\n          this.origin_slot = o[2];\n          this.target_id = o[3];\n          this.target_slot = o[4];\n          this.type = o[5];\n      } else {\n          this.id = o.id;\n          this.type = o.type;\n          this.origin_id = o.origin_id;\n          this.origin_slot = o.origin_slot;\n          this.target_id = o.target_id;\n          this.target_slot = o.target_slot;\n      }\n  };\n\n  LLink.prototype.serialize = function() {\n      return [\n          this.id,\n          this.origin_id,\n          this.origin_slot,\n          this.target_id,\n          this.target_slot,\n          this.type\n      ];\n  };\n\n  LiteGraph.LLink = LLink;\n\n  // *************************************************************\n  //   Node CLASS                                          *******\n  // *************************************************************\n\n  /*\ntitle: string\npos: [x,y]\nsize: [x,y]\n\ninput|output: every connection\n  +  { name:string, type:string, pos: [x,y]=Optional, direction: \"input\"|\"output\", links: Array });\n\ngeneral properties:\n  + clip_area: if you render outside the node, it will be clipped\n  + unsafe_execution: not allowed for safe execution\n  + skip_repeated_outputs: when adding new outputs, it wont show if there is one already connected\n  + resizable: if set to false it wont be resizable with the mouse\n  + horizontal: slots are distributed horizontally\n  + widgets_start_y: widgets start at y distance from the top of the node\n\nflags object:\n  + collapsed: if it is collapsed\n\nsupported callbacks:\n  + onAdded: when added to graph (warning: this is called BEFORE the node is configured when loading)\n  + onRemoved: when removed from graph\n  + onStart:\twhen the graph starts playing\n  + onStop:\twhen the graph stops playing\n  + onDrawForeground: render the inside widgets inside the node\n  + onDrawBackground: render the background area inside the node (only in edit mode)\n  + onMouseDown\n  + onMouseMove\n  + onMouseUp\n  + onMouseEnter\n  + onMouseLeave\n  + onExecute: execute the node\n  + onPropertyChanged: when a property is changed in the panel (return true to skip default behaviour)\n  + onGetInputs: returns an array of possible inputs\n  + onGetOutputs: returns an array of possible outputs\n  + onBounding: in case this node has a bigger bounding than the node itself (the callback receives the bounding as [x,y,w,h])\n  + onDblClick: double clicked in the node\n  + onInputDblClick: input slot double clicked (can be used to automatically create a node connected)\n  + onOutputDblClick: output slot double clicked (can be used to automatically create a node connected)\n  + onConfigure: called after the node has been configured\n  + onSerialize: to add extra info when serializing (the callback receives the object that should be filled with the data)\n  + onSelected\n  + onDeselected\n  + onDropItem : DOM item dropped over the node\n  + onDropFile : file dropped over the node\n  + onConnectInput : if returns false the incoming connection will be canceled\n  + onConnectionsChange : a connection changed (new one or removed) (LiteGraph.INPUT or LiteGraph.OUTPUT, slot, true if connected, link_info, input_info )\n  + onAction: action slot triggered\n  + getExtraMenuOptions: to add option to context menu\n*/\n\n  /**\n   * Base Class for all the node type classes\n   * @class LGraphNode\n   * @param {String} name a name for the node\n   */\n\n  function LGraphNode(title) {\n      this._ctor(title);\n  }\n\n  global.LGraphNode = LiteGraph.LGraphNode = LGraphNode;\n\n  LGraphNode.prototype._ctor = function(title) {\n      this.title = title || \"Unnamed\";\n      this.size = [LiteGraph.NODE_WIDTH, 60];\n      this.graph = null;\n\n      this._pos = new Float32Array(10, 10);\n\n      Object.defineProperty(this, \"pos\", {\n          set: function(v) {\n              if (!v || v.length < 2) {\n                  return;\n              }\n              this._pos[0] = v[0];\n              this._pos[1] = v[1];\n          },\n          get: function() {\n              return this._pos;\n          },\n          enumerable: true\n      });\n\n      this.id = -1; //not know till not added\n      this.type = null;\n\n      //inputs available: array of inputs\n      this.inputs = [];\n      this.outputs = [];\n      this.connections = [];\n\n      //local data\n      this.properties = {}; //for the values\n      this.properties_info = []; //for the info\n\n      this.flags = {};\n  };\n\n  /**\n   * configure a node from an object containing the serialized info\n   * @method configure\n   */\n  LGraphNode.prototype.configure = function(info) {\n      if (this.graph) {\n          this.graph._version++;\n      }\n      for (var j in info) {\n          if (j == \"properties\") {\n              //i don't want to clone properties, I want to reuse the old container\n              for (var k in info.properties) {\n                  this.properties[k] = info.properties[k];\n                  if (this.onPropertyChanged) {\n                      this.onPropertyChanged( k, info.properties[k] );\n                  }\n              }\n              continue;\n          }\n\n          if (info[j] == null) {\n              continue;\n          } else if (typeof info[j] == \"object\") {\n              //object\n              if (this[j] && this[j].configure) {\n                  this[j].configure(info[j]);\n              } else {\n                  this[j] = LiteGraph.cloneObject(info[j], this[j]);\n              }\n          } //value\n          else {\n              this[j] = info[j];\n          }\n      }\n\n      if (!info.title) {\n          this.title = this.constructor.title;\n      }\n\n      if (this.onConnectionsChange) {\n          if (this.inputs) {\n              for (var i = 0; i < this.inputs.length; ++i) {\n                  var input = this.inputs[i];\n                  var link_info = this.graph\n                      ? this.graph.links[input.link]\n                      : null;\n                  this.onConnectionsChange(\n                      LiteGraph.INPUT,\n                      i,\n                      true,\n                      link_info,\n                      input\n                  ); //link_info has been created now, so its updated\n              }\n          }\n\n          if (this.outputs) {\n              for (var i = 0; i < this.outputs.length; ++i) {\n                  var output = this.outputs[i];\n                  if (!output.links) {\n                      continue;\n                  }\n                  for (var j = 0; j < output.links.length; ++j) {\n                      var link_info = this.graph\n                          ? this.graph.links[output.links[j]]\n                          : null;\n                      this.onConnectionsChange(\n                          LiteGraph.OUTPUT,\n                          i,\n                          true,\n                          link_info,\n                          output\n                      ); //link_info has been created now, so its updated\n                  }\n              }\n          }\n      }\n\n  if( this.widgets )\n  {\n    for (var i = 0; i < this.widgets.length; ++i)\n    {\n      var w = this.widgets[i];\n      if(w.options && w.options.property && this.properties[ w.options.property ])\n        w.value = JSON.parse( JSON.stringify( this.properties[ w.options.property ] ) );\n    }\n    if (info.widgets_values) {\n      for (var i = 0; i < info.widgets_values.length; ++i) {\n        if (this.widgets[i]) {\n          this.widgets[i].value = info.widgets_values[i];\n        }\n      }\n    }\n  }\n\n      if (this.onConfigure) {\n          this.onConfigure(info);\n      }\n  };\n\n  /**\n   * serialize the content\n   * @method serialize\n   */\n\n  LGraphNode.prototype.serialize = function() {\n      //create serialization object\n      var o = {\n          id: this.id,\n          type: this.type,\n          pos: this.pos,\n          size: this.size,\n          flags: LiteGraph.cloneObject(this.flags),\n    order: this.order,\n          mode: this.mode\n      };\n\n      //special case for when there were errors\n      if (this.constructor === LGraphNode && this.last_serialization) {\n          return this.last_serialization;\n      }\n\n      if (this.inputs) {\n          o.inputs = this.inputs;\n      }\n\n      if (this.outputs) {\n          //clear outputs last data (because data in connections is never serialized but stored inside the outputs info)\n          for (var i = 0; i < this.outputs.length; i++) {\n              delete this.outputs[i]._data;\n          }\n          o.outputs = this.outputs;\n      }\n\n      if (this.title && this.title != this.constructor.title) {\n          o.title = this.title;\n      }\n\n      if (this.properties) {\n          o.properties = LiteGraph.cloneObject(this.properties);\n      }\n\n      if (this.widgets && this.serialize_widgets) {\n          o.widgets_values = [];\n          for (var i = 0; i < this.widgets.length; ++i) {\n              o.widgets_values[i] = this.widgets[i].value;\n          }\n      }\n\n      if (!o.type) {\n          o.type = this.constructor.type;\n      }\n\n      if (this.color) {\n          o.color = this.color;\n      }\n      if (this.bgcolor) {\n          o.bgcolor = this.bgcolor;\n      }\n      if (this.boxcolor) {\n          o.boxcolor = this.boxcolor;\n      }\n      if (this.shape) {\n          o.shape = this.shape;\n      }\n\n      if (this.onSerialize) {\n          if (this.onSerialize(o)) {\n              console.warn(\n                  \"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter\"\n              );\n          }\n      }\n\n      return o;\n  };\n\n  /* Creates a clone of this node */\n  LGraphNode.prototype.clone = function() {\n      var node = LiteGraph.createNode(this.type);\n      if (!node) {\n          return null;\n      }\n\n      //we clone it because serialize returns shared containers\n      var data = LiteGraph.cloneObject(this.serialize());\n\n      //remove links\n      if (data.inputs) {\n          for (var i = 0; i < data.inputs.length; ++i) {\n              data.inputs[i].link = null;\n          }\n      }\n\n      if (data.outputs) {\n          for (var i = 0; i < data.outputs.length; ++i) {\n              if (data.outputs[i].links) {\n                  data.outputs[i].links.length = 0;\n              }\n          }\n      }\n\n      delete data[\"id\"];\n      //remove links\n      node.configure(data);\n\n      return node;\n  };\n\n  /**\n   * serialize and stringify\n   * @method toString\n   */\n\n  LGraphNode.prototype.toString = function() {\n      return JSON.stringify(this.serialize());\n  };\n  //LGraphNode.prototype.deserialize = function(info) {} //this cannot be done from within, must be done in LiteGraph\n\n  /**\n   * get the title string\n   * @method getTitle\n   */\n\n  LGraphNode.prototype.getTitle = function() {\n      return this.title || this.constructor.title;\n  };\n\n  /**\n   * sets the value of a property\n   * @method setProperty\n   * @param {String} name\n   * @param {*} value\n   */\n  LGraphNode.prototype.setProperty = function(name, value) {\n      if (!this.properties) {\n          this.properties = {};\n      }\n  if( value === this.properties[name] )\n    return;\n  var prev_value = this.properties[name];\n      this.properties[name] = value;\n      if (this.onPropertyChanged) {\n          if( this.onPropertyChanged(name, value, prev_value) === false ) //abort change\n      this.properties[name] = prev_value;\n      }\n  };\n\n  // Execution *************************\n  /**\n   * sets the output data\n   * @method setOutputData\n   * @param {number} slot\n   * @param {*} data\n   */\n  LGraphNode.prototype.setOutputData = function(slot, data) {\n      if (!this.outputs) {\n          return;\n      }\n\n      //this maybe slow and a niche case\n      //if(slot && slot.constructor === String)\n      //\tslot = this.findOutputSlot(slot);\n\n      if (slot == -1 || slot >= this.outputs.length) {\n          return;\n      }\n\n      var output_info = this.outputs[slot];\n      if (!output_info) {\n          return;\n      }\n\n      //store data in the output itself in case we want to debug\n      output_info._data = data;\n\n      //if there are connections, pass the data to the connections\n      if (this.outputs[slot].links) {\n          for (var i = 0; i < this.outputs[slot].links.length; i++) {\n              var link_id = this.outputs[slot].links[i];\n      var link = this.graph.links[link_id];\n      if(link)\n        link.data = data;\n          }\n      }\n  };\n\n  /**\n   * sets the output data type, useful when you want to be able to overwrite the data type\n   * @method setOutputDataType\n   * @param {number} slot\n   * @param {String} datatype\n   */\n  LGraphNode.prototype.setOutputDataType = function(slot, type) {\n      if (!this.outputs) {\n          return;\n      }\n      if (slot == -1 || slot >= this.outputs.length) {\n          return;\n      }\n      var output_info = this.outputs[slot];\n      if (!output_info) {\n          return;\n      }\n      //store data in the output itself in case we want to debug\n      output_info.type = type;\n\n      //if there are connections, pass the data to the connections\n      if (this.outputs[slot].links) {\n          for (var i = 0; i < this.outputs[slot].links.length; i++) {\n              var link_id = this.outputs[slot].links[i];\n              this.graph.links[link_id].type = type;\n          }\n      }\n  };\n\n  /**\n   * Retrieves the input data (data traveling through the connection) from one slot\n   * @method getInputData\n   * @param {number} slot\n   * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n   * @return {*} data or if it is not connected returns undefined\n   */\n  LGraphNode.prototype.getInputData = function(slot, force_update) {\n      if (!this.inputs) {\n          return;\n      } //undefined;\n\n      if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n          return;\n      }\n\n      var link_id = this.inputs[slot].link;\n      var link = this.graph.links[link_id];\n      if (!link) {\n          //bug: weird case but it happens sometimes\n          return null;\n      }\n\n      if (!force_update) {\n          return link.data;\n      }\n\n      //special case: used to extract data from the incoming connection before the graph has been executed\n      var node = this.graph.getNodeById(link.origin_id);\n      if (!node) {\n          return link.data;\n      }\n\n      if (node.updateOutputData) {\n          node.updateOutputData(link.origin_slot);\n      } else if (node.onExecute) {\n          node.onExecute();\n      }\n\n      return link.data;\n  };\n\n  /**\n   * Retrieves the input data type (in case this supports multiple input types)\n   * @method getInputDataType\n   * @param {number} slot\n   * @return {String} datatype in string format\n   */\n  LGraphNode.prototype.getInputDataType = function(slot) {\n      if (!this.inputs) {\n          return null;\n      } //undefined;\n\n      if (slot >= this.inputs.length || this.inputs[slot].link == null) {\n          return null;\n      }\n      var link_id = this.inputs[slot].link;\n      var link = this.graph.links[link_id];\n      if (!link) {\n          //bug: weird case but it happens sometimes\n          return null;\n      }\n      var node = this.graph.getNodeById(link.origin_id);\n      if (!node) {\n          return link.type;\n      }\n      var output_info = node.outputs[link.origin_slot];\n      if (output_info) {\n          return output_info.type;\n      }\n      return null;\n  };\n\n  /**\n   * Retrieves the input data from one slot using its name instead of slot number\n   * @method getInputDataByName\n   * @param {String} slot_name\n   * @param {boolean} force_update if set to true it will force the connected node of this slot to output data into this link\n   * @return {*} data or if it is not connected returns null\n   */\n  LGraphNode.prototype.getInputDataByName = function(\n      slot_name,\n      force_update\n  ) {\n      var slot = this.findInputSlot(slot_name);\n      if (slot == -1) {\n          return null;\n      }\n      return this.getInputData(slot, force_update);\n  };\n\n  /**\n   * tells you if there is a connection in one input slot\n   * @method isInputConnected\n   * @param {number} slot\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isInputConnected = function(slot) {\n      if (!this.inputs) {\n          return false;\n      }\n      return slot < this.inputs.length && this.inputs[slot].link != null;\n  };\n\n  LGraphNode.prototype.clearInput = function() {\n    let len = this.inputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeInput(i);\n    }\n  };\n\n  /**\n   * tells you info about an input connection (which node, type, etc)\n   * @method getInputInfo\n   * @param {number} slot\n   * @return {Object} object or null { link: id, name: string, type: string or 0 }\n   */\n  LGraphNode.prototype.getInputInfo = function(slot) {\n      if (!this.inputs) {\n          return null;\n      }\n      if (slot < this.inputs.length) {\n          return this.inputs[slot];\n      }\n      return null;\n  };\n\n  /**\n   * returns the node connected in the input slot\n   * @method getInputNode\n   * @param {number} slot\n   * @return {LGraphNode} node or null\n   */\n  LGraphNode.prototype.getInputNode = function(slot) {\n      if (!this.inputs) {\n          return null;\n      }\n      if (slot >= this.inputs.length) {\n          return null;\n      }\n      var input = this.inputs[slot];\n      if (!input || input.link === null) {\n          return null;\n      }\n      var link_info = this.graph.links[input.link];\n      if (!link_info) {\n          return null;\n      }\n      return this.graph.getNodeById(link_info.origin_id);\n  };\n\n  LGraphNode.prototype.getInputNodeByName = function(name) {\n    let slot = this.findInputSlot(name);\n    if (slot < 0)\n        return null;\n    return this.getInputNode(slot);\n    };\n\n    LGraphNode.prototype.getInputLinkByName = function(name) {\n        let slot = this.findInputSlot(name);\n        if (slot < 0)\n            return null;\n        if (!this.inputs) {\n            return null;\n        }\n        if (slot >= this.inputs.length) {\n            return null;\n        }\n        var input = this.inputs[slot];\n        if (!input || input.link === null) {\n            return null;\n        }\n        var link_info = this.graph.links[input.link];\n        if (!link_info) {\n            return null;\n        }\n        return link_info;\n    };\n\n  /**\n   * returns the value of an input with this name, otherwise checks if there is a property with that name\n   * @method getInputOrProperty\n   * @param {string} name\n   * @return {*} value\n   */\n  LGraphNode.prototype.getInputOrProperty = function(name) {\n      if (!this.inputs || !this.inputs.length) {\n          return this.properties ? this.properties[name] : null;\n      }\n\n      for (var i = 0, l = this.inputs.length; i < l; ++i) {\n          var input_info = this.inputs[i];\n          if (name == input_info.name && input_info.link != null) {\n              var link = this.graph.links[input_info.link];\n              if (link) {\n                  return link.data;\n              }\n          }\n      }\n      return this.properties[name];\n  };\n\n  /**\n   * tells you the last output data that went in that slot\n   * @method getOutputData\n   * @param {number} slot\n   * @return {Object}  object or null\n   */\n  LGraphNode.prototype.getOutputData = function(slot) {\n      if (!this.outputs) {\n          return null;\n      }\n      if (slot >= this.outputs.length) {\n          return null;\n      }\n\n      var info = this.outputs[slot];\n      return info._data;\n  };\n\n  /**\n   * tells you info about an output connection (which node, type, etc)\n   * @method getOutputInfo\n   * @param {number} slot\n   * @return {Object}  object or null { name: string, type: string, links: [ ids of links in number ] }\n   */\n  LGraphNode.prototype.getOutputInfo = function(slot) {\n      if (!this.outputs) {\n          return null;\n      }\n      if (slot < this.outputs.length) {\n          return this.outputs[slot];\n      }\n      return null;\n  };\n\n  /**\n   * tells you if there is a connection in one output slot\n   * @method isOutputConnected\n   * @param {number} slot\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isOutputConnected = function(slot) {\n      if (!this.outputs) {\n          return false;\n      }\n      return (\n          slot < this.outputs.length &&\n          this.outputs[slot].links &&\n          this.outputs[slot].links.length\n      );\n  };\n\n  /**\n   * tells you if there is any connection in the output slots\n   * @method isAnyOutputConnected\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isAnyOutputConnected = function() {\n      if (!this.outputs) {\n          return false;\n      }\n      for (var i = 0; i < this.outputs.length; ++i) {\n          if (this.outputs[i].links && this.outputs[i].links.length) {\n              return true;\n          }\n      }\n      return false;\n  };\n\n  /**\n   * retrieves all the nodes connected to this output slot\n   * @method getOutputNodes\n   * @param {number} slot\n   * @return {array}\n   */\n  LGraphNode.prototype.getOutputNodes = function(slot) {\n      if (!this.outputs || this.outputs.length == 0) {\n          return null;\n      }\n\n      if (slot >= this.outputs.length) {\n          return null;\n      }\n\n      var output = this.outputs[slot];\n      if (!output.links || output.links.length == 0) {\n          return null;\n      }\n\n      var r = [];\n      for (var i = 0; i < output.links.length; i++) {\n          var link_id = output.links[i];\n          var link = this.graph.links[link_id];\n          if (link) {\n              var target_node = this.graph.getNodeById(link.target_id);\n              if (target_node) {\n                  r.push(target_node);\n              }\n          }\n      }\n      return r;\n  };\n\n  /**\n   * Triggers an event in this node, this will trigger any output with the same name\n   * @method trigger\n   * @param {String} event name ( \"on_play\", ... ) if action is equivalent to false then the event is send to all\n   * @param {*} param\n   */\n  LGraphNode.prototype.trigger = function(action, param) {\n      if (!this.outputs || !this.outputs.length) {\n          return;\n      }\n\n      if (this.graph)\n          this.graph._last_trigger_time = LiteGraph.getTime();\n\n      for (var i = 0; i < this.outputs.length; ++i) {\n          var output = this.outputs[i];\n          if ( !output || output.type !== LiteGraph.EVENT || (action && output.name != action) )\n              continue;\n          this.triggerSlot(i, param);\n      }\n  };\n\n  /**\n   * Triggers an slot event in this node\n   * @method triggerSlot\n   * @param {Number} slot the index of the output slot\n   * @param {*} param\n   * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n   */\n  LGraphNode.prototype.triggerSlot = function(slot, param, link_id) {\n      if (!this.outputs) {\n          return;\n      }\n\n      var output = this.outputs[slot];\n      if (!output) {\n          return;\n      }\n\n      var links = output.links;\n      if (!links || !links.length) {\n          return;\n      }\n\n      if (this.graph) {\n          this.graph._last_trigger_time = LiteGraph.getTime();\n      }\n\n      //for every link attached here\n      for (var k = 0; k < links.length; ++k) {\n          var id = links[k];\n          if (link_id != null && link_id != id) {\n              //to skip links\n              continue;\n          }\n          var link_info = this.graph.links[links[k]];\n          if (!link_info) {\n              //not connected\n              continue;\n          }\n          link_info._last_time = LiteGraph.getTime();\n          var node = this.graph.getNodeById(link_info.target_id);\n          if (!node) {\n              //node not found?\n              continue;\n          }\n\n          //used to mark events in graph\n          var target_connection = node.inputs[link_info.target_slot];\n\n          if (node.onAction) {\n              node.onAction(target_connection.name, param);\n          } else if (node.mode === LiteGraph.ON_TRIGGER) {\n              if (node.onExecute) {\n                  node.onExecute(param);\n              }\n          }\n      }\n  };\n\n  /**\n   * clears the trigger slot animation\n   * @method clearTriggeredSlot\n   * @param {Number} slot the index of the output slot\n   * @param {Number} link_id [optional] in case you want to trigger and specific output link in a slot\n   */\n  LGraphNode.prototype.clearTriggeredSlot = function(slot, link_id) {\n      if (!this.outputs) {\n          return;\n      }\n\n      var output = this.outputs[slot];\n      if (!output) {\n          return;\n      }\n\n      var links = output.links;\n      if (!links || !links.length) {\n          return;\n      }\n\n      //for every link attached here\n      for (var k = 0; k < links.length; ++k) {\n          var id = links[k];\n          if (link_id != null && link_id != id) {\n              //to skip links\n              continue;\n          }\n          var link_info = this.graph.links[links[k]];\n          if (!link_info) {\n              //not connected\n              continue;\n          }\n          link_info._last_time = 0;\n      }\n  };\n\n  /**\n   * add a new property to this node\n   * @method addProperty\n   * @param {string} name\n   * @param {*} default_value\n   * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n   * @param {Object} extra_info this can be used to have special properties of the property (like values, etc)\n   */\n  LGraphNode.prototype.addProperty = function(\n      name,\n      default_value,\n      type,\n      extra_info\n  ) {\n      var o = { name: name, type: type, default_value: default_value };\n      if (extra_info) {\n          for (var i in extra_info) {\n              o[i] = extra_info[i];\n          }\n      }\n      if (!this.properties_info) {\n          this.properties_info = [];\n      }\n      this.properties_info.push(o);\n      if (!this.properties) {\n          this.properties = {};\n      }\n      this.properties[name] = default_value;\n      return o;\n  };\n\n  //connections\n\n  /**\n   * add a new output slot to use in this node\n   * @method addOutput\n   * @param {string} name\n   * @param {string} type string defining the output type (\"vec3\",\"number\",...)\n   * @param {Object} extra_info this can be used to have special properties of an output (label, special color, position, etc)\n   */\n  LGraphNode.prototype.addOutput = function(name, type, extra_info) {\n      var o = { name: name, type: type, links: null };\n      if (extra_info) {\n          for (var i in extra_info) {\n              o[i] = extra_info[i];\n          }\n      }\n\n      if (!this.outputs) {\n          this.outputs = [];\n      }\n      this.outputs.push(o);\n      if (this.onOutputAdded) {\n          this.onOutputAdded(o);\n      }\n      this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n      return o;\n  };\n\n  /**\n   * add a new output slot to use in this node\n   * @method addOutputs\n   * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n   */\n  LGraphNode.prototype.addOutputs = function(array) {\n      for (var i = 0; i < array.length; ++i) {\n          var info = array[i];\n          var o = { name: info[0], type: info[1], link: null };\n          if (array[2]) {\n              for (var j in info[2]) {\n                  o[j] = info[2][j];\n              }\n          }\n\n          if (!this.outputs) {\n              this.outputs = [];\n          }\n          this.outputs.push(o);\n          if (this.onOutputAdded) {\n              this.onOutputAdded(o);\n          }\n      }\n\n      this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * remove an existing output slot\n   * @method removeOutput\n   * @param {number} slot\n   */\n  LGraphNode.prototype.removeOutput = function(slot) {\n      this.disconnectOutput(slot);\n      this.outputs.splice(slot, 1);\n      for (var i = slot; i < this.outputs.length; ++i) {\n          if (!this.outputs[i] || !this.outputs[i].links) {\n              continue;\n          }\n          var links = this.outputs[i].links;\n          for (var j = 0; j < links.length; ++j) {\n              var link = this.graph.links[links[j]];\n              if (!link) {\n                  continue;\n              }\n              link.origin_slot -= 1;\n          }\n      }\n\n      this.size = this.computeSize();\n      if (this.onOutputRemoved) {\n          this.onOutputRemoved(slot);\n      }\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * add a new input slot to use in this node\n   * @method addInput\n   * @param {string} name\n   * @param {string} type string defining the input type (\"vec3\",\"number\",...), it its a generic one use 0\n   * @param {Object} extra_info this can be used to have special properties of an input (label, color, position, etc)\n   */\n  LGraphNode.prototype.addInput = function(name, type, extra_info) {\n      type = type || 0;\n      var o = { name: name, type: type, link: null };\n      if (extra_info) {\n          for (var i in extra_info) {\n              o[i] = extra_info[i];\n          }\n      }\n\n      if (!this.inputs) {\n          this.inputs = [];\n      }\n      this.inputs.push(o);\n      this.size = this.computeSize();\n      if (this.onInputAdded) {\n          this.onInputAdded(o);\n      }\n      this.setDirtyCanvas(true, true);\n      return o;\n  };\n\n  /**\n   * add several new input slots in this node\n   * @method addInputs\n   * @param {Array} array of triplets like [[name,type,extra_info],[...]]\n   */\n  LGraphNode.prototype.addInputs = function(array) {\n      for (var i = 0; i < array.length; ++i) {\n          var info = array[i];\n          var o = { name: info[0], type: info[1], link: null };\n          if (array[2]) {\n              for (var j in info[2]) {\n                  o[j] = info[2][j];\n              }\n          }\n\n          if (!this.inputs) {\n              this.inputs = [];\n          }\n          this.inputs.push(o);\n          if (this.onInputAdded) {\n              this.onInputAdded(o);\n          }\n      }\n\n      this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * remove an existing input slot\n   * @method removeInput\n   * @param {number} slot\n   */\n  LGraphNode.prototype.removeInput = function(slot) {\n      this.disconnectInput(slot);\n      this.inputs.splice(slot, 1);\n      for (var i = slot; i < this.inputs.length; ++i) {\n          if (!this.inputs[i]) {\n              continue;\n          }\n          var link = this.graph.links[this.inputs[i].link];\n          if (!link) {\n              continue;\n          }\n          link.target_slot -= 1;\n      }\n      this.size = this.computeSize();\n      if (this.onInputRemoved) {\n          this.onInputRemoved(slot);\n      }\n      this.setDirtyCanvas(true, true);\n  };\n\n  LGraphNode.prototype.removeInputByName = function(name) {\n        let slot = -1;\n        for (var i = 0; i < this.inputs.length; ++i) {\n            if (this.inputs[i].name == name)\n                slot = i;\n        }\n        if (slot < 0)\n            return;\n        this.removeInput(slot);\n    };\n\n    LGraphNode.prototype.removeOutputByName = function(name) {\n        let slot = -1;\n        for (var i = 0; i < this.inputs.length; ++i) {\n            if (this.inputs[i].name == name)\n                slot = i;\n        }\n        if (slot < 0)\n            return;\n        this.removeOutput(slot);\n    };\n\n  /**\n   * add an special connection to this node (used for special kinds of graphs)\n   * @method addConnection\n   * @param {string} name\n   * @param {string} type string defining the input type (\"vec3\",\"number\",...)\n   * @param {[x,y]} pos position of the connection inside the node\n   * @param {string} direction if is input or output\n   */\n  LGraphNode.prototype.addConnection = function(name, type, pos, direction) {\n      var o = {\n          name: name,\n          type: type,\n          pos: pos,\n          direction: direction,\n          links: null\n      };\n      this.connections.push(o);\n      return o;\n  };\n\n  /**\n   * computes the size of a node according to its inputs and output slots\n   * @method computeSize\n   * @param {number} minHeight\n   * @return {number} the total size\n   */\n  LGraphNode.prototype.computeSize = function(minHeight, out) {\n      if (this.constructor.size) {\n          return this.constructor.size.concat();\n      }\n\n      var rows = Math.max(\n          this.inputs ? this.inputs.length : 1,\n          this.outputs ? this.outputs.length : 1\n      );\n      var size = out || new Float32Array([0, 0]);\n      rows = Math.max(rows, 1);\n      var font_size = LiteGraph.NODE_TEXT_SIZE; //although it should be graphcanvas.inner_text_font size\n      size[1] = (this.constructor.slot_start_y || 0) + rows * LiteGraph.NODE_SLOT_HEIGHT;\n\n      var widgets_height = 0;\n      if (this.widgets && this.widgets.length) {\n          widgets_height = this.widgets.length * (LiteGraph.NODE_WIDGET_HEIGHT + 4) + 8;\n      }\n\n  //compute height using widgets height\n  if( this.widgets_up )\n          size[1] = Math.max( size[1], widgets_height );\n  else if( this.widgets_start_y != null )\n          size[1] = Math.max( size[1], widgets_height + this.widgets_start_y );\n  else\n          size[1] += widgets_height;\n\n      var font_size = font_size;\n      var title_width = compute_text_size(this.title);\n      var input_width = 0;\n      var output_width = 0;\n\n      if (this.inputs) {\n          for (var i = 0, l = this.inputs.length; i < l; ++i) {\n              var input = this.inputs[i];\n              var text = input.label || input.name || \"\";\n              var text_width = compute_text_size(text);\n              if (input_width < text_width) {\n                  input_width = text_width;\n              }\n          }\n      }\n\n      if (this.outputs) {\n          for (var i = 0, l = this.outputs.length; i < l; ++i) {\n              var output = this.outputs[i];\n              var text = output.label || output.name || \"\";\n              var text_width = compute_text_size(text);\n              if (output_width < text_width) {\n                  output_width = text_width;\n              }\n          }\n      }\n\n      size[0] = Math.max(input_width + output_width + 10, title_width);\n      size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH);\n      if (this.widgets && this.widgets.length) {\n          size[0] = Math.max(size[0], LiteGraph.NODE_WIDTH * 1.5);\n      }\n\n      if (this.onResize) {\n          this.onResize(size);\n      }\n\n      function compute_text_size(text) {\n          if (!text) {\n              return 0;\n          }\n          return font_size * text.length * 0.6;\n      }\n\n      if (\n          this.constructor.min_height &&\n          size[1] < this.constructor.min_height\n      ) {\n          size[1] = this.constructor.min_height;\n      }\n\n      size[1] += 6; //margin\n\n      return size;\n  };\n\n  /**\n   * Allows to pass\n   *\n   * @method addWidget\n   * @param {String} type the widget type (could be \"number\",\"string\",\"combo\"\n   * @param {String} name the text to show on the widget\n   * @param {String} value the default value\n   * @param {Function} callback function to call when it changes (optionally, it can be the name of the property to modify)\n   * @param {Object} options the object that contains special properties of this widget \n   * @return {Object} the created widget object\n   */\n  LGraphNode.prototype.addWidget = function( type, name, value, callback, options )\n{\n      if (!this.widgets) {\n          this.widgets = [];\n      }\n\n  if(!options && callback && callback.constructor === Object)\n  {\n    options = callback;\n    callback = null;\n  }\n\n  if(options && options.constructor === String) //options can be the property name\n    options = { property: options };\n\n  if(callback && callback.constructor === String) //callback can be the property name\n  {\n    if(!options)\n      options = {};\n    options.property = callback;\n    callback = null;\n  }\n\n  if(callback && callback.constructor !== Function)\n  {\n    console.warn(\"addWidget: callback must be a function\");\n    callback = null;\n  }\n\n      var w = {\n          type: type.toLowerCase(),\n          name: name,\n          value: value,\n          callback: callback,\n          options: options || {}\n      };\n\n      if (w.options.y !== undefined) {\n          w.y = w.options.y;\n      }\n\n      if (!callback && !w.options.callback && !w.options.property) {\n          console.warn(\"LiteGraph addWidget(...) without a callback or property assigned\");\n      }\n      if (type == \"combo\" && !w.options.values) {\n          throw \"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }\";\n      }\n      this.widgets.push(w);\n  this.size = this.computeSize();\n      this.setDirtyCanvas(true, true);\n      return w;\n  };\n\n  LGraphNode.prototype.addCustomWidget = function(custom_widget) {\n      if (!this.widgets) {\n          this.widgets = [];\n      }\n      this.widgets.push(custom_widget);\n      return custom_widget;\n  };\n\n  /**\n   * returns the bounding of the object, used for rendering purposes\n   * bounding is: [topleft_cornerx, topleft_cornery, width, height]\n   * @method getBounding\n   * @return {Float32Array[4]} the total size\n   */\n  LGraphNode.prototype.getBounding = function(out) {\n      out = out || new Float32Array(4);\n      out[0] = this.pos[0] - 4;\n      out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n      out[2] = this.size[0] + 4;\n      out[3] = this.size[1] + LiteGraph.NODE_TITLE_HEIGHT;\n\n      if (this.onBounding) {\n          this.onBounding(out);\n      }\n      return out;\n  };\n\n  /**\n   * checks if a point is inside the shape of a node\n   * @method isPointInside\n   * @param {number} x\n   * @param {number} y\n   * @return {boolean}\n   */\n  LGraphNode.prototype.isPointInside = function(x, y, margin, skip_title) {\n      margin = margin || 0;\n\n      var margin_top = this.graph && this.graph.isLive() ? 0 : LiteGraph.NODE_TITLE_HEIGHT;\n      if (skip_title) {\n          margin_top = 0;\n      }\n      if (this.flags && this.flags.collapsed) {\n          //if ( distance([x,y], [this.pos[0] + this.size[0]*0.5, this.pos[1] + this.size[1]*0.5]) < LiteGraph.NODE_COLLAPSED_RADIUS)\n          if (\n              isInsideRectangle(\n                  x,\n                  y,\n                  this.pos[0] - margin,\n                  this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT - margin,\n                  (this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH) +\n                      2 * margin,\n                  LiteGraph.NODE_TITLE_HEIGHT + 2 * margin\n              )\n          ) {\n              return true;\n          }\n      } else if (\n          this.pos[0] - 4 - margin < x &&\n          this.pos[0] + this.size[0] + 4 + margin > x &&\n          this.pos[1] - margin_top - margin < y &&\n          this.pos[1] + this.size[1] + margin > y\n      ) {\n          return true;\n      }\n      return false;\n  };\n\n  /**\n   * checks if a point is inside a node slot, and returns info about which slot\n   * @method getSlotInPosition\n   * @param {number} x\n   * @param {number} y\n   * @return {Object} if found the object contains { input|output: slot object, slot: number, link_pos: [x,y] }\n   */\n  LGraphNode.prototype.getSlotInPosition = function(x, y) {\n      //search for inputs\n      var link_pos = new Float32Array(2);\n      if (this.inputs) {\n          for (var i = 0, l = this.inputs.length; i < l; ++i) {\n              var input = this.inputs[i];\n              this.getConnectionPos(true, i, link_pos);\n              if (\n                  isInsideRectangle(\n                      x,\n                      y,\n                      link_pos[0] - 10,\n                      link_pos[1] - 5,\n                      20,\n                      10\n                  )\n              ) {\n                  return { input: input, slot: i, link_pos: link_pos };\n              }\n          }\n      }\n\n      if (this.outputs) {\n          for (var i = 0, l = this.outputs.length; i < l; ++i) {\n              var output = this.outputs[i];\n              this.getConnectionPos(false, i, link_pos);\n              if (\n                  isInsideRectangle(\n                      x,\n                      y,\n                      link_pos[0] - 10,\n                      link_pos[1] - 5,\n                      20,\n                      10\n                  )\n              ) {\n                  return { output: output, slot: i, link_pos: link_pos };\n              }\n          }\n      }\n\n      return null;\n  };\n\n  /**\n   * returns the input slot with a given name (used for dynamic slots), -1 if not found\n   * @method findInputSlot\n   * @param {string} name the name of the slot\n   * @return {number} the slot (-1 if not found)\n   */\n  LGraphNode.prototype.findInputSlot = function(name) {\n      if (!this.inputs) {\n          return -1;\n      }\n      for (var i = 0, l = this.inputs.length; i < l; ++i) {\n          if (name == this.inputs[i].name) {\n              return i;\n          }\n      }\n      return -1;\n  };\n\n  /**\n   * returns the output slot with a given name (used for dynamic slots), -1 if not found\n   * @method findOutputSlot\n   * @param {string} name the name of the slot\n   * @return {number} the slot (-1 if not found)\n   */\n  LGraphNode.prototype.findOutputSlot = function(name) {\n      if (!this.outputs) {\n          return -1;\n      }\n      for (var i = 0, l = this.outputs.length; i < l; ++i) {\n          if (name == this.outputs[i].name) {\n              return i;\n          }\n      }\n      return -1;\n  };\n\n  /**\n   * connect this node output to the input of another node\n   * @method connect\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @param {LGraphNode} node the target node\n   * @param {number_or_string} target_slot the input slot of the target node (could be the number of the slot or the string with the name of the slot, or -1 to connect a trigger)\n   * @return {Object} the link_info is created, otherwise null\n   */\n  LGraphNode.prototype.connect = function(slot, target_node, target_slot) {\n      target_slot = target_slot || 0;\n\n      if (!this.graph) {\n          //could be connected before adding it to a graph\n          console.log(\n              \"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them.\"\n          ); //due to link ids being associated with graphs\n          return null;\n      }\n\n      //seek for the output slot\n      if (slot.constructor === String) {\n          slot = this.findOutputSlot(slot);\n          if (slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\"Connect: Error, no slot of name \" + slot);\n              }\n              return null;\n          }\n      } else if (!this.outputs || slot >= this.outputs.length) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return null;\n      }\n\n      if (target_node && target_node.constructor === Number) {\n          target_node = this.graph.getNodeById(target_node);\n      }\n      if (!target_node) {\n          throw \"target node is null\";\n      }\n\n      //avoid loopback\n      if (target_node == this) {\n          return null;\n      }\n\n      //you can specify the slot by name\n      if (target_slot.constructor === String) {\n          target_slot = target_node.findInputSlot(target_slot);\n          if (target_slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\n                      \"Connect: Error, no slot of name \" + target_slot\n                  );\n              }\n              return null;\n          }\n      } else if (target_slot === LiteGraph.EVENT) {\n          //search for first slot with event?\n          /*\n  //create input for trigger\n  var input = target_node.addInput(\"onTrigger\", LiteGraph.EVENT );\n  target_slot = target_node.inputs.length - 1; //last one is the one created\n  target_node.mode = LiteGraph.ON_TRIGGER;\n  */\n          return null;\n      } else if (\n          !target_node.inputs ||\n          target_slot >= target_node.inputs.length\n      ) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return null;\n      }\n\n      //if there is something already plugged there, disconnect\n      if (target_node.inputs[target_slot].link != null) {\n          target_node.disconnectInput(target_slot);\n      }\n\n      //why here??\n      //this.setDirtyCanvas(false,true);\n      //this.graph.connectionChange( this );\n\n      var output = this.outputs[slot];\n\n      //allows nodes to block connection\n      if (target_node.onConnectInput) {\n          if (\n              target_node.onConnectInput(target_slot, output.type, output) ===\n              false\n          ) {\n              return null;\n          }\n      }\n\n      var input = target_node.inputs[target_slot];\n      var link_info = null;\n\n      if (LiteGraph.isValidConnection(output.type, input.type)) {\n          link_info = new LLink(\n              ++this.graph.last_link_id,\n              input.type,\n              this.id,\n              slot,\n              target_node.id,\n              target_slot\n          );\n\n          //add to graph links list\n          this.graph.links[link_info.id] = link_info;\n\n          //connect in output\n          if (output.links == null) {\n              output.links = [];\n          }\n          output.links.push(link_info.id);\n          //connect in input\n          target_node.inputs[target_slot].link = link_info.id;\n          if (this.graph) {\n              this.graph._version++;\n          }\n          if (this.onConnectionsChange) {\n              this.onConnectionsChange(\n                  LiteGraph.OUTPUT,\n                  slot,\n                  true,\n                  link_info,\n                  output\n              );\n          } //link_info has been created now, so its updated\n          if (target_node.onConnectionsChange) {\n              target_node.onConnectionsChange(\n                  LiteGraph.INPUT,\n                  target_slot,\n                  true,\n                  link_info,\n                  input\n              );\n          }\n          if (this.graph && this.graph.onNodeConnectionChange) {\n              this.graph.onNodeConnectionChange(\n                  LiteGraph.INPUT,\n                  target_node,\n                  target_slot,\n                  this,\n                  slot\n              );\n              this.graph.onNodeConnectionChange(\n                  LiteGraph.OUTPUT,\n                  this,\n                  slot,\n                  target_node,\n                  target_slot\n              );\n          }\n      }\n\n      this.setDirtyCanvas(false, true);\n      this.graph.connectionChange(this, link_info);\n\n      return link_info;\n  };\n\n  /**\n   * disconnect one output to an specific node\n   * @method disconnectOutput\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @param {LGraphNode} target_node the target node to which this slot is connected [Optional, if not target_node is specified all nodes will be disconnected]\n   * @return {boolean} if it was disconnected successfully\n   */\n  LGraphNode.prototype.disconnectOutput = function(slot, target_node) {\n      if (slot.constructor === String) {\n          slot = this.findOutputSlot(slot);\n          if (slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\"Connect: Error, no slot of name \" + slot);\n              }\n              return false;\n          }\n      } else if (!this.outputs || slot >= this.outputs.length) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return false;\n      }\n\n      //get output slot\n      var output = this.outputs[slot];\n      if (!output || !output.links || output.links.length == 0) {\n          return false;\n      }\n\n      //one of the output links in this slot\n      if (target_node) {\n          if (target_node.constructor === Number) {\n              target_node = this.graph.getNodeById(target_node);\n          }\n          if (!target_node) {\n              throw \"Target Node not found\";\n          }\n\n          for (var i = 0, l = output.links.length; i < l; i++) {\n              var link_id = output.links[i];\n              var link_info = this.graph.links[link_id];\n\n              //is the link we are searching for...\n              if (link_info.target_id == target_node.id) {\n                  output.links.splice(i, 1); //remove here\n                  var input = target_node.inputs[link_info.target_slot];\n                  input.link = null; //remove there\n                  delete this.graph.links[link_id]; //remove the link from the links pool\n                  if (this.graph) {\n                      this.graph._version++;\n                  }\n                  if (target_node.onConnectionsChange) {\n                      target_node.onConnectionsChange(\n                          LiteGraph.INPUT,\n                          link_info.target_slot,\n                          false,\n                          link_info,\n                          input\n                      );\n                  } //link_info hasn't been modified so its ok\n                  if (this.onConnectionsChange) {\n                      this.onConnectionsChange(\n                          LiteGraph.OUTPUT,\n                          slot,\n                          false,\n                          link_info,\n                          output\n                      );\n                  }\n                  if (this.graph && this.graph.onNodeConnectionChange) {\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.OUTPUT,\n                          this,\n                          slot\n                      );\n                  }\n                  if (this.graph && this.graph.onNodeConnectionChange) {\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.OUTPUT,\n                          this,\n                          slot\n                      );\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.INPUT,\n                          target_node,\n                          link_info.target_slot\n                      );\n                  }\n                  break;\n              }\n          }\n      } //all the links in this output slot\n      else {\n          for (var i = 0, l = output.links.length; i < l; i++) {\n              var link_id = output.links[i];\n              var link_info = this.graph.links[link_id];\n              if (!link_info) {\n                  //bug: it happens sometimes\n                  continue;\n              }\n\n              var target_node = this.graph.getNodeById(link_info.target_id);\n              var input = null;\n              if (this.graph) {\n                  this.graph._version++;\n              }\n              if (target_node) {\n                  input = target_node.inputs[link_info.target_slot];\n                  input.link = null; //remove other side link\n                  if (target_node.onConnectionsChange) {\n                      target_node.onConnectionsChange(\n                          LiteGraph.INPUT,\n                          link_info.target_slot,\n                          false,\n                          link_info,\n                          input\n                      );\n                  } //link_info hasn't been modified so its ok\n                  if (this.graph && this.graph.onNodeConnectionChange) {\n                      this.graph.onNodeConnectionChange(\n                          LiteGraph.INPUT,\n                          target_node,\n                          link_info.target_slot\n                      );\n                  }\n              }\n              delete this.graph.links[link_id]; //remove the link from the links pool\n              if (this.onConnectionsChange) {\n                  this.onConnectionsChange(\n                      LiteGraph.OUTPUT,\n                      slot,\n                      false,\n                      link_info,\n                      output\n                  );\n              }\n              if (this.graph && this.graph.onNodeConnectionChange) {\n                  this.graph.onNodeConnectionChange(\n                      LiteGraph.OUTPUT,\n                      this,\n                      slot\n                  );\n                  this.graph.onNodeConnectionChange(\n                      LiteGraph.INPUT,\n                      target_node,\n                      link_info.target_slot\n                  );\n              }\n          }\n          output.links = null;\n      }\n\n      this.setDirtyCanvas(false, true);\n      this.graph.connectionChange(this);\n      return true;\n  };\n\n  /**\n   * disconnect one input\n   * @method disconnectInput\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @return {boolean} if it was disconnected successfully\n   */\n  LGraphNode.prototype.disconnectInput = function(slot) {\n      //seek for the output slot\n      if (slot.constructor === String) {\n          slot = this.findInputSlot(slot);\n          if (slot == -1) {\n              if (LiteGraph.debug) {\n                  console.log(\"Connect: Error, no slot of name \" + slot);\n              }\n              return false;\n          }\n      } else if (!this.inputs || slot >= this.inputs.length) {\n          if (LiteGraph.debug) {\n              console.log(\"Connect: Error, slot number not found\");\n          }\n          return false;\n      }\n\n      var input = this.inputs[slot];\n      if (!input) {\n          return false;\n      }\n\n      var link_id = this.inputs[slot].link;\n      this.inputs[slot].link = null;\n\n      //remove other side\n      var link_info = this.graph.links[link_id];\n      if (link_info) {\n          var target_node = this.graph.getNodeById(link_info.origin_id);\n          if (!target_node) {\n              return false;\n          }\n\n          var output = target_node.outputs[link_info.origin_slot];\n          if (!output || !output.links || output.links.length == 0) {\n              return false;\n          }\n\n          //search in the inputs list for this link\n          for (var i = 0, l = output.links.length; i < l; i++) {\n              if (output.links[i] == link_id) {\n                  output.links.splice(i, 1);\n                  break;\n              }\n          }\n\n          delete this.graph.links[link_id]; //remove from the pool\n          if (this.graph) {\n              this.graph._version++;\n          }\n          if (this.onConnectionsChange) {\n              this.onConnectionsChange(\n                  LiteGraph.INPUT,\n                  slot,\n                  false,\n                  link_info,\n                  input\n              );\n          }\n          if (target_node.onConnectionsChange) {\n              target_node.onConnectionsChange(\n                  LiteGraph.OUTPUT,\n                  i,\n                  false,\n                  link_info,\n                  output\n              );\n          }\n          if (this.graph && this.graph.onNodeConnectionChange) {\n              this.graph.onNodeConnectionChange(\n                  LiteGraph.OUTPUT,\n                  target_node,\n                  i\n              );\n              this.graph.onNodeConnectionChange(LiteGraph.INPUT, this, slot);\n          }\n      }\n\n      this.setDirtyCanvas(false, true);\n      this.graph.connectionChange(this);\n      return true;\n  };\n\n  /**\n   * returns the center of a connection point in canvas coords\n   * @method getConnectionPos\n   * @param {boolean} is_input true if if a input slot, false if it is an output\n   * @param {number_or_string} slot (could be the number of the slot or the string with the name of the slot)\n   * @param {vec2} out [optional] a place to store the output, to free garbage\n   * @return {[x,y]} the position\n   **/\n  LGraphNode.prototype.getConnectionPos = function(\n      is_input,\n      slot_number,\n      out\n  ) {\n      out = out || new Float32Array(2);\n      var num_slots = 0;\n      if (is_input && this.inputs) {\n          num_slots = this.inputs.length;\n      }\n      if (!is_input && this.outputs) {\n          num_slots = this.outputs.length;\n      }\n\n      var offset = LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n\n      if (this.flags.collapsed) {\n          var w = this._collapsed_width || LiteGraph.NODE_COLLAPSED_WIDTH;\n          if (this.horizontal) {\n              out[0] = this.pos[0] + w * 0.5;\n              if (is_input) {\n                  out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n              } else {\n                  out[1] = this.pos[1];\n              }\n          } else {\n              if (is_input) {\n                  out[0] = this.pos[0];\n              } else {\n                  out[0] = this.pos[0] + w;\n              }\n              out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n          }\n          return out;\n      }\n\n      //weird feature that never got finished\n      if (is_input && slot_number == -1) {\n          out[0] = this.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n          out[1] = this.pos[1] + LiteGraph.NODE_TITLE_HEIGHT * 0.5;\n          return out;\n      }\n\n      //hard-coded pos\n      if (\n          is_input &&\n          num_slots > slot_number &&\n          this.inputs[slot_number].pos\n      ) {\n          out[0] = this.pos[0] + this.inputs[slot_number].pos[0];\n          out[1] = this.pos[1] + this.inputs[slot_number].pos[1];\n          return out;\n      } else if (\n          !is_input &&\n          num_slots > slot_number &&\n          this.outputs[slot_number].pos\n      ) {\n          out[0] = this.pos[0] + this.outputs[slot_number].pos[0];\n          out[1] = this.pos[1] + this.outputs[slot_number].pos[1];\n          return out;\n      }\n\n      //horizontal distributed slots\n      if (this.horizontal) {\n          out[0] =\n              this.pos[0] + (slot_number + 0.5) * (this.size[0] / num_slots);\n          if (is_input) {\n              out[1] = this.pos[1] - LiteGraph.NODE_TITLE_HEIGHT;\n          } else {\n              out[1] = this.pos[1] + this.size[1];\n          }\n          return out;\n      }\n\n      //default vertical slots\n      if (is_input) {\n          out[0] = this.pos[0] + offset;\n      } else {\n          out[0] = this.pos[0] + this.size[0] + 1 - offset;\n      }\n      out[1] =\n          this.pos[1] +\n          (slot_number + 0.7) * LiteGraph.NODE_SLOT_HEIGHT +\n          (this.constructor.slot_start_y || 0);\n      return out;\n  };\n\n  /* Force align to grid */\n  LGraphNode.prototype.alignToGrid = function() {\n      this.pos[0] =\n          LiteGraph.CANVAS_GRID_SIZE *\n          Math.round(this.pos[0] / LiteGraph.CANVAS_GRID_SIZE);\n      this.pos[1] =\n          LiteGraph.CANVAS_GRID_SIZE *\n          Math.round(this.pos[1] / LiteGraph.CANVAS_GRID_SIZE);\n  };\n\n  /* Console output */\n  LGraphNode.prototype.trace = function(msg) {\n      if (!this.console) {\n          this.console = [];\n      }\n      this.console.push(msg);\n      if (this.console.length > LGraphNode.MAX_CONSOLE) {\n          this.console.shift();\n      }\n\n      this.graph.onNodeTrace(this, msg);\n  };\n\n  /* Forces to redraw or the main canvas (LGraphNode) or the bg canvas (links) */\n  LGraphNode.prototype.setDirtyCanvas = function(\n      dirty_foreground,\n      dirty_background\n  ) {\n      if (!this.graph) {\n          return;\n      }\n      this.graph.sendActionToCanvas(\"setDirty\", [\n          dirty_foreground,\n          dirty_background\n      ]);\n  };\n\n  LGraphNode.prototype.loadImage = function(url) {\n      var img = new Image();\n      img.src = LiteGraph.node_images_path + url;\n      img.ready = false;\n\n      var that = this;\n      img.onload = function() {\n          this.ready = true;\n          that.setDirtyCanvas(true);\n      };\n      return img;\n  };\n\n  //safe LGraphNode action execution (not sure if safe)\n  /*\nLGraphNode.prototype.executeAction = function(action)\n{\nif(action == \"\") return false;\n\nif( action.indexOf(\";\") != -1 || action.indexOf(\"}\") != -1)\n{\n  this.trace(\"Error: Action contains unsafe characters\");\n  return false;\n}\n\nvar tokens = action.split(\"(\");\nvar func_name = tokens[0];\nif( typeof(this[func_name]) != \"function\")\n{\n  this.trace(\"Error: Action not found on node: \" + func_name);\n  return false;\n}\n\nvar code = action;\n\ntry\n{\n  var _foo = eval;\n  eval = null;\n  (new Function(\"with(this) { \" + code + \"}\")).call(this);\n  eval = _foo;\n}\ncatch (err)\n{\n  this.trace(\"Error executing action {\" + action + \"} :\" + err);\n  return false;\n}\n\nreturn true;\n}\n*/\n\n  /* Allows to get onMouseMove and onMouseUp events even if the mouse is out of focus */\n  LGraphNode.prototype.captureInput = function(v) {\n      if (!this.graph || !this.graph.list_of_graphcanvas) {\n          return;\n      }\n\n      var list = this.graph.list_of_graphcanvas;\n\n      for (var i = 0; i < list.length; ++i) {\n          var c = list[i];\n          //releasing somebody elses capture?!\n          if (!v && c.node_capturing_input != this) {\n              continue;\n          }\n\n          //change\n          c.node_capturing_input = v ? this : null;\n      }\n  };\n\n  /**\n   * Collapse the node to make it smaller on the canvas\n   * @method collapse\n   **/\n  LGraphNode.prototype.collapse = function(force) {\n      this.graph._version++;\n      if (this.constructor.collapsable === false && !force) {\n          return;\n      }\n      if (!this.flags.collapsed) {\n          this.flags.collapsed = true;\n      } else {\n          this.flags.collapsed = false;\n      }\n      this.setDirtyCanvas(true, true);\n  };\n\n  /**\n   * Forces the node to do not move or realign on Z\n   * @method pin\n   **/\n\n  LGraphNode.prototype.pin = function(v) {\n      this.graph._version++;\n      if (v === undefined) {\n          this.flags.pinned = !this.flags.pinned;\n      } else {\n          this.flags.pinned = v;\n      }\n  };\n\n  LGraphNode.prototype.localToScreen = function(x, y, graphcanvas) {\n      return [\n          (x + this.pos[0]) * graphcanvas.scale + graphcanvas.offset[0],\n          (y + this.pos[1]) * graphcanvas.scale + graphcanvas.offset[1]\n      ];\n  };\n\n  function LGraphGroup(title) {\n      this._ctor(title);\n  }\n\n  global.LGraphGroup = LiteGraph.LGraphGroup = LGraphGroup;\n\n  LGraphGroup.prototype._ctor = function(title) {\n      this.title = title || \"Group\";\n      this.font_size = 24;\n      this.color = LGraphCanvas.node_colors.pale_blue\n          ? LGraphCanvas.node_colors.pale_blue.groupcolor\n          : \"#AAA\";\n      this._bounding = new Float32Array([10, 10, 140, 80]);\n      this._pos = this._bounding.subarray(0, 2);\n      this._size = this._bounding.subarray(2, 4);\n      this._nodes = [];\n      this.graph = null;\n\n      Object.defineProperty(this, \"pos\", {\n          set: function(v) {\n              if (!v || v.length < 2) {\n                  return;\n              }\n              this._pos[0] = v[0];\n              this._pos[1] = v[1];\n          },\n          get: function() {\n              return this._pos;\n          },\n          enumerable: true\n      });\n\n      Object.defineProperty(this, \"size\", {\n          set: function(v) {\n              if (!v || v.length < 2) {\n                  return;\n              }\n              this._size[0] = Math.max(140, v[0]);\n              this._size[1] = Math.max(80, v[1]);\n          },\n          get: function() {\n              return this._size;\n          },\n          enumerable: true\n      });\n  };\n\n  LGraphGroup.prototype.configure = function(o) {\n      this.title = o.title;\n      this._bounding.set(o.bounding);\n      this.color = o.color;\n      this.font = o.font;\n  };\n\n  LGraphGroup.prototype.serialize = function() {\n      var b = this._bounding;\n      return {\n          title: this.title,\n          bounding: [\n              Math.round(b[0]),\n              Math.round(b[1]),\n              Math.round(b[2]),\n              Math.round(b[3])\n          ],\n          color: this.color,\n          font: this.font\n      };\n  };\n\n  LGraphGroup.prototype.move = function(deltax, deltay, ignore_nodes) {\n      this._pos[0] += deltax;\n      this._pos[1] += deltay;\n      if (ignore_nodes) {\n          return;\n      }\n      for (var i = 0; i < this._nodes.length; ++i) {\n          var node = this._nodes[i];\n          node.pos[0] += deltax;\n          node.pos[1] += deltay;\n      }\n  };\n\n  LGraphGroup.prototype.recomputeInsideNodes = function() {\n      this._nodes.length = 0;\n      var nodes = this.graph._nodes;\n      var node_bounding = new Float32Array(4);\n\n      for (var i = 0; i < nodes.length; ++i) {\n          var node = nodes[i];\n          node.getBounding(node_bounding);\n          if (!overlapBounding(this._bounding, node_bounding)) {\n              continue;\n          } //out of the visible area\n          this._nodes.push(node);\n      }\n  };\n\n  LGraphGroup.prototype.isPointInside = LGraphNode.prototype.isPointInside;\n  LGraphGroup.prototype.setDirtyCanvas = LGraphNode.prototype.setDirtyCanvas;\n\n  //****************************************\n\n  //Scale and Offset\n  function DragAndScale(element, skip_events) {\n      this.offset = new Float32Array([0, 0]);\n      this.scale = 1;\n      this.max_scale = 10;\n      this.min_scale = 0.1;\n      this.onredraw = null;\n      this.enabled = true;\n      this.last_mouse = [0, 0];\n      this.element = null;\n      this.visible_area = new Float32Array(4);\n\n      if (element) {\n          this.element = element;\n          if (!skip_events) {\n              this.bindEvents(element);\n          }\n      }\n  }\n\n  LiteGraph.DragAndScale = DragAndScale;\n\n  DragAndScale.prototype.bindEvents = function(element) {\n      this.last_mouse = new Float32Array(2);\n\n      this._binded_mouse_callback = this.onMouse.bind(this);\n\n      element.addEventListener(\"mousedown\", this._binded_mouse_callback);\n      element.addEventListener(\"mousemove\", this._binded_mouse_callback);\n\n      element.addEventListener(\n          \"mousewheel\",\n          this._binded_mouse_callback,\n          false\n      );\n      element.addEventListener(\"wheel\", this._binded_mouse_callback, false);\n  };\n\n  DragAndScale.prototype.computeVisibleArea = function() {\n      if (!this.element) {\n          this.visible_area[0] = this.visible_area[1] = this.visible_area[2] = this.visible_area[3] = 0;\n          return;\n      }\n      var width = this.element.width;\n      var height = this.element.height;\n      var startx = -this.offset[0];\n      var starty = -this.offset[1];\n      var endx = startx + width / this.scale;\n      var endy = starty + height / this.scale;\n      this.visible_area[0] = startx;\n      this.visible_area[1] = starty;\n      this.visible_area[2] = endx - startx;\n      this.visible_area[3] = endy - starty;\n  };\n\n  DragAndScale.prototype.onMouse = function(e) {\n      if (!this.enabled) {\n          return;\n      }\n\n      var canvas = this.element;\n      var rect = canvas.getBoundingClientRect();\n      var x = e.clientX - rect.left;\n      var y = e.clientY - rect.top;\n      e.canvasx = x;\n      e.canvasy = y;\n      e.dragging = this.dragging;\n\n      var ignore = false;\n      if (this.onmouse) {\n          ignore = this.onmouse(e);\n      }\n\n      if (e.type == \"mousedown\") {\n          this.dragging = true;\n          canvas.removeEventListener(\n              \"mousemove\",\n              this._binded_mouse_callback\n          );\n          document.body.addEventListener(\n              \"mousemove\",\n              this._binded_mouse_callback\n          );\n          document.body.addEventListener(\n              \"mouseup\",\n              this._binded_mouse_callback\n          );\n      } else if (e.type == \"mousemove\") {\n          if (!ignore) {\n              var deltax = x - this.last_mouse[0];\n              var deltay = y - this.last_mouse[1];\n              if (this.dragging) {\n                  this.mouseDrag(deltax, deltay);\n              }\n          }\n      } else if (e.type == \"mouseup\") {\n          this.dragging = false;\n          document.body.removeEventListener(\n              \"mousemove\",\n              this._binded_mouse_callback\n          );\n          document.body.removeEventListener(\n              \"mouseup\",\n              this._binded_mouse_callback\n          );\n          canvas.addEventListener(\"mousemove\", this._binded_mouse_callback);\n      } else if (\n          e.type == \"mousewheel\" ||\n          e.type == \"wheel\" ||\n          e.type == \"DOMMouseScroll\"\n      ) {\n          e.eventType = \"mousewheel\";\n          if (e.type == \"wheel\") {\n              e.wheel = -e.deltaY;\n          } else {\n              e.wheel =\n                  e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n          }\n\n          //from stack overflow\n          e.delta = e.wheelDelta\n              ? e.wheelDelta / 40\n              : e.deltaY\n              ? -e.deltaY / 3\n              : 0;\n          this.changeDeltaScale(1.0 + e.delta * 0.05);\n      }\n\n      this.last_mouse[0] = x;\n      this.last_mouse[1] = y;\n\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n  };\n\n  DragAndScale.prototype.toCanvasContext = function(ctx) {\n      ctx.scale(this.scale, this.scale);\n      ctx.translate(this.offset[0], this.offset[1]);\n  };\n\n  DragAndScale.prototype.convertOffsetToCanvas = function(pos) {\n      //return [pos[0] / this.scale - this.offset[0], pos[1] / this.scale - this.offset[1]];\n      return [\n          (pos[0] + this.offset[0]) * this.scale,\n          (pos[1] + this.offset[1]) * this.scale\n      ];\n  };\n\n  DragAndScale.prototype.convertCanvasToOffset = function(pos, out) {\n      out = out || [0, 0];\n      out[0] = pos[0] / this.scale - this.offset[0];\n      out[1] = pos[1] / this.scale - this.offset[1];\n      return out;\n  };\n\n  DragAndScale.prototype.mouseDrag = function(x, y) {\n      this.offset[0] += x / this.scale;\n      this.offset[1] += y / this.scale;\n\n      if (this.onredraw) {\n          this.onredraw(this);\n      }\n  };\n\n  DragAndScale.prototype.changeScale = function(value, zooming_center) {\n      if (value < this.min_scale) {\n          value = this.min_scale;\n      } else if (value > this.max_scale) {\n          value = this.max_scale;\n      }\n\n      if (value == this.scale) {\n          return;\n      }\n\n      if (!this.element) {\n          return;\n      }\n\n      var rect = this.element.getBoundingClientRect();\n      if (!rect) {\n          return;\n      }\n\n      zooming_center = zooming_center || [\n          rect.width * 0.5,\n          rect.height * 0.5\n      ];\n      var center = this.convertCanvasToOffset(zooming_center);\n      this.scale = value;\n      if (Math.abs(this.scale - 1) < 0.01) {\n          this.scale = 1;\n      }\n\n      var new_center = this.convertCanvasToOffset(zooming_center);\n      var delta_offset = [\n          new_center[0] - center[0],\n          new_center[1] - center[1]\n      ];\n\n      this.offset[0] += delta_offset[0];\n      this.offset[1] += delta_offset[1];\n\n      if (this.onredraw) {\n          this.onredraw(this);\n      }\n  };\n\n  DragAndScale.prototype.changeDeltaScale = function(value, zooming_center) {\n      this.changeScale(this.scale * value, zooming_center);\n  };\n\n  DragAndScale.prototype.reset = function() {\n      this.scale = 1;\n      this.offset[0] = 0;\n      this.offset[1] = 0;\n  };\n\n  //*********************************************************************************\n  // LGraphCanvas: LGraph renderer CLASS\n  //*********************************************************************************\n\n  /**\n   * This class is in charge of rendering one graph inside a canvas. And provides all the interaction required.\n   * Valid callbacks are: onNodeSelected, onNodeDeselected, onShowNodePanel, onNodeDblClicked\n   *\n   * @class LGraphCanvas\n   * @constructor\n   * @param {HTMLCanvas} canvas the canvas where you want to render (it accepts a selector in string format or the canvas element itself)\n   * @param {LGraph} graph [optional]\n   * @param {Object} options [optional] { skip_rendering, autoresize }\n   */\n  function LGraphCanvas(canvas, graph, options) {\n      options = options || {};\n\n      //if(graph === undefined)\n      //\tthrow (\"No graph assigned\");\n      this.background_image =\n          \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=\";\n\n      if (canvas && canvas.constructor === String) {\n          canvas = document.querySelector(canvas);\n      }\n\n      this.ds = new DragAndScale();\n      this.zoom_modify_alpha = true; //otherwise it generates ugly patterns when scaling down too much\n\n      this.title_text_font = \"\" + LiteGraph.NODE_TEXT_SIZE + \"px Arial\";\n      this.inner_text_font =\n          \"normal \" + LiteGraph.NODE_SUBTEXT_SIZE + \"px Arial\";\n      this.node_title_color = LiteGraph.NODE_TITLE_COLOR;\n      this.default_link_color = LiteGraph.LINK_COLOR;\n      this.default_connection_color = {\n          input_off: \"#778\",\n          input_on: \"#7F7\",\n          output_off: \"#778\",\n          output_on: \"#7F7\"\n      };\n\n      this.highquality_render = true;\n      this.use_gradients = false; //set to true to render titlebar with gradients\n      this.editor_alpha = 1; //used for transition\n      this.pause_rendering = false;\n      this.clear_background = true;\n\n  this.read_only = false; //if set to true users cannot modify the graph\n      this.render_only_selected = true;\n      this.live_mode = false;\n      this.show_info = true;\n      this.allow_dragcanvas = true;\n      this.allow_dragnodes = true;\n      this.allow_interaction = true; //allow to control widgets, buttons, collapse, etc\n      this.allow_searchbox = true;\n      this.allow_reconnect_links = false; //allows to change a connection with having to redo it again\n\n      this.drag_mode = false;\n      this.dragging_rectangle = null;\n\n      this.filter = null; //allows to filter to only accept some type of nodes in a graph\n\n      this.always_render_background = false;\n      this.render_shadows = true;\n      this.render_canvas_border = true;\n      this.render_connections_shadows = false; //too much cpu\n      this.render_connections_border = true;\n      this.render_curved_connections = false;\n      this.render_connection_arrows = false;\n      this.render_collapsed_slots = true;\n      this.render_execution_order = false;\n      this.render_title_colored = true;\n  this.render_link_tooltip = true;\n\n      this.links_render_mode = LiteGraph.SPLINE_LINK;\n\n      this.canvas_mouse = [0, 0]; //mouse in canvas graph coordinates, where 0,0 is the top-left corner of the blue rectangle\n\n      //to personalize the search box\n      this.onSearchBox = null;\n      this.onSearchBoxSelection = null;\n\n      //callbacks\n      this.onMouse = null;\n      this.onDrawBackground = null; //to render background objects (behind nodes and connections) in the canvas affected by transform\n      this.onDrawForeground = null; //to render foreground objects (above nodes and connections) in the canvas affected by transform\n      this.onDrawOverlay = null; //to render foreground objects not affected by transform (for GUIs)\n  this.onDrawLinkTooltip = null; //called when rendering a tooltip\n  this.onNodeMoved = null; //called after moving a node\n  this.onSelectionChange = null; //called if the selection changes\n\n      this.connections_width = 3;\n      this.round_radius = 8;\n\n      this.current_node = null;\n      this.node_widget = null; //used for widgets\n  this.over_link_center = null;\n      this.last_mouse_position = [0, 0];\n      this.visible_area = this.ds.visible_area;\n      this.visible_links = [];\n\n      //link canvas and graph\n      if (graph) {\n          graph.attachCanvas(this);\n      }\n\n      this.setCanvas(canvas);\n      this.clear();\n\n      if (!options.skip_render) {\n          this.startRendering();\n      }\n\n      this.autoresize = options.autoresize;\n  }\n\n  global.LGraphCanvas = LiteGraph.LGraphCanvas = LGraphCanvas;\n\n  LGraphCanvas.link_type_colors = {\n      \"-1\": LiteGraph.EVENT_LINK_COLOR,\n      number: \"#AAA\",\n      node: \"#DCA\"\n  };\n  LGraphCanvas.gradients = {}; //cache of gradients\n\n  /**\n   * clears all the data inside\n   *\n   * @method clear\n   */\n  LGraphCanvas.prototype.clear = function() {\n      this.frame = 0;\n      this.last_draw_time = 0;\n      this.render_time = 0;\n      this.fps = 0;\n\n      //this.scale = 1;\n      //this.offset = [0,0];\n\n      this.dragging_rectangle = null;\n\n      this.selected_nodes = {};\n      this.selected_group = null;\n\n      this.visible_nodes = [];\n      this.node_dragged = null;\n      this.node_over = null;\n      this.node_capturing_input = null;\n      this.connecting_node = null;\n      this.highlighted_links = {};\n\n      this.dirty_canvas = true;\n      this.dirty_bgcanvas = true;\n      this.dirty_area = null;\n\n      this.node_in_panel = null;\n      this.node_widget = null;\n\n      this.last_mouse = [0, 0];\n      this.last_mouseclick = 0;\n      this.visible_area.set([0, 0, 0, 0]);\n\n      if (this.onClear) {\n          this.onClear();\n      }\n  };\n\n  /**\n   * assigns a graph, you can reassign graphs to the same canvas\n   *\n   * @method setGraph\n   * @param {LGraph} graph\n   */\n  LGraphCanvas.prototype.setGraph = function(graph, skip_clear) {\n      if (this.graph == graph) {\n          return;\n      }\n\n      if (!skip_clear) {\n          this.clear();\n      }\n\n      if (!graph && this.graph) {\n          this.graph.detachCanvas(this);\n          return;\n      }\n\n      /*\nif(this.graph)\n  this.graph.canvas = null; //remove old graph link to the canvas\nthis.graph = graph;\nif(this.graph)\n  this.graph.canvas = this;\n*/\n      graph.attachCanvas(this);\n      this.setDirty(true, true);\n  };\n\n  /**\n   * opens a graph contained inside a node in the current graph\n   *\n   * @method openSubgraph\n   * @param {LGraph} graph\n   */\n  LGraphCanvas.prototype.openSubgraph = function(graph) {\n      if (!graph) {\n          throw \"graph cannot be null\";\n      }\n\n      if (this.graph == graph) {\n          throw \"graph cannot be the same\";\n      }\n\n      this.clear();\n\n      if (this.graph) {\n          if (!this._graph_stack) {\n              this._graph_stack = [];\n          }\n          this._graph_stack.push(this.graph);\n      }\n\n      graph.attachCanvas(this);\n      this.setDirty(true, true);\n  };\n\n  /**\n   * closes a subgraph contained inside a node\n   *\n   * @method closeSubgraph\n   * @param {LGraph} assigns a graph\n   */\n  LGraphCanvas.prototype.closeSubgraph = function() {\n      if (!this._graph_stack || this._graph_stack.length == 0) {\n          return;\n      }\n      var subgraph_node = this.graph._subgraph_node;\n      var graph = this._graph_stack.pop();\n      this.selected_nodes = {};\n      this.highlighted_links = {};\n      graph.attachCanvas(this);\n      this.setDirty(true, true);\n      if (subgraph_node) {\n          this.centerOnNode(subgraph_node);\n          this.selectNodes([subgraph_node]);\n      }\n  };\n\n  /**\n   * returns the visualy active graph (in case there are more in the stack)\n   * @method getCurrentGraph\n   * @return {LGraph} the active graph\n   */\n  LGraphCanvas.prototype.getCurrentGraph = function() {\n      return this.graph;\n  };\n\n  /**\n   * assigns a canvas\n   *\n   * @method setCanvas\n   * @param {Canvas} assigns a canvas (also accepts the ID of the element (not a selector)\n   */\n  LGraphCanvas.prototype.setCanvas = function(canvas, skip_events) {\n      var that = this;\n\n      if (canvas) {\n          if (canvas.constructor === String) {\n              canvas = document.getElementById(canvas);\n              if (!canvas) {\n                  throw \"Error creating LiteGraph canvas: Canvas not found\";\n              }\n          }\n      }\n\n      if (canvas === this.canvas) {\n          return;\n      }\n\n      if (!canvas && this.canvas) {\n          //maybe detach events from old_canvas\n          if (!skip_events) {\n              this.unbindEvents();\n          }\n      }\n\n      this.canvas = canvas;\n      this.ds.element = canvas;\n\n      if (!canvas) {\n          return;\n      }\n\n      //this.canvas.tabindex = \"1000\";\n      canvas.className += \" lgraphcanvas\";\n      canvas.data = this;\n      canvas.tabindex = \"1\"; //to allow key events\n\n      //bg canvas: used for non changing stuff\n      this.bgcanvas = null;\n      if (!this.bgcanvas) {\n          this.bgcanvas = document.createElement(\"canvas\");\n          this.bgcanvas.width = this.canvas.width;\n          this.bgcanvas.height = this.canvas.height;\n      }\n\n      if (canvas.getContext == null) {\n          if (canvas.localName != \"canvas\") {\n              throw \"Element supplied for LGraphCanvas must be a <canvas> element, you passed a \" +\n                  canvas.localName;\n          }\n          throw \"This browser doesn't support Canvas\";\n      }\n\n      var ctx = (this.ctx = canvas.getContext(\"2d\"));\n      if (ctx == null) {\n          if (!canvas.webgl_enabled) {\n              console.warn(\n                  \"This canvas seems to be WebGL, enabling WebGL renderer\"\n              );\n          }\n          this.enableWebGL();\n      }\n\n      //input:  (move and up could be unbinded)\n      this._mousemove_callback = this.processMouseMove.bind(this);\n      this._mouseup_callback = this.processMouseUp.bind(this);\n\n      if (!skip_events) {\n          this.bindEvents();\n      }\n  };\n\n  //used in some events to capture them\n  LGraphCanvas.prototype._doNothing = function doNothing(e) {\n      e.preventDefault();\n      return false;\n  };\n  LGraphCanvas.prototype._doReturnTrue = function doNothing(e) {\n      e.preventDefault();\n      return true;\n  };\n\n  /**\n   * binds mouse, keyboard, touch and drag events to the canvas\n   * @method bindEvents\n   **/\n  LGraphCanvas.prototype.bindEvents = function() {\n      if (this._events_binded) {\n          console.warn(\"LGraphCanvas: events already binded\");\n          return;\n      }\n\n      var canvas = this.canvas;\n      var ref_window = this.getCanvasWindow();\n      var document = ref_window.document; //hack used when moving canvas between windows\n\n      this._mousedown_callback = this.processMouseDown.bind(this);\n      this._mousewheel_callback = this.processMouseWheel.bind(this);\n\n      canvas.addEventListener(\"mousedown\", this._mousedown_callback, true); //down do not need to store the binded\n      canvas.addEventListener(\"mousemove\", this._mousemove_callback);\n      canvas.addEventListener(\"mousewheel\", this._mousewheel_callback, false);\n\n      canvas.addEventListener(\"contextmenu\", this._doNothing);\n      canvas.addEventListener(\n          \"DOMMouseScroll\",\n          this._mousewheel_callback,\n          false\n      );\n\n      //touch events\n      //if( 'touchstart' in document.documentElement )\n      {\n          this.touchHandler = this.touchHandler.bind(this);\n          canvas.addEventListener(\"touchstart\", this.touchHandler, true);\n          canvas.addEventListener(\"touchmove\", this.touchHandler, true);\n          canvas.addEventListener(\"touchend\", this.touchHandler, true);\n          canvas.addEventListener(\"touchcancel\", this.touchHandler, true);\n      }\n\n      //Keyboard ******************\n      this._key_callback = this.processKey.bind(this);\n\n      canvas.addEventListener(\"keydown\", this._key_callback, true);\n      document.addEventListener(\"keyup\", this._key_callback, true); //in document, otherwise it doesn't fire keyup\n\n      //Dropping Stuff over nodes ************************************\n      this._ondrop_callback = this.processDrop.bind(this);\n\n      canvas.addEventListener(\"dragover\", this._doNothing, false);\n      canvas.addEventListener(\"dragend\", this._doNothing, false);\n      canvas.addEventListener(\"drop\", this._ondrop_callback, false);\n      canvas.addEventListener(\"dragenter\", this._doReturnTrue, false);\n\n      this._events_binded = true;\n  };\n\n  /**\n   * unbinds mouse events from the canvas\n   * @method unbindEvents\n   **/\n  LGraphCanvas.prototype.unbindEvents = function() {\n      if (!this._events_binded) {\n          console.warn(\"LGraphCanvas: no events binded\");\n          return;\n      }\n\n      var ref_window = this.getCanvasWindow();\n      var document = ref_window.document;\n\n      this.canvas.removeEventListener(\"mousedown\", this._mousedown_callback);\n      this.canvas.removeEventListener(\n          \"mousewheel\",\n          this._mousewheel_callback\n      );\n      this.canvas.removeEventListener(\n          \"DOMMouseScroll\",\n          this._mousewheel_callback\n      );\n      this.canvas.removeEventListener(\"keydown\", this._key_callback);\n      document.removeEventListener(\"keyup\", this._key_callback);\n      this.canvas.removeEventListener(\"contextmenu\", this._doNothing);\n      this.canvas.removeEventListener(\"drop\", this._ondrop_callback);\n      this.canvas.removeEventListener(\"dragenter\", this._doReturnTrue);\n\n      this.canvas.removeEventListener(\"touchstart\", this.touchHandler);\n      this.canvas.removeEventListener(\"touchmove\", this.touchHandler);\n      this.canvas.removeEventListener(\"touchend\", this.touchHandler);\n      this.canvas.removeEventListener(\"touchcancel\", this.touchHandler);\n\n      this._mousedown_callback = null;\n      this._mousewheel_callback = null;\n      this._key_callback = null;\n      this._ondrop_callback = null;\n\n      this._events_binded = false;\n  };\n\n  LGraphCanvas.getFileExtension = function(url) {\n      var question = url.indexOf(\"?\");\n      if (question != -1) {\n          url = url.substr(0, question);\n      }\n      var point = url.lastIndexOf(\".\");\n      if (point == -1) {\n          return \"\";\n      }\n      return url.substr(point + 1).toLowerCase();\n  };\n\n  /**\n   * this function allows to render the canvas using WebGL instead of Canvas2D\n   * this is useful if you plant to render 3D objects inside your nodes, it uses litegl.js for webgl and canvas2DtoWebGL to emulate the Canvas2D calls in webGL\n   * @method enableWebGL\n   **/\n  LGraphCanvas.prototype.enableWebGL = function() {\n      if (typeof GL === undefined) {\n          throw \"litegl.js must be included to use a WebGL canvas\";\n      }\n      if (typeof enableWebGLCanvas === undefined) {\n          throw \"webglCanvas.js must be included to use this feature\";\n      }\n\n      this.gl = this.ctx = enableWebGLCanvas(this.canvas);\n      this.ctx.webgl = true;\n      this.bgcanvas = this.canvas;\n      this.bgctx = this.gl;\n      this.canvas.webgl_enabled = true;\n\n      /*\nGL.create({ canvas: this.bgcanvas });\nthis.bgctx = enableWebGLCanvas( this.bgcanvas );\nwindow.gl = this.gl;\n*/\n  };\n\n  /**\n   * marks as dirty the canvas, this way it will be rendered again\n   *\n   * @class LGraphCanvas\n   * @method setDirty\n   * @param {bool} fgcanvas if the foreground canvas is dirty (the one containing the nodes)\n   * @param {bool} bgcanvas if the background canvas is dirty (the one containing the wires)\n   */\n  LGraphCanvas.prototype.setDirty = function(fgcanvas, bgcanvas) {\n      if (fgcanvas) {\n          this.dirty_canvas = true;\n      }\n      if (bgcanvas) {\n          this.dirty_bgcanvas = true;\n      }\n  };\n\n  /**\n   * Used to attach the canvas in a popup\n   *\n   * @method getCanvasWindow\n   * @return {window} returns the window where the canvas is attached (the DOM root node)\n   */\n  LGraphCanvas.prototype.getCanvasWindow = function() {\n      if (!this.canvas) {\n          return window;\n      }\n      var doc = this.canvas.ownerDocument;\n      return doc.defaultView || doc.parentWindow;\n  };\n\n  /**\n   * starts rendering the content of the canvas when needed\n   *\n   * @method startRendering\n   */\n  LGraphCanvas.prototype.startRendering = function() {\n      if (this.is_rendering) {\n          return;\n      } //already rendering\n\n      this.is_rendering = true;\n      renderFrame.call(this);\n\n      function renderFrame() {\n          if (!this.pause_rendering) {\n              this.draw();\n          }\n\n          var window = this.getCanvasWindow();\n          if (this.is_rendering) {\n              window.requestAnimationFrame(renderFrame.bind(this));\n          }\n      }\n  };\n\n  /**\n   * stops rendering the content of the canvas (to save resources)\n   *\n   * @method stopRendering\n   */\n  LGraphCanvas.prototype.stopRendering = function() {\n      this.is_rendering = false;\n      /*\nif(this.rendering_timer_id)\n{\n  clearInterval(this.rendering_timer_id);\n  this.rendering_timer_id = null;\n}\n*/\n  };\n\n  /* LiteGraphCanvas input */\n\n  LGraphCanvas.prototype.processMouseDown = function(e) {\n      if (!this.graph) {\n          return;\n      }\n\n      this.adjustMouseEvent(e);\n\n      var ref_window = this.getCanvasWindow();\n      var document = ref_window.document;\n      LGraphCanvas.active_canvas = this;\n      var that = this;\n\n      //move mouse move event to the window in case it drags outside of the canvas\n      this.canvas.removeEventListener(\"mousemove\", this._mousemove_callback);\n      ref_window.document.addEventListener(\n          \"mousemove\",\n          this._mousemove_callback,\n          true\n      ); //catch for the entire window\n      ref_window.document.addEventListener(\n          \"mouseup\",\n          this._mouseup_callback,\n          true\n      );\n\n      var node = this.graph.getNodeOnPos(\n          e.canvasX,\n          e.canvasY,\n          this.visible_nodes,\n          5\n      );\n      var skip_dragging = false;\n      var skip_action = false;\n      var now = LiteGraph.getTime();\n      var is_double_click = now - this.last_mouseclick < 300;\n\n      this.canvas_mouse[0] = e.canvasX;\n      this.canvas_mouse[1] = e.canvasY;\n      this.canvas.focus();\n\n      LiteGraph.closeAllContextMenus(ref_window);\n\n      if (this.onMouse) {\n          if (this.onMouse(e) == true) {\n              return;\n          }\n      }\n\n      if (e.which == 1) {\n          //left button mouse\n          if (e.ctrlKey) {\n              this.dragging_rectangle = new Float32Array(4);\n              this.dragging_rectangle[0] = e.canvasX;\n              this.dragging_rectangle[1] = e.canvasY;\n              this.dragging_rectangle[2] = 1;\n              this.dragging_rectangle[3] = 1;\n              skip_action = true;\n          }\n\n          var clicking_canvas_bg = false;\n\n          //when clicked on top of a node\n          //and it is not interactive\n          if (node && this.allow_interaction && !skip_action && !this.read_only) {\n              if (!this.live_mode && !node.flags.pinned) {\n                  this.bringToFront(node);\n              } //if it wasn't selected?\n\n              //not dragging mouse to connect two slots\n              if (\n                  !this.connecting_node &&\n                  !node.flags.collapsed &&\n                  !this.live_mode\n              ) {\n                  //Search for corner for resize\n                  if (\n                      !skip_action &&\n                      node.resizable !== false &&\n                      isInsideRectangle(\n                          e.canvasX,\n                          e.canvasY,\n                          node.pos[0] + node.size[0] - 5,\n                          node.pos[1] + node.size[1] - 5,\n                          10,\n                          10\n                      )\n                  ) {\n                      this.resizing_node = node;\n                      this.canvas.style.cursor = \"se-resize\";\n                      skip_action = true;\n                  } else {\n                      //search for outputs\n                      if (node.outputs) {\n                          for (\n                              var i = 0, l = node.outputs.length;\n                              i < l;\n                              ++i\n                          ) {\n                              var output = node.outputs[i];\n                              var link_pos = node.getConnectionPos(false, i);\n                              if (\n                                  isInsideRectangle(\n                                      e.canvasX,\n                                      e.canvasY,\n                                      link_pos[0] - 15,\n                                      link_pos[1] - 10,\n                                      30,\n                                      20\n                                  )\n                              ) {\n                                  this.connecting_node = node;\n                                  this.connecting_output = output;\n                                  this.connecting_pos = node.getConnectionPos( false, i );\n                                  this.connecting_slot = i;\n\n                                  if (e.shiftKey) {\n                                      node.disconnectOutput(i);\n                                  }\n\n                                  if (is_double_click) {\n                                      if (node.onOutputDblClick) {\n                                          node.onOutputDblClick(i, e);\n                                      }\n                                  } else {\n                                      if (node.onOutputClick) {\n                                          node.onOutputClick(i, e);\n                                      }\n                                  }\n\n                                  skip_action = true;\n                                  break;\n                              }\n                          }\n                      }\n\n                      //search for inputs\n                      if (node.inputs) {\n                          for (\n                              var i = 0, l = node.inputs.length;\n                              i < l;\n                              ++i\n                          ) {\n                              var input = node.inputs[i];\n                              var link_pos = node.getConnectionPos(true, i);\n                              if (\n                                  isInsideRectangle(\n                                      e.canvasX,\n                                      e.canvasY,\n                                      link_pos[0] - 15,\n                                      link_pos[1] - 10,\n                                      30,\n                                      20\n                                  )\n                              ) {\n                                  if (is_double_click) {\n                                      if (node.onInputDblClick) {\n                                          node.onInputDblClick(i, e);\n                                      }\n                                  } else {\n                                      if (node.onInputClick) {\n                                          node.onInputClick(i, e);\n                                      }\n                                  }\n\n                                  if (input.link !== null) {\n                                      var link_info = this.graph.links[\n                                          input.link\n                                      ]; //before disconnecting\n                                      node.disconnectInput(i);\n\n                                      if (\n                                          this.allow_reconnect_links ||\n                                          e.shiftKey\n                                      ) {\n                                          this.connecting_node = this.graph._nodes_by_id[\n                                              link_info.origin_id\n                                          ];\n                                          this.connecting_slot =\n                                              link_info.origin_slot;\n                                          this.connecting_output = this.connecting_node.outputs[\n                                              this.connecting_slot\n                                          ];\n                                          this.connecting_pos = this.connecting_node.getConnectionPos( false, this.connecting_slot );\n                                      }\n\n                                      this.dirty_bgcanvas = true;\n                                      skip_action = true;\n                                  }\n                              }\n                          }\n                      }\n                  } //not resizing\n              }\n\n              //Search for corner for collapsing\n              /*\n      if( !skip_action && isInsideRectangle( e.canvasX, e.canvasY, node.pos[0], node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT ))\n      {\n        node.collapse();\n        skip_action = true;\n      }\n      */\n\n              //it wasn't clicked on the links boxes\n              if (!skip_action) {\n                  var block_drag_node = false;\n\n                  //widgets\n                  var widget = this.processNodeWidgets( node, this.canvas_mouse, e );\n                  if (widget) {\n                      block_drag_node = true;\n                      this.node_widget = [node, widget];\n                  }\n\n                  //double clicking\n                  if (is_double_click && this.selected_nodes[node.id]) {\n                      //double click node\n                      if (node.onDblClick) {\n                          node.onDblClick( e, [ e.canvasX - node.pos[0], e.canvasY - node.pos[1] ], this );\n                      }\n                      this.processNodeDblClicked(node);\n                      block_drag_node = true;\n                  }\n\n                  //if do not capture mouse\n                  if ( node.onMouseDown && node.onMouseDown( e, [e.canvasX - node.pos[0], e.canvasY - node.pos[1]], this ) ) {\n                      block_drag_node = true;\n                  } else if (this.live_mode) {\n                      clicking_canvas_bg = true;\n                      block_drag_node = true;\n                  }\n\n                  if (!block_drag_node) {\n                      if (this.allow_dragnodes) {\n                          this.node_dragged = node;\n                      }\n                      if (!this.selected_nodes[node.id]) {\n                          this.processNodeSelected(node, e);\n                      }\n                  }\n\n                  this.dirty_canvas = true;\n              }\n          } //clicked outside of nodes\n          else {\n              //search for link connector\n      if(!this.read_only) \n        for (var i = 0; i < this.visible_links.length; ++i) {\n          var link = this.visible_links[i];\n          var center = link._pos;\n          if (\n            !center ||\n            e.canvasX < center[0] - 4 ||\n            e.canvasX > center[0] + 4 ||\n            e.canvasY < center[1] - 4 ||\n            e.canvasY > center[1] + 4\n          ) {\n            continue;\n          }\n          //link clicked\n          this.showLinkMenu(link, e);\n          this.over_link_center = null; //clear tooltip\n          break;\n        }\n\n              this.selected_group = this.graph.getGroupOnPos( e.canvasX, e.canvasY );\n              this.selected_group_resizing = false;\n              if (this.selected_group && !this.read_only ) {\n                  if (e.ctrlKey) {\n                      this.dragging_rectangle = null;\n                  }\n\n                  var dist = distance( [e.canvasX, e.canvasY], [ this.selected_group.pos[0] + this.selected_group.size[0], this.selected_group.pos[1] + this.selected_group.size[1] ] );\n                  if (dist * this.ds.scale < 10) {\n                      this.selected_group_resizing = true;\n                  } else {\n                      this.selected_group.recomputeInsideNodes();\n                  }\n              }\n\n              if (is_double_click && !this.read_only && this.allow_searchbox) {\n                  this.showSearchBox(e);\n              }\n\n              clicking_canvas_bg = true;\n          }\n\n          if (!skip_action && clicking_canvas_bg && this.allow_dragcanvas) {\n              this.dragging_canvas = true;\n          }\n      } else if (e.which == 2) {\n          //middle button\n      } else if (e.which == 3) {\n          //right button\n    if(!this.read_only)\n            this.processContextMenu(node, e);\n      }\n\n      //TODO\n      //if(this.node_selected != prev_selected)\n      //\tthis.onNodeSelectionChange(this.node_selected);\n\n      this.last_mouse[0] = e.localX;\n      this.last_mouse[1] = e.localY;\n      this.last_mouseclick = LiteGraph.getTime();\n      this.last_mouse_dragging = true;\n\n      /*\nif( (this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n  this.draw();\n*/\n\n      this.graph.change();\n\n      //this is to ensure to defocus(blur) if a text input element is on focus\n      if (\n          !ref_window.document.activeElement ||\n          (ref_window.document.activeElement.nodeName.toLowerCase() !=\n              \"input\" &&\n              ref_window.document.activeElement.nodeName.toLowerCase() !=\n                  \"textarea\")\n      ) {\n          e.preventDefault();\n      }\n      e.stopPropagation();\n\n      if (this.onMouseDown) {\n          this.onMouseDown(e);\n      }\n\n      return false;\n  };\n\n  /**\n   * Called when a mouse move event has to be processed\n   * @method processMouseMove\n   **/\n  LGraphCanvas.prototype.processMouseMove = function(e) {\n      if (this.autoresize) {\n          this.resize();\n      }\n\n      if (!this.graph) {\n          return;\n      }\n\n      LGraphCanvas.active_canvas = this;\n      this.adjustMouseEvent(e);\n      var mouse = [e.localX, e.localY];\n      var delta = [\n          mouse[0] - this.last_mouse[0],\n          mouse[1] - this.last_mouse[1]\n      ];\n      this.last_mouse = mouse;\n      this.canvas_mouse[0] = e.canvasX;\n      this.canvas_mouse[1] = e.canvasY;\n      e.dragging = this.last_mouse_dragging;\n\n      if (this.node_widget) {\n          this.processNodeWidgets(\n              this.node_widget[0],\n              this.canvas_mouse,\n              e,\n              this.node_widget[1]\n          );\n          this.dirty_canvas = true;\n      }\n\n      if (this.dragging_rectangle) {\n          this.dragging_rectangle[2] = e.canvasX - this.dragging_rectangle[0];\n          this.dragging_rectangle[3] = e.canvasY - this.dragging_rectangle[1];\n          this.dirty_canvas = true;\n      } else if (this.selected_group && !this.read_only) {\n          //moving/resizing a group\n          if (this.selected_group_resizing) {\n              this.selected_group.size = [\n                  e.canvasX - this.selected_group.pos[0],\n                  e.canvasY - this.selected_group.pos[1]\n              ];\n          } else {\n              var deltax = delta[0] / this.ds.scale;\n              var deltay = delta[1] / this.ds.scale;\n              this.selected_group.move(deltax, deltay, e.ctrlKey);\n              if (this.selected_group._nodes.length) {\n                  this.dirty_canvas = true;\n              }\n          }\n          this.dirty_bgcanvas = true;\n      } else if (this.dragging_canvas) {\n          this.ds.offset[0] += delta[0] / this.ds.scale;\n          this.ds.offset[1] += delta[1] / this.ds.scale;\n          this.dirty_canvas = true;\n          this.dirty_bgcanvas = true;\n      } else if (this.allow_interaction && !this.read_only) {\n          if (this.connecting_node) {\n              this.dirty_canvas = true;\n          }\n\n          //get node over\n          var node = this.graph.getNodeOnPos(\n              e.canvasX,\n              e.canvasY,\n              this.visible_nodes\n          );\n\n          //remove mouseover flag\n          for (var i = 0, l = this.graph._nodes.length; i < l; ++i) {\n              if (\n                  this.graph._nodes[i].mouseOver &&\n                  node != this.graph._nodes[i]\n              ) {\n                  //mouse leave\n                  this.graph._nodes[i].mouseOver = false;\n                  if (this.node_over && this.node_over.onMouseLeave) {\n                      this.node_over.onMouseLeave(e);\n                  }\n                  this.node_over = null;\n                  this.dirty_canvas = true;\n              }\n          }\n\n          //mouse over a node\n          if (node) {\n              //this.canvas.style.cursor = \"move\";\n              if (!node.mouseOver) {\n                  //mouse enter\n                  node.mouseOver = true;\n                  this.node_over = node;\n                  this.dirty_canvas = true;\n\n                  if (node.onMouseEnter) {\n                      node.onMouseEnter(e);\n                  }\n              }\n\n              //in case the node wants to do something\n              if (node.onMouseMove) {\n                  node.onMouseMove(\n                      e,\n                      [e.canvasX - node.pos[0], e.canvasY - node.pos[1]],\n                      this\n                  );\n              }\n\n              //if dragging a link\n              if (this.connecting_node) {\n                  var pos = this._highlight_input || [0, 0]; //to store the output of isOverNodeInput\n\n                  //on top of input\n                  if (this.isOverNodeBox(node, e.canvasX, e.canvasY)) {\n                      //mouse on top of the corner box, don't know what to do\n                  } else {\n                      //check if I have a slot below de mouse\n                      var slot = this.isOverNodeInput(\n                          node,\n                          e.canvasX,\n                          e.canvasY,\n                          pos\n                      );\n                      if (slot != -1 && node.inputs[slot]) {\n                          var slot_type = node.inputs[slot].type;\n                          if (\n                              LiteGraph.isValidConnection(\n                                  this.connecting_output.type,\n                                  slot_type\n                              )\n                          ) {\n                              this._highlight_input = pos;\n                          }\n                      } else {\n                          this._highlight_input = null;\n                      }\n                  }\n              }\n\n              //Search for corner\n              if (this.canvas) {\n                  if (\n                      isInsideRectangle(\n                          e.canvasX,\n                          e.canvasY,\n                          node.pos[0] + node.size[0] - 5,\n                          node.pos[1] + node.size[1] - 5,\n                          5,\n                          5\n                      )\n                  ) {\n                      this.canvas.style.cursor = \"se-resize\";\n                  } else {\n                      this.canvas.style.cursor = \"crosshair\";\n                  }\n              }\n          } else { //outside\n\n              //search for link connector\n      var over_link = null;\n      for (var i = 0; i < this.visible_links.length; ++i) {\n        var link = this.visible_links[i];\n        var center = link._pos;\n        if (\n          !center ||\n          e.canvasX < center[0] - 4 ||\n          e.canvasX > center[0] + 4 ||\n          e.canvasY < center[1] - 4 ||\n          e.canvasY > center[1] + 4\n        ) {\n          continue;\n        }\n        over_link = link;\n        break;\n      }\n      if( over_link != this.over_link_center )\n      {\n        this.over_link_center = over_link;\n                this.dirty_canvas = true;\n      }\n\n      if (this.canvas) {\n                this.canvas.style.cursor = \"\";\n      }\n    }\n\n          if ( this.node_capturing_input && this.node_capturing_input != node && this.node_capturing_input.onMouseMove ) {\n              this.node_capturing_input.onMouseMove(e,[e.canvasX - this.node_capturing_input.pos[0],e.canvasY - this.node_capturing_input.pos[1]], this);\n          }\n\n          if (this.node_dragged && !this.live_mode) {\n              for (var i in this.selected_nodes) {\n                  var n = this.selected_nodes[i];\n                  n.pos[0] += delta[0] / this.ds.scale;\n                  n.pos[1] += delta[1] / this.ds.scale;\n              }\n\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n          }\n\n          if (this.resizing_node && !this.live_mode) {\n              //convert mouse to node space\n              this.resizing_node.size[0] = e.canvasX - this.resizing_node.pos[0];\n              this.resizing_node.size[1] = e.canvasY - this.resizing_node.pos[1];\n\n              //constraint size\n              var max_slots = Math.max(\n                  this.resizing_node.inputs ? this.resizing_node.inputs.length : 0,\n                  this.resizing_node.outputs ? this.resizing_node.outputs.length : 0\n              );\n              var min_height =\n                  max_slots * LiteGraph.NODE_SLOT_HEIGHT +\n                  (this.resizing_node.widgets ? this.resizing_node.widgets.length : 0) * (LiteGraph.NODE_WIDGET_HEIGHT + 4) + 4;\n              if (this.resizing_node.size[1] < min_height) {\n                  this.resizing_node.size[1] = min_height;\n              }\n              if (this.resizing_node.size[0] < LiteGraph.NODE_MIN_WIDTH) {\n                  this.resizing_node.size[0] = LiteGraph.NODE_MIN_WIDTH;\n              }\n\n              this.canvas.style.cursor = \"se-resize\";\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n          }\n      }\n\n      e.preventDefault();\n      return false;\n  };\n\n  /**\n   * Called when a mouse up event has to be processed\n   * @method processMouseUp\n   **/\n  LGraphCanvas.prototype.processMouseUp = function(e) {\n      if (!this.graph) {\n          return;\n      }\n\n      var window = this.getCanvasWindow();\n      var document = window.document;\n      LGraphCanvas.active_canvas = this;\n\n      //restore the mousemove event back to the canvas\n      document.removeEventListener(\n          \"mousemove\",\n          this._mousemove_callback,\n          true\n      );\n      this.canvas.addEventListener(\n          \"mousemove\",\n          this._mousemove_callback,\n          true\n      );\n      document.removeEventListener(\"mouseup\", this._mouseup_callback, true);\n\n      this.adjustMouseEvent(e);\n      var now = LiteGraph.getTime();\n      e.click_time = now - this.last_mouseclick;\n      this.last_mouse_dragging = false;\n\n      if (e.which == 1) {\n          //left button\n          this.node_widget = null;\n\n          if (this.selected_group) {\n              var diffx =\n                  this.selected_group.pos[0] -\n                  Math.round(this.selected_group.pos[0]);\n              var diffy =\n                  this.selected_group.pos[1] -\n                  Math.round(this.selected_group.pos[1]);\n              this.selected_group.move(diffx, diffy, e.ctrlKey);\n              this.selected_group.pos[0] = Math.round(\n                  this.selected_group.pos[0]\n              );\n              this.selected_group.pos[1] = Math.round(\n                  this.selected_group.pos[1]\n              );\n              if (this.selected_group._nodes.length) {\n                  this.dirty_canvas = true;\n              }\n              this.selected_group = null;\n          }\n          this.selected_group_resizing = false;\n\n          if (this.dragging_rectangle) {\n              if (this.graph) {\n                  var nodes = this.graph._nodes;\n                  var node_bounding = new Float32Array(4);\n                  this.deselectAllNodes();\n                  //compute bounding and flip if left to right\n                  var w = Math.abs(this.dragging_rectangle[2]);\n                  var h = Math.abs(this.dragging_rectangle[3]);\n                  var startx =\n                      this.dragging_rectangle[2] < 0\n                          ? this.dragging_rectangle[0] - w\n                          : this.dragging_rectangle[0];\n                  var starty =\n                      this.dragging_rectangle[3] < 0\n                          ? this.dragging_rectangle[1] - h\n                          : this.dragging_rectangle[1];\n                  this.dragging_rectangle[0] = startx;\n                  this.dragging_rectangle[1] = starty;\n                  this.dragging_rectangle[2] = w;\n                  this.dragging_rectangle[3] = h;\n\n                  //test against all nodes (not visible because the rectangle maybe start outside\n                  var to_select = [];\n                  for (var i = 0; i < nodes.length; ++i) {\n                      var node = nodes[i];\n                      node.getBounding(node_bounding);\n                      if (\n                          !overlapBounding(\n                              this.dragging_rectangle,\n                              node_bounding\n                          )\n                      ) {\n                          continue;\n                      } //out of the visible area\n                      to_select.push(node);\n                  }\n                  if (to_select.length) {\n                      this.selectNodes(to_select);\n                  }\n              }\n              this.dragging_rectangle = null;\n          } else if (this.connecting_node) {\n              //dragging a connection\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n\n              var node = this.graph.getNodeOnPos(\n                  e.canvasX,\n                  e.canvasY,\n                  this.visible_nodes\n              );\n\n              //node below mouse\n              if (node) {\n                  if (\n                      this.connecting_output.type == LiteGraph.EVENT &&\n                      this.isOverNodeBox(node, e.canvasX, e.canvasY)\n                  ) {\n                      this.connecting_node.connect(\n                          this.connecting_slot,\n                          node,\n                          LiteGraph.EVENT\n                      );\n                  } else {\n                      //slot below mouse? connect\n                      var slot = this.isOverNodeInput(\n                          node,\n                          e.canvasX,\n                          e.canvasY\n                      );\n                      if (slot != -1) {\n                          this.connecting_node.connect(\n                              this.connecting_slot,\n                              node,\n                              slot\n                          );\n                      } else {\n                          //not on top of an input\n                          var input = node.getInputInfo(0);\n                          //auto connect\n                          if (\n                              this.connecting_output.type == LiteGraph.EVENT\n                          ) {\n                              this.connecting_node.connect(\n                                  this.connecting_slot,\n                                  node,\n                                  LiteGraph.EVENT\n                              );\n                          } else if (\n                              input &&\n                              !input.link &&\n                              LiteGraph.isValidConnection(\n                                  input.type && this.connecting_output.type\n                              )\n                          ) {\n                              this.connecting_node.connect(\n                                  this.connecting_slot,\n                                  node,\n                                  0\n                              );\n                          }\n                      }\n                  }\n              }\n\n              this.connecting_output = null;\n              this.connecting_pos = null;\n              this.connecting_node = null;\n              this.connecting_slot = -1;\n          } //not dragging connection\n          else if (this.resizing_node) {\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n              this.resizing_node = null;\n          } else if (this.node_dragged) {\n              //node being dragged?\n              var node = this.node_dragged;\n              if (\n                  node &&\n                  e.click_time < 300 &&\n                  isInsideRectangle( e.canvasX, e.canvasY, node.pos[0], node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT, LiteGraph.NODE_TITLE_HEIGHT )\n              ) {\n                  node.collapse();\n              }\n\n              this.dirty_canvas = true;\n              this.dirty_bgcanvas = true;\n              this.node_dragged.pos[0] = Math.round(this.node_dragged.pos[0]);\n              this.node_dragged.pos[1] = Math.round(this.node_dragged.pos[1]);\n              if (this.graph.config.align_to_grid) {\n                  this.node_dragged.alignToGrid();\n              }\n      if( this.onNodeMoved )\n        this.onNodeMoved( this.node_dragged );\n              this.node_dragged = null;\n          } //no node being dragged\n          else {\n              //get node over\n              var node = this.graph.getNodeOnPos(\n                  e.canvasX,\n                  e.canvasY,\n                  this.visible_nodes\n              );\n\n              if (!node && e.click_time < 300) {\n                  this.deselectAllNodes();\n              }\n\n              this.dirty_canvas = true;\n              this.dragging_canvas = false;\n\n              if (this.node_over && this.node_over.onMouseUp) {\n                  this.node_over.onMouseUp( e, [ e.canvasX - this.node_over.pos[0], e.canvasY - this.node_over.pos[1] ], this );\n              }\n              if (\n                  this.node_capturing_input &&\n                  this.node_capturing_input.onMouseUp\n              ) {\n                  this.node_capturing_input.onMouseUp(e, [\n                      e.canvasX - this.node_capturing_input.pos[0],\n                      e.canvasY - this.node_capturing_input.pos[1]\n                  ]);\n              }\n          }\n      } else if (e.which == 2) {\n          //middle button\n          //trace(\"middle\");\n          this.dirty_canvas = true;\n          this.dragging_canvas = false;\n      } else if (e.which == 3) {\n          //right button\n          //trace(\"right\");\n          this.dirty_canvas = true;\n          this.dragging_canvas = false;\n      }\n\n      /*\nif((this.dirty_canvas || this.dirty_bgcanvas) && this.rendering_timer_id == null)\n  this.draw();\n*/\n\n      this.graph.change();\n\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n  };\n\n  /**\n   * Called when a mouse wheel event has to be processed\n   * @method processMouseWheel\n   **/\n  LGraphCanvas.prototype.processMouseWheel = function(e) {\n      if (!this.graph || !this.allow_dragcanvas) {\n          return;\n      }\n\n      var delta = e.wheelDeltaY != null ? e.wheelDeltaY : e.detail * -60;\n\n      this.adjustMouseEvent(e);\n\n      var scale = this.ds.scale;\n\n      if (delta > 0) {\n          scale *= 1.1;\n      } else if (delta < 0) {\n          scale *= 1 / 1.1;\n      }\n\n      //this.setZoom( scale, [ e.localX, e.localY ] );\n      this.ds.changeScale(scale, [e.localX, e.localY]);\n\n      this.graph.change();\n\n      e.preventDefault();\n      return false; // prevent default\n  };\n\n  /**\n   * returns true if a position (in graph space) is on top of a node little corner box\n   * @method isOverNodeBox\n   **/\n  LGraphCanvas.prototype.isOverNodeBox = function(node, canvasx, canvasy) {\n      var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n      if (\n          isInsideRectangle(\n              canvasx,\n              canvasy,\n              node.pos[0] + 2,\n              node.pos[1] + 2 - title_height,\n              title_height - 4,\n              title_height - 4\n          )\n      ) {\n          return true;\n      }\n      return false;\n  };\n\n  /**\n   * returns true if a position (in graph space) is on top of a node input slot\n   * @method isOverNodeInput\n   **/\n  LGraphCanvas.prototype.isOverNodeInput = function(\n      node,\n      canvasx,\n      canvasy,\n      slot_pos\n  ) {\n      if (node.inputs) {\n          for (var i = 0, l = node.inputs.length; i < l; ++i) {\n              var input = node.inputs[i];\n              var link_pos = node.getConnectionPos(true, i);\n              var is_inside = false;\n              if (node.horizontal) {\n                  is_inside = isInsideRectangle(\n                      canvasx,\n                      canvasy,\n                      link_pos[0] - 5,\n                      link_pos[1] - 10,\n                      10,\n                      20\n                  );\n              } else {\n                  is_inside = isInsideRectangle(\n                      canvasx,\n                      canvasy,\n                      link_pos[0] - 10,\n                      link_pos[1] - 5,\n                      40,\n                      10\n                  );\n              }\n              if (is_inside) {\n                  if (slot_pos) {\n                      slot_pos[0] = link_pos[0];\n                      slot_pos[1] = link_pos[1];\n                  }\n                  return i;\n              }\n          }\n      }\n      return -1;\n  };\n\n  /**\n   * process a key event\n   * @method processKey\n   **/\n  LGraphCanvas.prototype.processKey = function(e) {\n      if (!this.graph) {\n          return;\n      }\n\n      var block_default = false;\n      //console.log(e); //debug\n\n      if (e.target.localName == \"input\") {\n          return;\n      }\n\n      if (e.type == \"keydown\") {\n          if (e.keyCode == 32) {\n              //esc\n              this.dragging_canvas = true;\n              block_default = true;\n          }\n\n          //select all Control A\n          if (e.keyCode == 65 && e.ctrlKey) {\n              this.selectNodes();\n              block_default = true;\n          }\n\n          if (e.code == \"KeyC\" && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n              //copy\n              if (this.selected_nodes) {\n                  this.copyToClipboard();\n                  block_default = true;\n              }\n          }\n\n          if (e.code == \"KeyV\" && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n              //paste\n              this.pasteFromClipboard();\n          }\n\n          //delete or backspace\n          if (e.keyCode == 46 || e.keyCode == 8) {\n              if (\n                  e.target.localName != \"input\" &&\n                  e.target.localName != \"textarea\"\n              ) {\n                  this.deleteSelectedNodes();\n                  block_default = true;\n              }\n          }\n\n          //collapse\n          //...\n\n          //TODO\n          if (this.selected_nodes) {\n              for (var i in this.selected_nodes) {\n                  if (this.selected_nodes[i].onKeyDown) {\n                      this.selected_nodes[i].onKeyDown(e);\n                  }\n              }\n          }\n      } else if (e.type == \"keyup\") {\n          if (e.keyCode == 32) {\n              this.dragging_canvas = false;\n          }\n\n          if (this.selected_nodes) {\n              for (var i in this.selected_nodes) {\n                  if (this.selected_nodes[i].onKeyUp) {\n                      this.selected_nodes[i].onKeyUp(e);\n                  }\n              }\n          }\n      }\n\n      this.graph.change();\n\n      if (block_default) {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n          return false;\n      }\n  };\n\n  LGraphCanvas.prototype.copyToClipboard = function() {\n      var clipboard_info = {\n          nodes: [],\n          links: []\n      };\n      var index = 0;\n      var selected_nodes_array = [];\n      for (var i in this.selected_nodes) {\n          var node = this.selected_nodes[i];\n          node._relative_id = index;\n          selected_nodes_array.push(node);\n          index += 1;\n      }\n\n      for (var i = 0; i < selected_nodes_array.length; ++i) {\n          var node = selected_nodes_array[i];\n    var cloned = node.clone();\n    if(!cloned)\n    {\n      console.warn(\"node type not found: \" + node.type );\n      continue;\n    }\n          clipboard_info.nodes.push(cloned.serialize());\n          if (node.inputs && node.inputs.length) {\n              for (var j = 0; j < node.inputs.length; ++j) {\n                  var input = node.inputs[j];\n                  if (!input || input.link == null) {\n                      continue;\n                  }\n                  var link_info = this.graph.links[input.link];\n                  if (!link_info) {\n                      continue;\n                  }\n                  var target_node = this.graph.getNodeById(\n                      link_info.origin_id\n                  );\n                  if (!target_node || !this.selected_nodes[target_node.id]) {\n                      //improve this by allowing connections to non-selected nodes\n                      continue;\n                  } //not selected\n                  clipboard_info.links.push([\n                      target_node._relative_id,\n                      link_info.origin_slot, //j,\n                      node._relative_id,\n                      link_info.target_slot\n                  ]);\n              }\n          }\n      }\n      localStorage.setItem(\n          \"litegrapheditor_clipboard\",\n          JSON.stringify(clipboard_info)\n      );\n  };\n\n  LGraphCanvas.prototype.pasteFromClipboard = function() {\n      var data = localStorage.getItem(\"litegrapheditor_clipboard\");\n      if (!data) {\n          return;\n      }\n\n      //create nodes\n      var clipboard_info = JSON.parse(data);\n      var nodes = [];\n      for (var i = 0; i < clipboard_info.nodes.length; ++i) {\n          var node_data = clipboard_info.nodes[i];\n          var node = LiteGraph.createNode(node_data.type);\n          if (node) {\n              node.configure(node_data);\n              node.pos[0] += 5;\n              node.pos[1] += 5;\n              this.graph.add(node);\n              nodes.push(node);\n          }\n      }\n\n      //create links\n      for (var i = 0; i < clipboard_info.links.length; ++i) {\n          var link_info = clipboard_info.links[i];\n          var origin_node = nodes[link_info[0]];\n          var target_node = nodes[link_info[2]];\n    if( origin_node && target_node )\n            origin_node.connect(link_info[1], target_node, link_info[3]);\n    else\n      console.warn(\"Warning, nodes missing on pasting\");\n      }\n\n      this.selectNodes(nodes);\n  };\n\n  /**\n   * process a item drop event on top the canvas\n   * @method processDrop\n   **/\n  LGraphCanvas.prototype.processDrop = function(e) {\n      e.preventDefault();\n      this.adjustMouseEvent(e);\n\n      var pos = [e.canvasX, e.canvasY];\n      var node = this.graph.getNodeOnPos(pos[0], pos[1]);\n\n      if (!node) {\n          var r = null;\n          if (this.onDropItem) {\n              r = this.onDropItem(event);\n          }\n          if (!r) {\n              this.checkDropItem(e);\n          }\n          return;\n      }\n\n      if (node.onDropFile || node.onDropData) {\n          var files = e.dataTransfer.files;\n          if (files && files.length) {\n              for (var i = 0; i < files.length; i++) {\n                  var file = e.dataTransfer.files[0];\n                  var filename = file.name;\n                  var ext = LGraphCanvas.getFileExtension(filename);\n                  //console.log(file);\n\n                  if (node.onDropFile) {\n                      node.onDropFile(file);\n                  }\n\n                  if (node.onDropData) {\n                      //prepare reader\n                      var reader = new FileReader();\n                      reader.onload = function(event) {\n                          //console.log(event.target);\n                          var data = event.target.result;\n                          node.onDropData(data, filename, file);\n                      };\n\n                      //read data\n                      var type = file.type.split(\"/\")[0];\n                      if (type == \"text\" || type == \"\") {\n                          reader.readAsText(file);\n                      } else if (type == \"image\") {\n                          reader.readAsDataURL(file);\n                      } else {\n                          reader.readAsArrayBuffer(file);\n                      }\n                  }\n              }\n          }\n      }\n\n      if (node.onDropItem) {\n          if (node.onDropItem(event)) {\n              return true;\n          }\n      }\n\n      if (this.onDropItem) {\n          return this.onDropItem(event);\n      }\n\n      return false;\n  };\n\n  //called if the graph doesn't have a default drop item behaviour\n  LGraphCanvas.prototype.checkDropItem = function(e) {\n      if (e.dataTransfer.files.length) {\n          var file = e.dataTransfer.files[0];\n          var ext = LGraphCanvas.getFileExtension(file.name).toLowerCase();\n          var nodetype = LiteGraph.node_types_by_file_extension[ext];\n          if (nodetype) {\n              var node = LiteGraph.createNode(nodetype.type);\n              node.pos = [e.canvasX, e.canvasY];\n              this.graph.add(node);\n              if (node.onDropFile) {\n                  node.onDropFile(file);\n              }\n          }\n      }\n  };\n\n  LGraphCanvas.prototype.processNodeDblClicked = function(n) {\n      if (this.onShowNodePanel) {\n          this.onShowNodePanel(n);\n      }\n\n      if (this.onNodeDblClicked) {\n          this.onNodeDblClicked(n);\n      }\n\n      this.setDirty(true);\n  };\n\n  LGraphCanvas.prototype.processNodeSelected = function(node, e) {\n      this.selectNode(node, e && e.shiftKey);\n      if (this.onNodeSelected) {\n          this.onNodeSelected(node);\n      }\n  };\n\n  /**\n   * selects a given node (or adds it to the current selection)\n   * @method selectNode\n   **/\n  LGraphCanvas.prototype.selectNode = function(\n      node,\n      add_to_current_selection\n  ) {\n      if (node == null) {\n          this.deselectAllNodes();\n      } else {\n          this.selectNodes([node], add_to_current_selection);\n      }\n  };\n\n  /**\n   * selects several nodes (or adds them to the current selection)\n   * @method selectNodes\n   **/\n  LGraphCanvas.prototype.selectNodes = function(\n      nodes,\n      add_to_current_selection\n  ) {\n      if (!add_to_current_selection) {\n          this.deselectAllNodes();\n      }\n\n      nodes = nodes || this.graph._nodes;\n      for (var i = 0; i < nodes.length; ++i) {\n          var node = nodes[i];\n          if (node.is_selected) {\n              continue;\n          }\n\n          if (!node.is_selected && node.onSelected) {\n              node.onSelected();\n          }\n          node.is_selected = true;\n          this.selected_nodes[node.id] = node;\n\n          if (node.inputs) {\n              for (var j = 0; j < node.inputs.length; ++j) {\n                  this.highlighted_links[node.inputs[j].link] = true;\n              }\n          }\n          if (node.outputs) {\n              for (var j = 0; j < node.outputs.length; ++j) {\n                  var out = node.outputs[j];\n                  if (out.links) {\n                      for (var k = 0; k < out.links.length; ++k) {\n                          this.highlighted_links[out.links[k]] = true;\n                      }\n                  }\n              }\n          }\n      }\n\n  if(\tthis.onSelectionChange )\n    this.onSelectionChange( this.selected_nodes );\n\n      this.setDirty(true);\n  };\n\n  /**\n   * removes a node from the current selection\n   * @method deselectNode\n   **/\n  LGraphCanvas.prototype.deselectNode = function(node) {\n      if (!node.is_selected) {\n          return;\n      }\n      if (node.onDeselected) {\n          node.onDeselected();\n      }\n      node.is_selected = false;\n\n      if (this.onNodeDeselected) {\n          this.onNodeDeselected(node);\n      }\n\n      //remove highlighted\n      if (node.inputs) {\n          for (var i = 0; i < node.inputs.length; ++i) {\n              delete this.highlighted_links[node.inputs[i].link];\n          }\n      }\n      if (node.outputs) {\n          for (var i = 0; i < node.outputs.length; ++i) {\n              var out = node.outputs[i];\n              if (out.links) {\n                  for (var j = 0; j < out.links.length; ++j) {\n                      delete this.highlighted_links[out.links[j]];\n                  }\n              }\n          }\n      }\n  };\n\n  /**\n   * removes all nodes from the current selection\n   * @method deselectAllNodes\n   **/\n  LGraphCanvas.prototype.deselectAllNodes = function() {\n      if (!this.graph) {\n          return;\n      }\n      var nodes = this.graph._nodes;\n      for (var i = 0, l = nodes.length; i < l; ++i) {\n          var node = nodes[i];\n          if (!node.is_selected) {\n              continue;\n          }\n          if (node.onDeselected) {\n              node.onDeselected();\n          }\n          node.is_selected = false;\n    if (this.onNodeDeselected) {\n      this.onNodeDeselected(node);\n    }\n      }\n      this.selected_nodes = {};\n      this.current_node = null;\n      this.highlighted_links = {};\n  if(\tthis.onSelectionChange )\n    this.onSelectionChange( this.selected_nodes );\n      this.setDirty(true);\n  };\n\n  /**\n   * deletes all nodes in the current selection from the graph\n   * @method deleteSelectedNodes\n   **/\n  LGraphCanvas.prototype.deleteSelectedNodes = function() {\n      for (var i in this.selected_nodes) {\n          var node = this.selected_nodes[i];\n    //autoconnect when possible (very basic, only takes into account first input-output)\n    if(node.inputs && node.inputs.length && node.outputs && node.outputs.length && LiteGraph.isValidConnection( node.inputs[0].type, node.outputs[0].type ) && node.inputs[0].link && node.outputs[0].links && node.outputs[0].links.length ) \n    {\n      var input_link = node.graph.links[ node.inputs[0].link ];\n      var output_link = node.graph.links[ node.outputs[0].links[0] ];\n      var input_node = node.getInputNode(0);\n      var output_node = node.getOutputNodes(0)[0];\n      if(input_node && output_node)\n        input_node.connect( input_link.origin_slot, output_node, output_link.target_slot );\n    }\n          this.graph.remove(node);\n    if (this.onNodeDeselected) {\n      this.onNodeDeselected(node);\n    }\n      }\n      this.selected_nodes = {};\n      this.current_node = null;\n      this.highlighted_links = {};\n      this.setDirty(true);\n  };\n\n  /**\n   * centers the camera on a given node\n   * @method centerOnNode\n   **/\n  LGraphCanvas.prototype.centerOnNode = function(node) {\n      this.ds.offset[0] =\n          -node.pos[0] -\n          node.size[0] * 0.5 +\n          (this.canvas.width * 0.5) / this.ds.scale;\n      this.ds.offset[1] =\n          -node.pos[1] -\n          node.size[1] * 0.5 +\n          (this.canvas.height * 0.5) / this.ds.scale;\n      this.setDirty(true, true);\n  };\n\n  /**\n   * adds some useful properties to a mouse event, like the position in graph coordinates\n   * @method adjustMouseEvent\n   **/\n  LGraphCanvas.prototype.adjustMouseEvent = function(e) {\n      if (this.canvas) {\n          var b = this.canvas.getBoundingClientRect();\n          e.localX = e.clientX - b.left;\n          e.localY = e.clientY - b.top;\n      } else {\n          e.localX = e.clientX;\n          e.localY = e.clientY;\n      }\n\n      e.deltaX = e.localX - this.last_mouse_position[0];\n      e.deltaY = e.localY - this.last_mouse_position[1];\n\n      this.last_mouse_position[0] = e.localX;\n      this.last_mouse_position[1] = e.localY;\n\n      e.canvasX = e.localX / this.ds.scale - this.ds.offset[0];\n      e.canvasY = e.localY / this.ds.scale - this.ds.offset[1];\n  };\n\n  /**\n   * changes the zoom level of the graph (default is 1), you can pass also a place used to pivot the zoom\n   * @method setZoom\n   **/\n  LGraphCanvas.prototype.setZoom = function(value, zooming_center) {\n      this.ds.changeScale(value, zooming_center);\n      /*\nif(!zooming_center && this.canvas)\n  zooming_center = [this.canvas.width * 0.5,this.canvas.height * 0.5];\n\nvar center = this.convertOffsetToCanvas( zooming_center );\n\nthis.ds.scale = value;\n\nif(this.scale > this.max_zoom)\n  this.scale = this.max_zoom;\nelse if(this.scale < this.min_zoom)\n  this.scale = this.min_zoom;\n\nvar new_center = this.convertOffsetToCanvas( zooming_center );\nvar delta_offset = [new_center[0] - center[0], new_center[1] - center[1]];\n\nthis.offset[0] += delta_offset[0];\nthis.offset[1] += delta_offset[1];\n*/\n\n      this.dirty_canvas = true;\n      this.dirty_bgcanvas = true;\n  };\n\n  /**\n   * converts a coordinate from graph coordinates to canvas2D coordinates\n   * @method convertOffsetToCanvas\n   **/\n  LGraphCanvas.prototype.convertOffsetToCanvas = function(pos, out) {\n      return this.ds.convertOffsetToCanvas(pos, out);\n  };\n\n  /**\n   * converts a coordinate from Canvas2D coordinates to graph space\n   * @method convertCanvasToOffset\n   **/\n  LGraphCanvas.prototype.convertCanvasToOffset = function(pos, out) {\n      return this.ds.convertCanvasToOffset(pos, out);\n  };\n\n  //converts event coordinates from canvas2D to graph coordinates\n  LGraphCanvas.prototype.convertEventToCanvasOffset = function(e) {\n      var rect = this.canvas.getBoundingClientRect();\n      return this.convertCanvasToOffset([\n          e.clientX - rect.left,\n          e.clientY - rect.top\n      ]);\n  };\n\n  /**\n   * brings a node to front (above all other nodes)\n   * @method bringToFront\n   **/\n  LGraphCanvas.prototype.bringToFront = function(node) {\n      var i = this.graph._nodes.indexOf(node);\n      if (i == -1) {\n          return;\n      }\n\n      this.graph._nodes.splice(i, 1);\n      this.graph._nodes.push(node);\n  };\n\n  /**\n   * sends a node to the back (below all other nodes)\n   * @method sendToBack\n   **/\n  LGraphCanvas.prototype.sendToBack = function(node) {\n      var i = this.graph._nodes.indexOf(node);\n      if (i == -1) {\n          return;\n      }\n\n      this.graph._nodes.splice(i, 1);\n      this.graph._nodes.unshift(node);\n  };\n\n  /* Interaction */\n\n  /* LGraphCanvas render */\n  var temp = new Float32Array(4);\n\n  /**\n   * checks which nodes are visible (inside the camera area)\n   * @method computeVisibleNodes\n   **/\n  LGraphCanvas.prototype.computeVisibleNodes = function(nodes, out) {\n      var visible_nodes = out || [];\n      visible_nodes.length = 0;\n      nodes = nodes || this.graph._nodes;\n      for (var i = 0, l = nodes.length; i < l; ++i) {\n          var n = nodes[i];\n\n          //skip rendering nodes in live mode\n          if (this.live_mode && !n.onDrawBackground && !n.onDrawForeground) {\n              continue;\n          }\n\n          if (!overlapBounding(this.visible_area, n.getBounding(temp))) {\n              continue;\n          } //out of the visible area\n\n          visible_nodes.push(n);\n      }\n      return visible_nodes;\n  };\n\n  /**\n   * renders the whole canvas content, by rendering in two separated canvas, one containing the background grid and the connections, and one containing the nodes)\n   * @method draw\n   **/\n  LGraphCanvas.prototype.draw = function(force_canvas, force_bgcanvas) {\n      if (!this.canvas) {\n          return;\n      }\n\n      //fps counting\n      var now = LiteGraph.getTime();\n      this.render_time = (now - this.last_draw_time) * 0.001;\n      this.last_draw_time = now;\n\n      if (this.graph) {\n          this.ds.computeVisibleArea();\n      }\n\n      if (\n          this.dirty_bgcanvas ||\n          force_bgcanvas ||\n          this.always_render_background ||\n          (this.graph &&\n              this.graph._last_trigger_time &&\n              now - this.graph._last_trigger_time < 1000)\n      ) {\n          this.drawBackCanvas();\n      }\n\n      if (this.dirty_canvas || force_canvas) {\n          this.drawFrontCanvas();\n      }\n\n      this.fps = this.render_time ? 1.0 / this.render_time : 0;\n      this.frame += 1;\n  };\n\n  /**\n   * draws the front canvas (the one containing all the nodes)\n   * @method drawFrontCanvas\n   **/\n  LGraphCanvas.prototype.drawFrontCanvas = function() {\n      this.dirty_canvas = false;\n\n      if (!this.ctx) {\n          this.ctx = this.bgcanvas.getContext(\"2d\");\n      }\n      var ctx = this.ctx;\n      if (!ctx) {\n          //maybe is using webgl...\n          return;\n      }\n\n      if (ctx.start2D) {\n          ctx.start2D();\n      }\n\n      var canvas = this.canvas;\n\n      //reset in case of error\n      ctx.restore();\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n      //clip dirty area if there is one, otherwise work in full canvas\n      if (this.dirty_area) {\n          ctx.save();\n          ctx.beginPath();\n          ctx.rect(\n              this.dirty_area[0],\n              this.dirty_area[1],\n              this.dirty_area[2],\n              this.dirty_area[3]\n          );\n          ctx.clip();\n      }\n\n      //clear\n      //canvas.width = canvas.width;\n      if (this.clear_background) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n      }\n\n      //draw bg canvas\n      if (this.bgcanvas == this.canvas) {\n          this.drawBackCanvas();\n      } else {\n          ctx.drawImage(this.bgcanvas, 0, 0);\n      }\n\n      //rendering\n      if (this.onRender) {\n          this.onRender(canvas, ctx);\n      }\n\n      //info widget\n      if (this.show_info) {\n          this.renderInfo(ctx);\n      }\n\n      if (this.graph) {\n          //apply transformations\n          ctx.save();\n          this.ds.toCanvasContext(ctx);\n\n          //draw nodes\n          var drawn_nodes = 0;\n          var visible_nodes = this.computeVisibleNodes(\n              null,\n              this.visible_nodes\n          );\n\n          for (var i = 0; i < visible_nodes.length; ++i) {\n              var node = visible_nodes[i];\n\n              //transform coords system\n              ctx.save();\n              ctx.translate(node.pos[0], node.pos[1]);\n\n              //Draw\n              this.drawNode(node, ctx);\n              drawn_nodes += 1;\n\n              //Restore\n              ctx.restore();\n          }\n\n          //on top (debug)\n          if (this.render_execution_order) {\n              this.drawExecutionOrder(ctx);\n          }\n\n          //connections ontop?\n          if (this.graph.config.links_ontop) {\n              if (!this.live_mode) {\n                  this.drawConnections(ctx);\n              }\n          }\n\n          //current connection (the one being dragged by the mouse)\n          if (this.connecting_pos != null) {\n              ctx.lineWidth = this.connections_width;\n              var link_color = null;\n\n              switch (this.connecting_output.type) {\n                  case LiteGraph.EVENT:\n                      link_color = LiteGraph.EVENT_LINK_COLOR;\n                      break;\n                  default:\n                      link_color = LiteGraph.CONNECTING_LINK_COLOR;\n              }\n\n              //the connection being dragged by the mouse\n              this.renderLink(\n                  ctx,\n                  this.connecting_pos,\n                  [this.canvas_mouse[0], this.canvas_mouse[1]],\n                  null,\n                  false,\n                  null,\n                  link_color,\n                  this.connecting_output.dir ||\n                      (this.connecting_node.horizontal\n                          ? LiteGraph.DOWN\n                          : LiteGraph.RIGHT),\n                  LiteGraph.CENTER\n              );\n\n              ctx.beginPath();\n              if (\n                  this.connecting_output.type === LiteGraph.EVENT ||\n                  this.connecting_output.shape === LiteGraph.BOX_SHAPE\n              ) {\n                  ctx.rect(\n                      this.connecting_pos[0] - 6 + 0.5,\n                      this.connecting_pos[1] - 5 + 0.5,\n                      14,\n                      10\n                  );\n              } else {\n                  ctx.arc(\n                      this.connecting_pos[0],\n                      this.connecting_pos[1],\n                      4,\n                      0,\n                      Math.PI * 2\n                  );\n              }\n              ctx.fill();\n\n              ctx.fillStyle = \"#ffcc00\";\n              if (this._highlight_input) {\n                  ctx.beginPath();\n                  ctx.arc(\n                      this._highlight_input[0],\n                      this._highlight_input[1],\n                      6,\n                      0,\n                      Math.PI * 2\n                  );\n                  ctx.fill();\n              }\n          }\n\n    //the selection rectangle\n          if (this.dragging_rectangle) {\n              ctx.strokeStyle = \"#FFF\";\n              ctx.strokeRect(\n                  this.dragging_rectangle[0],\n                  this.dragging_rectangle[1],\n                  this.dragging_rectangle[2],\n                  this.dragging_rectangle[3]\n              );\n          }\n\n    //on top of link center\n    if(this.over_link_center && this.render_link_tooltip)\n      this.drawLinkTooltip( ctx, this.over_link_center );\n    else\n      if(this.onDrawLinkTooltip) //to remove\n        this.onDrawLinkTooltip(ctx,null);\n\n    //custom info\n          if (this.onDrawForeground) {\n              this.onDrawForeground(ctx, this.visible_rect);\n          }\n\n          ctx.restore();\n      }\n\n      if (this.onDrawOverlay) {\n          this.onDrawOverlay(ctx);\n      }\n\n      if (this.dirty_area) {\n          ctx.restore();\n          //this.dirty_area = null;\n      }\n\n      if (ctx.finish2D) {\n          //this is a function I use in webgl renderer\n          ctx.finish2D();\n      }\n  };\n\n  /**\n   * draws some useful stats in the corner of the canvas\n   * @method renderInfo\n   **/\n  LGraphCanvas.prototype.renderInfo = function(ctx, x, y) {\n      x = x || 0;\n      y = y || 0;\n\n      ctx.save();\n      ctx.translate(x, y);\n\n      ctx.font = \"10px Arial\";\n      ctx.fillStyle = \"#888\";\n      if (this.graph) {\n          ctx.fillText( \"T: \" + this.graph.globaltime.toFixed(2) + \"s\", 5, 13 * 1 );\n          ctx.fillText(\"I: \" + this.graph.iteration, 5, 13 * 2 );\n          ctx.fillText(\"N: \" + this.graph._nodes.length + \" [\" + this.visible_nodes.length + \"]\", 5, 13 * 3 );\n          ctx.fillText(\"V: \" + this.graph._version, 5, 13 * 4);\n          ctx.fillText(\"FPS:\" + this.fps.toFixed(2), 5, 13 * 5);\n      } else {\n          ctx.fillText(\"No graph selected\", 5, 13 * 1);\n      }\n      ctx.restore();\n  };\n\n  /**\n   * draws the back canvas (the one containing the background and the connections)\n   * @method drawBackCanvas\n   **/\n  LGraphCanvas.prototype.drawBackCanvas = function() {\n      var canvas = this.bgcanvas;\n      if (\n          canvas.width != this.canvas.width ||\n          canvas.height != this.canvas.height\n      ) {\n          canvas.width = this.canvas.width;\n          canvas.height = this.canvas.height;\n      }\n\n      if (!this.bgctx) {\n          this.bgctx = this.bgcanvas.getContext(\"2d\");\n      }\n      var ctx = this.bgctx;\n      if (ctx.start) {\n          ctx.start();\n      }\n\n      //clear\n      if (this.clear_background) {\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\n      }\n\n      if (this._graph_stack && this._graph_stack.length) {\n          ctx.save();\n          var parent_graph = this._graph_stack[this._graph_stack.length - 1];\n          var subgraph_node = this.graph._subgraph_node;\n          ctx.strokeStyle = subgraph_node.bgcolor;\n          ctx.lineWidth = 10;\n          ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);\n          ctx.lineWidth = 1;\n          ctx.font = \"40px Arial\";\n          ctx.textAlign = \"center\";\n          ctx.fillStyle = subgraph_node.bgcolor || \"#AAA\";\n          var title = \"\";\n          for (var i = 1; i < this._graph_stack.length; ++i) {\n              title +=\n                  this._graph_stack[i]._subgraph_node.getTitle() + \" >> \";\n          }\n          ctx.fillText(\n              title + subgraph_node.getTitle(),\n              canvas.width * 0.5,\n              40\n          );\n          ctx.restore();\n      }\n\n      var bg_already_painted = false;\n      if (this.onRenderBackground) {\n          bg_already_painted = this.onRenderBackground(canvas, ctx);\n      }\n\n      //reset in case of error\n      ctx.restore();\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      this.visible_links.length = 0;\n\n      if (this.graph) {\n          //apply transformations\n          ctx.save();\n          this.ds.toCanvasContext(ctx);\n            ctx.mozImageSmoothingEnabled = false;\n            ctx.oImageSmoothingEnabled = false;\n            ctx.webkitImageSmoothingEnabled = false;\n            ctx.msImageSmoothingEnabled = false;\n            ctx.imageSmoothingEnabled = false;\n          //render BG\n          if (\n              this.background_image &&\n              this.ds.scale > 0.5 &&\n              !bg_already_painted\n          ) {\n              if (this.zoom_modify_alpha) {\n                  ctx.globalAlpha =\n                      (1.0 - 0.5 / this.ds.scale) * this.editor_alpha;\n              } else {\n                  ctx.globalAlpha = this.editor_alpha;\n              }\n              if (\n                  !this._bg_img ||\n                  this._bg_img.name != this.background_image\n              ) {\n                  this._bg_img = new Image();\n                  this._bg_img.name = this.background_image;\n                  this._bg_img.src = this.background_image;\n                  var that = this;\n                  this._bg_img.onload = function() {\n                      that.draw(true, true);\n                  };\n              }\n\n              var pattern = null;\n              if (this._pattern == null && this._bg_img.width > 0) {\n                  pattern = ctx.createPattern(this._bg_img, \"repeat\");\n                  this._pattern_img = this._bg_img;\n                  this._pattern = pattern;\n              } else {\n                  pattern = this._pattern;\n              }\n              if (pattern) {\n                  ctx.fillStyle = pattern;\n                  ctx.fillRect(\n                      this.visible_area[0],\n                      this.visible_area[1],\n                      this.visible_area[2],\n                      this.visible_area[3]\n                  );\n                  ctx.fillStyle = \"transparent\";\n              }\n\n              ctx.globalAlpha = 1.0;\n          }\n\n          //groups\n          if (this.graph._groups.length && !this.live_mode) {\n              this.drawGroups(canvas, ctx);\n          }\n\n          if (this.onDrawBackground) {\n              this.onDrawBackground(ctx, this.visible_area);\n          }\n          if (this.onBackgroundRender) {\n              //LEGACY\n              console.error(\n                  \"WARNING! onBackgroundRender deprecated, now is named onDrawBackground \"\n              );\n              this.onBackgroundRender = null;\n          }\n\n          //DEBUG: show clipping area\n          //ctx.fillStyle = \"red\";\n          //ctx.fillRect( this.visible_area[0] + 10, this.visible_area[1] + 10, this.visible_area[2] - 20, this.visible_area[3] - 20);\n\n          //bg\n          if (this.render_canvas_border) {\n              ctx.strokeStyle = \"#235\";\n              ctx.strokeRect(0, 0, canvas.width, canvas.height);\n          }\n\n          if (this.render_connections_shadows) {\n              ctx.shadowColor = \"#000\";\n              ctx.shadowOffsetX = 0;\n              ctx.shadowOffsetY = 0;\n              ctx.shadowBlur = 6;\n          } else {\n              ctx.shadowColor = \"rgba(0,0,0,0)\";\n          }\n\n          //draw connections\n          if (!this.live_mode) {\n              this.drawConnections(ctx);\n          }\n\n          ctx.shadowColor = \"rgba(0,0,0,0)\";\n\n          //restore state\n          ctx.restore();\n      }\n\n      if (ctx.finish) {\n          ctx.finish();\n      }\n\n      this.dirty_bgcanvas = false;\n      this.dirty_canvas = true; //to force to repaint the front canvas with the bgcanvas\n  };\n\n  var temp_vec2 = new Float32Array(2);\n\n  /**\n   * draws the given node inside the canvas\n   * @method drawNode\n   **/\n  LGraphCanvas.prototype.drawNode = function(node, ctx) {\n      var glow = false;\n      this.current_node = node;\n\n      var color =\n          node.color ||\n          node.constructor.color ||\n          LiteGraph.NODE_DEFAULT_COLOR;\n      var bgcolor =\n          node.bgcolor ||\n          node.constructor.bgcolor ||\n          LiteGraph.NODE_DEFAULT_BGCOLOR;\n\n      //shadow and glow\n      if (node.mouseOver) {\n          glow = true;\n      }\n\n      var low_quality = this.ds.scale < 0.6; //zoomed out\n\n      //only render if it forces it to do it\n      if (this.live_mode) {\n          if (!node.flags.collapsed) {\n              ctx.shadowColor = \"transparent\";\n              if (node.onDrawForeground) {\n                  node.onDrawForeground(ctx, this, this.canvas);\n              }\n          }\n          return;\n      }\n\n      var editor_alpha = this.editor_alpha;\n      ctx.globalAlpha = editor_alpha;\n\n      if (this.render_shadows && !low_quality) {\n          ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n          ctx.shadowOffsetX = 2 * this.ds.scale;\n          ctx.shadowOffsetY = 2 * this.ds.scale;\n          ctx.shadowBlur = 3 * this.ds.scale;\n      } else {\n          ctx.shadowColor = \"transparent\";\n      }\n\n      //custom draw collapsed method (draw after shadows because they are affected)\n      if (\n          node.flags.collapsed &&\n          node.onDrawCollapsed &&\n          node.onDrawCollapsed(ctx, this) == true\n      ) {\n          return;\n      }\n\n      //clip if required (mask)\n      var shape = node._shape || LiteGraph.BOX_SHAPE;\n      var size = temp_vec2;\n      temp_vec2.set(node.size);\n      var horizontal = node.horizontal; // || node.flags.horizontal;\n\n      if (node.flags.collapsed) {\n          ctx.font = this.inner_text_font;\n          var title = node.getTitle ? node.getTitle() : node.title;\n          if (title != null) {\n              node._collapsed_width = Math.min(\n                  node.size[0],\n                  ctx.measureText(title).width +\n                      LiteGraph.NODE_TITLE_HEIGHT * 2\n              ); //LiteGraph.NODE_COLLAPSED_WIDTH;\n              size[0] = node._collapsed_width;\n              size[1] = 0;\n          }\n      }\n\n      if (node.clip_area) {\n          //Start clipping\n          ctx.save();\n          ctx.beginPath();\n          if (shape == LiteGraph.BOX_SHAPE) {\n              ctx.rect(0, 0, size[0], size[1]);\n          } else if (shape == LiteGraph.ROUND_SHAPE) {\n              ctx.roundRect(0, 0, size[0], size[1], 10);\n          } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n              ctx.arc(\n                  size[0] * 0.5,\n                  size[1] * 0.5,\n                  size[0] * 0.5,\n                  0,\n                  Math.PI * 2\n              );\n          }\n          ctx.clip();\n      }\n\n      //draw shape\n      if (node.has_errors) {\n          bgcolor = \"red\";\n      }\n      this.drawNodeShape(\n          node,\n          ctx,\n          size,\n          color,\n          bgcolor,\n          node.is_selected,\n          node.mouseOver\n      );\n      ctx.shadowColor = \"transparent\";\n\n      //draw foreground\n      if (node.onDrawForeground) {\n          node.onDrawForeground(ctx, this, this.canvas);\n      }\n\n      //connection slots\n      ctx.textAlign = horizontal ? \"center\" : \"left\";\n      ctx.font = this.inner_text_font;\n\n      var render_text = !low_quality;\n\n      var out_slot = this.connecting_output;\n      ctx.lineWidth = 1;\n\n      var max_y = 0;\n      var slot_pos = new Float32Array(2); //to reuse\n\n      //render inputs and outputs\n      if (!node.flags.collapsed) {\n          //input connection slots\n          if (node.inputs) {\n              for (var i = 0; i < node.inputs.length; i++) {\n                  var slot = node.inputs[i];\n\n                  ctx.globalAlpha = editor_alpha;\n                  //change opacity of incompatible slots when dragging a connection\n                  if ( this.connecting_node && !LiteGraph.isValidConnection( slot.type , out_slot.type) ) {\n                      ctx.globalAlpha = 0.4 * editor_alpha;\n                  }\n\n                  ctx.fillStyle =\n                      slot.link != null\n                          ? slot.color_on ||\n                            this.default_connection_color.input_on\n                          : slot.color_off ||\n                            this.default_connection_color.input_off;\n\n                  var pos = node.getConnectionPos(true, i, slot_pos);\n                  pos[0] -= node.pos[0];\n                  pos[1] -= node.pos[1];\n                  if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                      max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                  }\n\n                  ctx.beginPath();\n\n                  if (\n                      slot.type === LiteGraph.EVENT ||\n                      slot.shape === LiteGraph.BOX_SHAPE\n                  ) {\n                      if (horizontal) {\n                          ctx.rect(\n                              pos[0] - 5 + 0.5,\n                              pos[1] - 8 + 0.5,\n                              10,\n                              14\n                          );\n                      } else {\n                          ctx.rect(\n                              pos[0] - 6 + 0.5,\n                              pos[1] - 5 + 0.5,\n                              14,\n                              10\n                          );\n                      }\n                  } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                      ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                      ctx.closePath();\n                  } else {\n          if(low_quality)\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 ); //faster\n          else\n                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                  }\n                  ctx.fill();\n\n                  //render name\n                  if (render_text) {\n                      var text = slot.label != null ? slot.label : slot.name;\n                      if (text) {\n                          ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                          if (horizontal || slot.dir == LiteGraph.UP) {\n                              ctx.fillText(text, pos[0], pos[1] - 10);\n                          } else {\n                              ctx.fillText(text, pos[0] + 10, pos[1] + 5);\n                          }\n                      }\n                  }\n              }\n          }\n\n          //output connection slots\n          if (this.connecting_node) {\n              ctx.globalAlpha = 0.4 * editor_alpha;\n          }\n\n          ctx.textAlign = horizontal ? \"center\" : \"right\";\n          ctx.strokeStyle = \"black\";\n          if (node.outputs) {\n              for (var i = 0; i < node.outputs.length; i++) {\n                  var slot = node.outputs[i];\n\n                  var pos = node.getConnectionPos(false, i, slot_pos);\n                  pos[0] -= node.pos[0];\n                  pos[1] -= node.pos[1];\n                  if (max_y < pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5) {\n                      max_y = pos[1] + LiteGraph.NODE_SLOT_HEIGHT * 0.5;\n                  }\n\n                  ctx.fillStyle =\n                      slot.links && slot.links.length\n                          ? slot.color_on ||\n                            this.default_connection_color.output_on\n                          : slot.color_off ||\n                            this.default_connection_color.output_off;\n                  ctx.beginPath();\n                  //ctx.rect( node.size[0] - 14,i*14,10,10);\n\n                  if (\n                      slot.type === LiteGraph.EVENT ||\n                      slot.shape === LiteGraph.BOX_SHAPE\n                  ) {\n                      if (horizontal) {\n                          ctx.rect(\n                              pos[0] - 5 + 0.5,\n                              pos[1] - 8 + 0.5,\n                              10,\n                              14\n                          );\n                      } else {\n                          ctx.rect(\n                              pos[0] - 6 + 0.5,\n                              pos[1] - 5 + 0.5,\n                              14,\n                              10\n                          );\n                      }\n                  } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                      ctx.moveTo(pos[0] + 8, pos[1] + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] + 6 + 0.5);\n                      ctx.lineTo(pos[0] - 4, pos[1] - 6 + 0.5);\n                      ctx.closePath();\n                  } else {\n          if(low_quality)\n                        ctx.rect(pos[0] - 4, pos[1] - 4, 8, 8 );\n          else\n                        ctx.arc(pos[0], pos[1], 4, 0, Math.PI * 2);\n                  }\n\n                  //trigger\n                  //if(slot.node_id != null && slot.slot == -1)\n                  //\tctx.fillStyle = \"#F85\";\n\n                  //if(slot.links != null && slot.links.length)\n                  ctx.fill();\n        if(!low_quality)\n                    ctx.stroke();\n\n                  //render output name\n                  if (render_text) {\n                      var text = slot.label != null ? slot.label : slot.name;\n                      if (text) {\n                          ctx.fillStyle = LiteGraph.NODE_TEXT_COLOR;\n                          if (horizontal || slot.dir == LiteGraph.DOWN) {\n                              ctx.fillText(text, pos[0], pos[1] - 8);\n                          } else {\n                              ctx.fillText(text, pos[0] - 10, pos[1] + 5);\n                          }\n                      }\n                  }\n              }\n          }\n\n          ctx.textAlign = \"left\";\n          ctx.globalAlpha = 1;\n\n          if (node.widgets) {\n      var widgets_y = max_y;\n              if (horizontal || node.widgets_up) {\n                  widgets_y = 2;\n              }\n      if( node.widgets_start_y != null )\n                  widgets_y = node.widgets_start_y;\n              this.drawNodeWidgets(\n                  node,\n                  widgets_y,\n                  ctx,\n                  this.node_widget && this.node_widget[0] == node\n                      ? this.node_widget[1]\n                      : null\n              );\n          }\n      } else if (this.render_collapsed_slots) {\n          //if collapsed\n          var input_slot = null;\n          var output_slot = null;\n\n          //get first connected slot to render\n          if (node.inputs) {\n              for (var i = 0; i < node.inputs.length; i++) {\n                  var slot = node.inputs[i];\n                  if (slot.link == null) {\n                      continue;\n                  }\n                  input_slot = slot;\n                  break;\n              }\n          }\n          if (node.outputs) {\n              for (var i = 0; i < node.outputs.length; i++) {\n                  var slot = node.outputs[i];\n                  if (!slot.links || !slot.links.length) {\n                      continue;\n                  }\n                  output_slot = slot;\n              }\n          }\n\n          if (input_slot) {\n              var x = 0;\n              var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n              if (horizontal) {\n                  x = node._collapsed_width * 0.5;\n                  y = -LiteGraph.NODE_TITLE_HEIGHT;\n              }\n              ctx.fillStyle = \"#686\";\n              ctx.beginPath();\n              if (\n                  slot.type === LiteGraph.EVENT ||\n                  slot.shape === LiteGraph.BOX_SHAPE\n              ) {\n                  ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n              } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                  ctx.moveTo(x + 8, y);\n                  ctx.lineTo(x + -4, y - 4);\n                  ctx.lineTo(x + -4, y + 4);\n                  ctx.closePath();\n              } else {\n                  ctx.arc(x, y, 4, 0, Math.PI * 2);\n              }\n              ctx.fill();\n          }\n\n          if (output_slot) {\n              var x = node._collapsed_width;\n              var y = LiteGraph.NODE_TITLE_HEIGHT * -0.5; //center\n              if (horizontal) {\n                  x = node._collapsed_width * 0.5;\n                  y = 0;\n              }\n              ctx.fillStyle = \"#686\";\n              ctx.strokeStyle = \"black\";\n              ctx.beginPath();\n              if (\n                  slot.type === LiteGraph.EVENT ||\n                  slot.shape === LiteGraph.BOX_SHAPE\n              ) {\n                  ctx.rect(x - 7 + 0.5, y - 4, 14, 8);\n              } else if (slot.shape === LiteGraph.ARROW_SHAPE) {\n                  ctx.moveTo(x + 6, y);\n                  ctx.lineTo(x - 6, y - 4);\n                  ctx.lineTo(x - 6, y + 4);\n                  ctx.closePath();\n              } else {\n                  ctx.arc(x, y, 4, 0, Math.PI * 2);\n              }\n              ctx.fill();\n              //ctx.stroke();\n          }\n      }\n\n      if (node.clip_area) {\n          ctx.restore();\n      }\n\n      ctx.globalAlpha = 1.0;\n  };\n\n//used by this.over_link_center\nLGraphCanvas.prototype.drawLinkTooltip = function( ctx, link )\n{\n  var pos = link._pos;\n  ctx.fillStyle = \"black\";\n  ctx.beginPath();\n  ctx.arc( pos[0], pos[1], 3, 0, Math.PI * 2 );\n  ctx.fill();\n\n  if(link.data == null)\n    return;\n\n  if(this.onDrawLinkTooltip)\n    if( this.onDrawLinkTooltip(ctx,link,this) == true )\n      return;\n\n  var data = link.data;\n  var text = null;\n\n  if( data.constructor === Number )\n    text = data.toFixed(2);\n  else if( data.constructor === String )\n    text = \"\\\"\" + data + \"\\\"\";\n  else if( data.constructor === Boolean )\n    text = String(data);\n  else if (data.toToolTip)\n    text = data.toToolTip();\n  else\n    text = \"[\" + data.constructor.name + \"]\";\n\n  if(text == null)\n    return;\n\n  ctx.font = \"14px Courier New\";\n  var info = ctx.measureText(text);\n  var w = info.width + 20;\n  var h = 24;\n  ctx.shadowColor = \"black\";\n  ctx.shadowOffsetX = 2;\n  ctx.shadowOffsetY = 2;\n  ctx.shadowBlur = 3;\n  ctx.fillStyle = \"#454\";\n  ctx.beginPath();\n  ctx.roundRect( pos[0] - w*0.5, pos[1] - 15 - h, w, h,3, 3);\n  ctx.moveTo( pos[0] - 10, pos[1] - 15 );\n  ctx.lineTo( pos[0] + 10, pos[1] - 15 );\n  ctx.lineTo( pos[0], pos[1] - 5 );\n  ctx.fill();\n      ctx.shadowColor = \"transparent\";\n  ctx.textAlign = \"center\";\n  ctx.fillStyle = \"#CEC\";\n  ctx.fillText(text, pos[0], pos[1] - 15 - h * 0.3);\n}\n\n  /**\n   * draws the shape of the given node in the canvas\n   * @method drawNodeShape\n   **/\n  var tmp_area = new Float32Array(4);\n\n  LGraphCanvas.prototype.drawNodeShape = function(\n      node,\n      ctx,\n      size,\n      fgcolor,\n      bgcolor,\n      selected,\n      mouse_over\n  ) {\n      //bg rect\n      ctx.strokeStyle = fgcolor;\n      ctx.fillStyle = bgcolor;\n\n      var title_height = LiteGraph.NODE_TITLE_HEIGHT;\n      var low_quality = this.ds.scale < 0.5;\n\n      //render node area depending on shape\n      var shape =\n          node._shape || node.constructor.shape || LiteGraph.ROUND_SHAPE;\n\n      var title_mode = node.constructor.title_mode;\n\n      var render_title = true;\n      if (title_mode == LiteGraph.TRANSPARENT_TITLE) {\n          render_title = false;\n      } else if (title_mode == LiteGraph.AUTOHIDE_TITLE && mouse_over) {\n          render_title = true;\n      }\n\n      var area = tmp_area;\n      area[0] = 0; //x\n      area[1] = render_title ? -title_height : 0; //y\n      area[2] = size[0] + 1; //w\n      area[3] = render_title ? size[1] + title_height : size[1]; //h\n\n      var old_alpha = ctx.globalAlpha;\n\n      //full node shape\n      //if(node.flags.collapsed)\n      {\n          ctx.beginPath();\n          if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n              ctx.fillRect(area[0], area[1], area[2], area[3]);\n          } else if (\n              shape == LiteGraph.ROUND_SHAPE ||\n              shape == LiteGraph.CARD_SHAPE\n          ) {\n              ctx.roundRect(\n                  area[0],\n                  area[1],\n                  area[2],\n                  area[3],\n                  this.round_radius,\n                  shape == LiteGraph.CARD_SHAPE ? 0 : this.round_radius\n              );\n          } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n              ctx.arc(\n                  size[0] * 0.5,\n                  size[1] * 0.5,\n                  size[0] * 0.5,\n                  0,\n                  Math.PI * 2\n              );\n          }\n          ctx.fill();\n\n    //separator\n    if(!node.flags.collapsed)\n    {\n      ctx.shadowColor = \"transparent\";\n      ctx.fillStyle = \"rgba(0,0,0,0.2)\";\n      ctx.fillRect(0, -1, area[2], 2);\n    }\n      }\n      ctx.shadowColor = \"transparent\";\n\n      if (node.onDrawBackground) {\n        ctx.mozImageSmoothingEnabled = false;\n        ctx.oImageSmoothingEnabled = false;\n        ctx.webkitImageSmoothingEnabled = false;\n        ctx.msImageSmoothingEnabled = false;\n        ctx.imageSmoothingEnabled = false;\n          node.onDrawBackground(ctx, this, this.canvas);\n      }\n\n      //title bg (remember, it is rendered ABOVE the node)\n      if (render_title || title_mode == LiteGraph.TRANSPARENT_TITLE) {\n          //title bar\n          if (node.onDrawTitleBar) {\n              node.onDrawTitleBar(\n                  ctx,\n                  title_height,\n                  size,\n                  this.ds.scale,\n                  fgcolor\n              );\n          } else if (\n              title_mode != LiteGraph.TRANSPARENT_TITLE &&\n              (node.constructor.title_color || this.render_title_colored)\n          ) {\n              var title_color = node.constructor.title_color || fgcolor;\n\n              if (node.flags.collapsed) {\n                  ctx.shadowColor = LiteGraph.DEFAULT_SHADOW_COLOR;\n              }\n\n              //* gradient test\n              if (this.use_gradients) {\n                  var grad = LGraphCanvas.gradients[title_color];\n                  if (!grad) {\n                      grad = LGraphCanvas.gradients[ title_color ] = ctx.createLinearGradient(0, 0, 400, 0);\n                      grad.addColorStop(0, title_color);\n                      grad.addColorStop(1, \"#000\");\n                  }\n                  ctx.fillStyle = grad;\n              } else {\n                  ctx.fillStyle = title_color;\n              }\n\n              //ctx.globalAlpha = 0.5 * old_alpha;\n              ctx.beginPath();\n              if (shape == LiteGraph.BOX_SHAPE || low_quality) {\n                  ctx.rect(0, -title_height, size[0] + 1, title_height);\n              } else if (  shape == LiteGraph.ROUND_SHAPE || shape == LiteGraph.CARD_SHAPE ) {\n                  ctx.roundRect(\n                      0,\n                      -title_height,\n                      size[0] + 1,\n                      title_height,\n                      this.round_radius,\n                      node.flags.collapsed ? this.round_radius : 0\n                  );\n              }\n              ctx.fill();\n              ctx.shadowColor = \"transparent\";\n          }\n\n          //title box\n          var box_size = 10;\n          if (node.onDrawTitleBox) {\n              node.onDrawTitleBox(ctx, title_height, size, this.ds.scale);\n          } else if (\n              shape == LiteGraph.ROUND_SHAPE ||\n              shape == LiteGraph.CIRCLE_SHAPE ||\n              shape == LiteGraph.CARD_SHAPE\n          ) {\n              if (low_quality) {\n                  ctx.fillStyle = \"black\";\n                  ctx.beginPath();\n                  ctx.arc(\n                      title_height * 0.5,\n                      title_height * -0.5,\n                      box_size * 0.5 + 1,\n                      0,\n                      Math.PI * 2\n                  );\n                  ctx.fill();\n              }\n\n              ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n      if(low_quality)\n        ctx.fillRect( title_height * 0.5 - box_size *0.5, title_height * -0.5 - box_size *0.5, box_size , box_size  );\n      else\n      {\n        ctx.beginPath();\n        ctx.arc(\n          title_height * 0.5,\n          title_height * -0.5,\n          box_size * 0.5,\n          0,\n          Math.PI * 2\n        );\n        ctx.fill();\n      }\n          } else {\n              if (low_quality) {\n                  ctx.fillStyle = \"black\";\n                  ctx.fillRect(\n                      (title_height - box_size) * 0.5 - 1,\n                      (title_height + box_size) * -0.5 - 1,\n                      box_size + 2,\n                      box_size + 2\n                  );\n              }\n              ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR;\n              ctx.fillRect(\n                  (title_height - box_size) * 0.5,\n                  (title_height + box_size) * -0.5,\n                  box_size,\n                  box_size\n              );\n          }\n          ctx.globalAlpha = old_alpha;\n\n          //title text\n          if (node.onDrawTitleText) {\n              node.onDrawTitleText(\n                  ctx,\n                  title_height,\n                  size,\n                  this.ds.scale,\n                  this.title_text_font,\n                  selected\n              );\n          }\n          if (!low_quality) {\n              ctx.font = this.title_text_font;\n              var title = node.getTitle();\n              if (title) {\n                  if (selected) {\n                      ctx.fillStyle = \"white\";\n                  } else {\n                      ctx.fillStyle =\n                          node.constructor.title_text_color ||\n                          this.node_title_color;\n                  }\n                  if (node.flags.collapsed) {\n                      ctx.textAlign = \"center\";\n                      var measure = ctx.measureText(title);\n                      ctx.fillText(\n                          title,\n                          title_height + measure.width * 0.5,\n                          LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                      );\n                      ctx.textAlign = \"left\";\n                  } else {\n                      ctx.textAlign = \"left\";\n                      ctx.fillText(\n                          title,\n                          title_height,\n                          LiteGraph.NODE_TITLE_TEXT_Y - title_height\n                      );\n                  }\n              }\n          }\n\n          if (node.onDrawTitle) {\n              node.onDrawTitle(ctx);\n          }\n      }\n\n      //render selection marker\n      if (selected) {\n          if (node.onBounding) {\n              node.onBounding(area);\n          }\n\n          if (title_mode == LiteGraph.TRANSPARENT_TITLE) {\n              area[1] -= title_height;\n              area[3] += title_height;\n          }\n          ctx.lineWidth = 1;\n          ctx.globalAlpha = 0.8;\n          ctx.beginPath();\n          if (shape == LiteGraph.BOX_SHAPE) {\n              ctx.rect(\n                  -6 + area[0],\n                  -6 + area[1],\n                  12 + area[2],\n                  12 + area[3]\n              );\n          } else if (\n              shape == LiteGraph.ROUND_SHAPE ||\n              (shape == LiteGraph.CARD_SHAPE && node.flags.collapsed)\n          ) {\n              ctx.roundRect(\n                  -6 + area[0],\n                  -6 + area[1],\n                  12 + area[2],\n                  12 + area[3],\n                  this.round_radius * 2\n              );\n          } else if (shape == LiteGraph.CARD_SHAPE) {\n              ctx.roundRect(\n                  -6 + area[0],\n                  -6 + area[1],\n                  12 + area[2],\n                  12 + area[3],\n                  this.round_radius * 2,\n                  2\n              );\n          } else if (shape == LiteGraph.CIRCLE_SHAPE) {\n              ctx.arc(\n                  size[0] * 0.5,\n                  size[1] * 0.5,\n                  size[0] * 0.5 + 6,\n                  0,\n                  Math.PI * 2\n              );\n          }\n          ctx.strokeStyle = \"#FFF\";\n          ctx.stroke();\n          ctx.strokeStyle = fgcolor;\n          ctx.globalAlpha = 1;\n      }\n  };\n\n  var margin_area = new Float32Array(4);\n  var link_bounding = new Float32Array(4);\n  var tempA = new Float32Array(2);\n  var tempB = new Float32Array(2);\n\n  /**\n   * draws every connection visible in the canvas\n   * OPTIMIZE THIS: pre-catch connections position instead of recomputing them every time\n   * @method drawConnections\n   **/\n  LGraphCanvas.prototype.drawConnections = function(ctx) {\n      var now = LiteGraph.getTime();\n      var visible_area = this.visible_area;\n      margin_area[0] = visible_area[0] - 20;\n      margin_area[1] = visible_area[1] - 20;\n      margin_area[2] = visible_area[2] + 40;\n      margin_area[3] = visible_area[3] + 40;\n\n      //draw connections\n      ctx.lineWidth = this.connections_width;\n\n      ctx.fillStyle = \"#AAA\";\n      ctx.strokeStyle = \"#AAA\";\n      ctx.globalAlpha = this.editor_alpha;\n      //for every node\n      var nodes = this.graph._nodes;\n      for (var n = 0, l = nodes.length; n < l; ++n) {\n          var node = nodes[n];\n          //for every input (we render just inputs because it is easier as every slot can only have one input)\n          if (!node.inputs || !node.inputs.length) {\n              continue;\n          }\n\n          for (var i = 0; i < node.inputs.length; ++i) {\n              var input = node.inputs[i];\n              if (!input || input.link == null) {\n                  continue;\n              }\n              var link_id = input.link;\n              var link = this.graph.links[link_id];\n              if (!link) {\n                  continue;\n              }\n\n              //find link info\n              var start_node = this.graph.getNodeById(link.origin_id);\n              if (start_node == null) {\n                  continue;\n              }\n              var start_node_slot = link.origin_slot;\n              var start_node_slotpos = null;\n              if (start_node_slot == -1) {\n                  start_node_slotpos = [\n                      start_node.pos[0] + 10,\n                      start_node.pos[1] + 10\n                  ];\n              } else {\n                  start_node_slotpos = start_node.getConnectionPos(\n                      false,\n                      start_node_slot,\n                      tempA\n                  );\n              }\n              var end_node_slotpos = node.getConnectionPos(true, i, tempB);\n\n              //compute link bounding\n              link_bounding[0] = start_node_slotpos[0];\n              link_bounding[1] = start_node_slotpos[1];\n              link_bounding[2] = end_node_slotpos[0] - start_node_slotpos[0];\n              link_bounding[3] = end_node_slotpos[1] - start_node_slotpos[1];\n              if (link_bounding[2] < 0) {\n                  link_bounding[0] += link_bounding[2];\n                  link_bounding[2] = Math.abs(link_bounding[2]);\n              }\n              if (link_bounding[3] < 0) {\n                  link_bounding[1] += link_bounding[3];\n                  link_bounding[3] = Math.abs(link_bounding[3]);\n              }\n\n              //skip links outside of the visible area of the canvas\n              if (!overlapBounding(link_bounding, margin_area)) {\n                  continue;\n              }\n\n              var start_slot = start_node.outputs[start_node_slot];\n              var end_slot = node.inputs[i];\n              if (!start_slot || !end_slot) {\n                  continue;\n              }\n              var start_dir =\n                  start_slot.dir ||\n                  (start_node.horizontal ? LiteGraph.DOWN : LiteGraph.RIGHT);\n              var end_dir =\n                  end_slot.dir ||\n                  (node.horizontal ? LiteGraph.UP : LiteGraph.LEFT);\n\n              this.renderLink(\n                  ctx,\n                  start_node_slotpos,\n                  end_node_slotpos,\n                  link,\n                  false,\n                  0,\n                  null,\n                  start_dir,\n                  end_dir\n              );\n\n              //event triggered rendered on top\n              if (link && link._last_time && now - link._last_time < 1000) {\n                  var f = 2.0 - (now - link._last_time) * 0.002;\n                  var tmp = ctx.globalAlpha;\n                  ctx.globalAlpha = tmp * f;\n                  this.renderLink(\n                      ctx,\n                      start_node_slotpos,\n                      end_node_slotpos,\n                      link,\n                      true,\n                      f,\n                      \"white\",\n                      start_dir,\n                      end_dir\n                  );\n                  ctx.globalAlpha = tmp;\n              }\n          }\n      }\n      ctx.globalAlpha = 1;\n  };\n\n  /**\n   * draws a link between two points\n   * @method renderLink\n   * @param {vec2} a start pos\n   * @param {vec2} b end pos\n   * @param {Object} link the link object with all the link info\n   * @param {boolean} skip_border ignore the shadow of the link\n   * @param {boolean} flow show flow animation (for events)\n   * @param {string} color the color for the link\n   * @param {number} start_dir the direction enum\n   * @param {number} end_dir the direction enum\n   * @param {number} num_sublines number of sublines (useful to represent vec3 or rgb)\n   **/\n  LGraphCanvas.prototype.renderLink = function(\n      ctx,\n      a,\n      b,\n      link,\n      skip_border,\n      flow,\n      color,\n      start_dir,\n      end_dir,\n      num_sublines\n  ) {\n      if (link) {\n          this.visible_links.push(link);\n      }\n\n      //choose color\n      if (!color && link) {\n          color = link.color || LGraphCanvas.link_type_colors[link.type];\n      }\n      if (!color) {\n          color = this.default_link_color;\n      }\n      if (link != null && this.highlighted_links[link.id]) {\n          color = \"#FFF\";\n      }\n\n      start_dir = start_dir || LiteGraph.RIGHT;\n      end_dir = end_dir || LiteGraph.LEFT;\n\n      var dist = distance(a, b);\n\n      if (this.render_connections_border && this.ds.scale > 0.6) {\n          ctx.lineWidth = this.connections_width + 4;\n      }\n      ctx.lineJoin = \"round\";\n      num_sublines = num_sublines || 1;\n      if (num_sublines > 1) {\n          ctx.lineWidth = 0.5;\n      }\n\n      //begin line shape\n      ctx.beginPath();\n      for (var i = 0; i < num_sublines; i += 1) {\n          var offsety = (i - (num_sublines - 1) * 0.5) * 5;\n\n          if (this.links_render_mode == LiteGraph.SPLINE_LINK) {\n              ctx.moveTo(a[0], a[1] + offsety);\n              var start_offset_x = 0;\n              var start_offset_y = 0;\n              var end_offset_x = 0;\n              var end_offset_y = 0;\n              switch (start_dir) {\n                  case LiteGraph.LEFT:\n                      start_offset_x = dist * -0.25;\n                      break;\n                  case LiteGraph.RIGHT:\n                      start_offset_x = dist * 0.25;\n                      break;\n                  case LiteGraph.UP:\n                      start_offset_y = dist * -0.25;\n                      break;\n                  case LiteGraph.DOWN:\n                      start_offset_y = dist * 0.25;\n                      break;\n              }\n              switch (end_dir) {\n                  case LiteGraph.LEFT:\n                      end_offset_x = dist * -0.25;\n                      break;\n                  case LiteGraph.RIGHT:\n                      end_offset_x = dist * 0.25;\n                      break;\n                  case LiteGraph.UP:\n                      end_offset_y = dist * -0.25;\n                      break;\n                  case LiteGraph.DOWN:\n                      end_offset_y = dist * 0.25;\n                      break;\n              }\n              ctx.bezierCurveTo(\n                  a[0] + start_offset_x,\n                  a[1] + start_offset_y + offsety,\n                  b[0] + end_offset_x,\n                  b[1] + end_offset_y + offsety,\n                  b[0],\n                  b[1] + offsety\n              );\n          } else if (this.links_render_mode == LiteGraph.LINEAR_LINK) {\n              ctx.moveTo(a[0], a[1] + offsety);\n              var start_offset_x = 0;\n              var start_offset_y = 0;\n              var end_offset_x = 0;\n              var end_offset_y = 0;\n              switch (start_dir) {\n                  case LiteGraph.LEFT:\n                      start_offset_x = -1;\n                      break;\n                  case LiteGraph.RIGHT:\n                      start_offset_x = 1;\n                      break;\n                  case LiteGraph.UP:\n                      start_offset_y = -1;\n                      break;\n                  case LiteGraph.DOWN:\n                      start_offset_y = 1;\n                      break;\n              }\n              switch (end_dir) {\n                  case LiteGraph.LEFT:\n                      end_offset_x = -1;\n                      break;\n                  case LiteGraph.RIGHT:\n                      end_offset_x = 1;\n                      break;\n                  case LiteGraph.UP:\n                      end_offset_y = -1;\n                      break;\n                  case LiteGraph.DOWN:\n                      end_offset_y = 1;\n                      break;\n              }\n              var l = 15;\n              ctx.lineTo(\n                  a[0] + start_offset_x * l,\n                  a[1] + start_offset_y * l + offsety\n              );\n              ctx.lineTo(\n                  b[0] + end_offset_x * l,\n                  b[1] + end_offset_y * l + offsety\n              );\n              ctx.lineTo(b[0], b[1] + offsety);\n          } else if (this.links_render_mode == LiteGraph.STRAIGHT_LINK) {\n              ctx.moveTo(a[0], a[1]);\n              var start_x = a[0];\n              var start_y = a[1];\n              var end_x = b[0];\n              var end_y = b[1];\n              if (start_dir == LiteGraph.RIGHT) {\n                  start_x += 10;\n              } else {\n                  start_y += 10;\n              }\n              if (end_dir == LiteGraph.LEFT) {\n                  end_x -= 10;\n              } else {\n                  end_y -= 10;\n              }\n              ctx.lineTo(start_x, start_y);\n              ctx.lineTo((start_x + end_x) * 0.5, start_y);\n              ctx.lineTo((start_x + end_x) * 0.5, end_y);\n              ctx.lineTo(end_x, end_y);\n              ctx.lineTo(b[0], b[1]);\n          } else {\n              return;\n          } //unknown\n      }\n\n      //rendering the outline of the connection can be a little bit slow\n      if (\n          this.render_connections_border &&\n          this.ds.scale > 0.6 &&\n          !skip_border\n      ) {\n          ctx.strokeStyle = \"rgba(0,0,0,0.5)\";\n          ctx.stroke();\n      }\n\n      ctx.lineWidth = this.connections_width;\n      ctx.fillStyle = ctx.strokeStyle = color;\n      ctx.stroke();\n      //end line shape\n\n      var pos = this.computeConnectionPoint(a, b, 0.5, start_dir, end_dir);\n      if (link && link._pos) {\n          link._pos[0] = pos[0];\n          link._pos[1] = pos[1];\n      }\n\n      //render arrow in the middle\n      if (\n          this.ds.scale >= 0.6 &&\n          this.highquality_render &&\n          end_dir != LiteGraph.CENTER\n      ) {\n          //render arrow\n          if (this.render_connection_arrows) {\n              //compute two points in the connection\n              var posA = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.25,\n                  start_dir,\n                  end_dir\n              );\n              var posB = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.26,\n                  start_dir,\n                  end_dir\n              );\n              var posC = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.75,\n                  start_dir,\n                  end_dir\n              );\n              var posD = this.computeConnectionPoint(\n                  a,\n                  b,\n                  0.76,\n                  start_dir,\n                  end_dir\n              );\n\n              //compute the angle between them so the arrow points in the right direction\n              var angleA = 0;\n              var angleB = 0;\n              if (this.render_curved_connections) {\n                  angleA = -Math.atan2(posB[0] - posA[0], posB[1] - posA[1]);\n                  angleB = -Math.atan2(posD[0] - posC[0], posD[1] - posC[1]);\n              } else {\n                  angleB = angleA = b[1] > a[1] ? 0 : Math.PI;\n              }\n\n              //render arrow\n              ctx.save();\n              ctx.translate(posA[0], posA[1]);\n              ctx.rotate(angleA);\n              ctx.beginPath();\n              ctx.moveTo(-5, -3);\n              ctx.lineTo(0, +7);\n              ctx.lineTo(+5, -3);\n              ctx.fill();\n              ctx.restore();\n              ctx.save();\n              ctx.translate(posC[0], posC[1]);\n              ctx.rotate(angleB);\n              ctx.beginPath();\n              ctx.moveTo(-5, -3);\n              ctx.lineTo(0, +7);\n              ctx.lineTo(+5, -3);\n              ctx.fill();\n              ctx.restore();\n          }\n\n          //circle\n          ctx.beginPath();\n          ctx.arc(pos[0], pos[1], 5, 0, Math.PI * 2);\n          ctx.fill();\n      }\n\n      //render flowing points\n      if (flow) {\n          ctx.fillStyle = color;\n          for (var i = 0; i < 5; ++i) {\n              var f = (LiteGraph.getTime() * 0.001 + i * 0.2) % 1;\n              var pos = this.computeConnectionPoint(\n                  a,\n                  b,\n                  f,\n                  start_dir,\n                  end_dir\n              );\n              ctx.beginPath();\n              ctx.arc(pos[0], pos[1], 5, 0, 2 * Math.PI);\n              ctx.fill();\n          }\n      }\n  };\n\n  //returns the link center point based on curvature\n  LGraphCanvas.prototype.computeConnectionPoint = function(\n      a,\n      b,\n      t,\n      start_dir,\n      end_dir\n  ) {\n      start_dir = start_dir || LiteGraph.RIGHT;\n      end_dir = end_dir || LiteGraph.LEFT;\n\n      var dist = distance(a, b);\n      var p0 = a;\n      var p1 = [a[0], a[1]];\n      var p2 = [b[0], b[1]];\n      var p3 = b;\n\n      switch (start_dir) {\n          case LiteGraph.LEFT:\n              p1[0] += dist * -0.25;\n              break;\n          case LiteGraph.RIGHT:\n              p1[0] += dist * 0.25;\n              break;\n          case LiteGraph.UP:\n              p1[1] += dist * -0.25;\n              break;\n          case LiteGraph.DOWN:\n              p1[1] += dist * 0.25;\n              break;\n      }\n      switch (end_dir) {\n          case LiteGraph.LEFT:\n              p2[0] += dist * -0.25;\n              break;\n          case LiteGraph.RIGHT:\n              p2[0] += dist * 0.25;\n              break;\n          case LiteGraph.UP:\n              p2[1] += dist * -0.25;\n              break;\n          case LiteGraph.DOWN:\n              p2[1] += dist * 0.25;\n              break;\n      }\n\n      var c1 = (1 - t) * (1 - t) * (1 - t);\n      var c2 = 3 * ((1 - t) * (1 - t)) * t;\n      var c3 = 3 * (1 - t) * (t * t);\n      var c4 = t * t * t;\n\n      var x = c1 * p0[0] + c2 * p1[0] + c3 * p2[0] + c4 * p3[0];\n      var y = c1 * p0[1] + c2 * p1[1] + c3 * p2[1] + c4 * p3[1];\n      return [x, y];\n  };\n\n  LGraphCanvas.prototype.drawExecutionOrder = function(ctx) {\n      ctx.shadowColor = \"transparent\";\n      ctx.globalAlpha = 0.25;\n\n      ctx.textAlign = \"center\";\n      ctx.strokeStyle = \"white\";\n      ctx.globalAlpha = 0.75;\n\n      var visible_nodes = this.visible_nodes;\n      for (var i = 0; i < visible_nodes.length; ++i) {\n          var node = visible_nodes[i];\n          ctx.fillStyle = \"black\";\n          ctx.fillRect(\n              node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT,\n              node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT,\n              LiteGraph.NODE_TITLE_HEIGHT,\n              LiteGraph.NODE_TITLE_HEIGHT\n          );\n          if (node.order == 0) {\n              ctx.strokeRect(\n                  node.pos[0] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                  node.pos[1] - LiteGraph.NODE_TITLE_HEIGHT + 0.5,\n                  LiteGraph.NODE_TITLE_HEIGHT,\n                  LiteGraph.NODE_TITLE_HEIGHT\n              );\n          }\n          ctx.fillStyle = \"#FFF\";\n          ctx.fillText(\n              node.order,\n              node.pos[0] + LiteGraph.NODE_TITLE_HEIGHT * -0.5,\n              node.pos[1] - 6\n          );\n      }\n      ctx.globalAlpha = 1;\n  };\n\n  /**\n   * draws the widgets stored inside a node\n   * @method drawNodeWidgets\n   **/\n  LGraphCanvas.prototype.drawNodeWidgets = function(\n      node,\n      posY,\n      ctx,\n      active_widget\n  ) {\n      if (!node.widgets || !node.widgets.length) {\n          return 0;\n      }\n      var width = node.size[0];\n      var widgets = node.widgets;\n      posY += 2;\n      var H = LiteGraph.NODE_WIDGET_HEIGHT;\n      var show_text = this.ds.scale > 0.5;\n      ctx.save();\n      ctx.globalAlpha = this.editor_alpha;\n      var outline_color = LiteGraph.WIDGET_OUTLINE_COLOR;\n      var background_color = LiteGraph.WIDGET_BGCOLOR;\n      var text_color = LiteGraph.WIDGET_TEXT_COLOR;\n  var secondary_text_color = LiteGraph.WIDGET_SECONDARY_TEXT_COLOR;\n      var margin = 15;\n\n      for (var i = 0; i < widgets.length; ++i) {\n          var w = widgets[i];\n          var y = posY;\n          if (w.y) {\n              y = w.y;\n          }\n          w.last_y = y;\n          ctx.strokeStyle = outline_color;\n          ctx.fillStyle = \"#222\";\n          ctx.textAlign = \"left\";\n    if(w.disabled)\n      ctx.globalAlpha *= 0.5;\n\n          switch (w.type) {\n              case \"button\":\n                  if (w.clicked) {\n                      ctx.fillStyle = \"#AAA\";\n                      w.clicked = false;\n                      this.dirty_canvas = true;\n                  }\n                  ctx.fillRect(margin, y, width - margin * 2, H);\n        if(show_text)\n                    ctx.strokeRect( margin, y, width - margin * 2, H );\n                  if (show_text) {\n                      ctx.textAlign = \"center\";\n                      ctx.fillStyle = text_color;\n                      ctx.fillText(w.name, width * 0.5, y + H * 0.7);\n                  }\n                  break;\n              case \"toggle\":\n                  ctx.textAlign = \"left\";\n                  ctx.strokeStyle = outline_color;\n                  ctx.fillStyle = background_color;\n                  ctx.beginPath();\n                  if (show_text)\n                    ctx.roundRect(margin, posY, width - margin * 2, H, H * 0.5);\n        else\n                    ctx.rect(margin, posY, width - margin * 2, H );\n                  ctx.fill();\n        if(show_text)\n                    ctx.stroke();\n                  ctx.fillStyle = w.value ? \"#89A\" : \"#333\";\n                  ctx.beginPath();\n                  ctx.arc( width - margin * 2, y + H * 0.5, H * 0.36, 0, Math.PI * 2 );\n                  ctx.fill();\n                  if (show_text) {\n                      ctx.fillStyle = secondary_text_color;\n                      if (w.name != null) {\n                          ctx.fillText(w.name, margin * 2, y + H * 0.7);\n                      }\n                      ctx.fillStyle = w.value ? text_color : secondary_text_color;\n                      ctx.textAlign = \"right\";\n                      ctx.fillText(\n                          w.value\n                              ? w.options.on || \"true\"\n                              : w.options.off || \"false\",\n                          width - 40,\n                          y + H * 0.7\n                      );\n                  }\n                  break;\n              case \"slider\":\n                  ctx.fillStyle = background_color;\n                  ctx.fillRect(margin, y, width - margin * 2, H);\n                  var range = w.options.max - w.options.min;\n                  var nvalue = (w.value - w.options.min) / range;\n                  ctx.fillStyle = active_widget == w ? \"#89A\" : \"#678\";\n                  ctx.fillRect(margin, y, nvalue * (width - margin * 2), H);\n        if(show_text)\n                    ctx.strokeRect(margin, y, width - margin * 2, H);\n                  if (w.marker) {\n                      var marker_nvalue = (w.marker - w.options.min) / range;\n                      ctx.fillStyle = \"#AA9\";\n                      ctx.fillRect( margin + marker_nvalue * (width - margin * 2), y, 2, H );\n                  }\n                  if (show_text) {\n                      ctx.textAlign = \"center\";\n                      ctx.fillStyle = text_color;\n                      ctx.fillText(\n                          w.name + \"  \" + Number(w.value).toFixed(3),\n                          width * 0.5,\n                          y + H * 0.7\n                      );\n                  }\n                  break;\n              case \"number\":\n              case \"combo\":\n                  ctx.textAlign = \"left\";\n                  ctx.strokeStyle = outline_color;\n                  ctx.fillStyle = background_color;\n                  ctx.beginPath();\n        if(show_text)\n                    ctx.roundRect(margin, posY, width - margin * 2, H, H * 0.5);\n        else\n                    ctx.rect(margin, posY, width - margin * 2, H );\n                  ctx.fill();\n                  if (show_text) {\n                    ctx.stroke();\n                      ctx.fillStyle = text_color;\n                      ctx.beginPath();\n                      ctx.moveTo(margin + 16, posY + 5);\n                      ctx.lineTo(margin + 6, posY + H * 0.5);\n                      ctx.lineTo(margin + 16, posY + H - 5);\n                      ctx.fill();\n                      ctx.beginPath();\n                      ctx.moveTo(width - margin - 16, posY + 5);\n                      ctx.lineTo(width - margin - 6, posY + H * 0.5);\n                      ctx.lineTo(width - margin - 16, posY + H - 5);\n                      ctx.fill();\n                      ctx.fillStyle = secondary_text_color;\n                      ctx.fillText(w.name, margin * 2 + 5, y + H * 0.7);\n                      ctx.fillStyle = text_color;\n                      ctx.textAlign = \"right\";\n                      if (w.type == \"number\") {\n                          ctx.fillText(\n                              Number(w.value).toFixed(\n                                  w.options.precision !== undefined\n                                      ? w.options.precision\n                                      : 3\n                              ),\n                              width - margin * 2 - 20,\n                              y + H * 0.7\n                          );\n                      } else {\n                          ctx.fillText(\n                              w.value,\n                              width - margin * 2 - 20,\n                              y + H * 0.7\n                          );\n                      }\n                  }\n                  break;\n              case \"string\":\n              case \"text\":\n                  ctx.textAlign = \"left\";\n                  ctx.strokeStyle = outline_color;\n                  ctx.fillStyle = background_color;\n                  ctx.beginPath();\n                  if (show_text)\n                    ctx.roundRect(margin, posY, width - margin * 2, H, H * 0.5);\n        else\n                    ctx.rect( margin, posY, width - margin * 2, H );\n                  ctx.fill();\n                  if (show_text) {\n                    ctx.stroke();\n                      ctx.fillStyle = secondary_text_color;\n                      if (w.name != null) {\n                          ctx.fillText(w.name, margin * 2, y + H * 0.7);\n                      }\n                      ctx.fillStyle = text_color;\n                      ctx.textAlign = \"right\";\n                      ctx.fillText(w.value, width - margin * 2, y + H * 0.7);\n                  }\n                  break;\n              default:\n                  if (w.draw) {\n                      w.draw(ctx, node, w, y, H);\n                  }\n                  break;\n          }\n          posY += H + 4;\n    ctx.globalAlpha = this.editor_alpha;\n\n      }\n      ctx.restore();\n  ctx.textAlign = \"left\";\n  };\n\n  /**\n   * process an event on widgets\n   * @method processNodeWidgets\n   **/\n  LGraphCanvas.prototype.processNodeWidgets = function(\n      node,\n      pos,\n      event,\n      active_widget\n  ) {\n      if (!node.widgets || !node.widgets.length) {\n          return null;\n      }\n\n      var x = pos[0] - node.pos[0];\n      var y = pos[1] - node.pos[1];\n      var width = node.size[0];\n      var that = this;\n      var ref_window = this.getCanvasWindow();\n\n      for (var i = 0; i < node.widgets.length; ++i) {\n          var w = node.widgets[i];\n    if(w.disabled)\n      continue;\n          if ( w == active_widget || (x > 6 && x < width - 12 && y > w.last_y && y < w.last_y + LiteGraph.NODE_WIDGET_HEIGHT) ) {\n              //inside widget\n              switch (w.type) {\n                  case \"button\":\n                      if (event.type === \"mousemove\") {\n                          break;\n                      }\n                      if (w.callback) {\n                          setTimeout(function() {\n                              w.callback(w, that, node, pos, event);\n                          }, 20);\n                      }\n                      w.clicked = true;\n                      this.dirty_canvas = true;\n                      break;\n                  case \"slider\":\n                      var range = w.options.max - w.options.min;\n                      var nvalue = Math.clamp((x - 10) / (width - 20), 0, 1);\n                      w.value =\n                          w.options.min +\n                          (w.options.max - w.options.min) * nvalue;\n                      if (w.callback) {\n                          setTimeout(function() {\n                              inner_value_change(w, w.value);\n                          }, 20);\n                      }\n                      this.dirty_canvas = true;\n                      break;\n                  case \"number\":\n                  case \"combo\":\n          var old_value = w.value;\n                      if (event.type == \"mousemove\" && w.type == \"number\") {\n                          w.value +=\n                              event.deltaX * 0.1 * (w.options.step || 1);\n                          if (\n                              w.options.min != null &&\n                              w.value < w.options.min\n                          ) {\n                              w.value = w.options.min;\n                          }\n                          if (\n                              w.options.max != null &&\n                              w.value > w.options.max\n                          ) {\n                              w.value = w.options.max;\n                          }\n                      } else if (event.type == \"mousedown\") {\n                          var values = w.options.values;\n                          if (values && values.constructor === Function) {\n                              values = w.options.values(w, node);\n                          }\n\n                          var delta = x < 40 ? -1 : x > width - 40 ? 1 : 0;\n                          if (w.type == \"number\") {\n                              w.value += delta * 0.1 * (w.options.step || 1);\n                              if (\n                                  w.options.min != null &&\n                                  w.value < w.options.min\n                              ) {\n                                  w.value = w.options.min;\n                              }\n                              if (\n                                  w.options.max != null &&\n                                  w.value > w.options.max\n                              ) {\n                                  w.value = w.options.max;\n                              }\n                          } else if (delta) {\n                              var index = values.indexOf(w.value) + delta;\n                              if (index >= values.length) {\n                                  index = 0;\n                              }\n                              if (index < 0) {\n                                  index = values.length - 1;\n                              }\n                              w.value = values[index];\n                          } else {\n                              var menu = new LiteGraph.ContextMenu(\n                                  values,\n                                  {\n                                      scale: Math.max(1, this.ds.scale),\n                                      event: event,\n                                      className: \"dark\",\n                                      callback: inner_clicked.bind(w)\n                                  },\n                                  ref_window\n                              );\n                              function inner_clicked(v, option, event) {\n                                  this.value = v;\n                                  inner_value_change(this, v);\n                                  that.dirty_canvas = true;\n                                  return false;\n                              }\n                          }\n                      } //mousedown\n\n          if( old_value != w.value )\n            setTimeout(\n              function() {\n                inner_value_change(this, this.value);\n              }.bind(w),\n              20\n            );\n                      this.dirty_canvas = true;\n                      break;\n                  case \"toggle\":\n                      if (event.type == \"mousedown\") {\n                          w.value = !w.value;\n            setTimeout(function() {\n              inner_value_change(w, w.value);\n                          }, 20);\n                      }\n                      break;\n                  case \"string\":\n                  case \"text\":\n                      if (event.type == \"mousedown\") {\n                          this.prompt(\n                              \"Value\",\n                              w.value,\n                              function(v) {\n                                  this.value = v;\n                                  inner_value_change(this, v);\n                              }.bind(w),\n                              event\n                          );\n                      }\n                      break;\n                  default:\n                      if (w.mouse) {\n                          w.mouse(ctx, event, [x, y], node);\n                      }\n                      break;\n              } //end switch\n\n              return w;\n          }\n      }\n\n      function inner_value_change(widget, value) {\n          widget.value = value;\n          if ( widget.options && widget.options.property && node.properties[widget.options.property] !== undefined ) {\n              node.setProperty( widget.options.property, value );\n          }\n          if (widget.callback) {\n              widget.callback(widget.value, that, node, pos, event);\n          }\n      }\n\n      return null;\n  };\n\n  /**\n   * draws every group area in the background\n   * @method drawGroups\n   **/\n  LGraphCanvas.prototype.drawGroups = function(canvas, ctx) {\n      if (!this.graph) {\n          return;\n      }\n\n      var groups = this.graph._groups;\n\n      ctx.save();\n      ctx.globalAlpha = 0.5 * this.editor_alpha;\n\n      for (var i = 0; i < groups.length; ++i) {\n          var group = groups[i];\n\n          if (!overlapBounding(this.visible_area, group._bounding)) {\n              continue;\n          } //out of the visible area\n\n          ctx.fillStyle = group.color || \"#335\";\n          ctx.strokeStyle = group.color || \"#335\";\n          var pos = group._pos;\n          var size = group._size;\n          ctx.globalAlpha = 0.25 * this.editor_alpha;\n          ctx.beginPath();\n          ctx.rect(pos[0] + 0.5, pos[1] + 0.5, size[0], size[1]);\n          ctx.fill();\n          ctx.globalAlpha = this.editor_alpha;\n          ctx.stroke();\n\n          ctx.beginPath();\n          ctx.moveTo(pos[0] + size[0], pos[1] + size[1]);\n          ctx.lineTo(pos[0] + size[0] - 10, pos[1] + size[1]);\n          ctx.lineTo(pos[0] + size[0], pos[1] + size[1] - 10);\n          ctx.fill();\n\n          var font_size =\n              group.font_size || LiteGraph.DEFAULT_GROUP_FONT_SIZE;\n          ctx.font = font_size + \"px Arial\";\n          ctx.fillText(group.title, pos[0] + 4, pos[1] + font_size);\n      }\n\n      ctx.restore();\n  };\n\n  LGraphCanvas.prototype.adjustNodesSize = function() {\n      var nodes = this.graph._nodes;\n      for (var i = 0; i < nodes.length; ++i) {\n          nodes[i].size = nodes[i].computeSize();\n      }\n      this.setDirty(true, true);\n  };\n\n  /**\n   * resizes the canvas to a given size, if no size is passed, then it tries to fill the parentNode\n   * @method resize\n   **/\n  LGraphCanvas.prototype.resize = function(width, height) {\n      if (!width && !height) {\n          var parent = this.canvas.parentNode;\n          width = parent.offsetWidth;\n          height = parent.offsetHeight;\n      }\n\n      if (this.canvas.width == width && this.canvas.height == height) {\n          return;\n      }\n\n      this.canvas.width = width;\n      this.canvas.height = height;\n      this.bgcanvas.width = this.canvas.width;\n      this.bgcanvas.height = this.canvas.height;\n      this.setDirty(true, true);\n  };\n\n  /**\n   * switches to live mode (node shapes are not rendered, only the content)\n   * this feature was designed when graphs where meant to create user interfaces\n   * @method switchLiveMode\n   **/\n  LGraphCanvas.prototype.switchLiveMode = function(transition) {\n      if (!transition) {\n          this.live_mode = !this.live_mode;\n          this.dirty_canvas = true;\n          this.dirty_bgcanvas = true;\n          return;\n      }\n\n      var self = this;\n      var delta = this.live_mode ? 1.1 : 0.9;\n      if (this.live_mode) {\n          this.live_mode = false;\n          this.editor_alpha = 0.1;\n      }\n\n      var t = setInterval(function() {\n          self.editor_alpha *= delta;\n          self.dirty_canvas = true;\n          self.dirty_bgcanvas = true;\n\n          if (delta < 1 && self.editor_alpha < 0.01) {\n              clearInterval(t);\n              if (delta < 1) {\n                  self.live_mode = true;\n              }\n          }\n          if (delta > 1 && self.editor_alpha > 0.99) {\n              clearInterval(t);\n              self.editor_alpha = 1;\n          }\n      }, 1);\n  };\n\n  LGraphCanvas.prototype.onNodeSelectionChange = function(node) {\n      return; //disabled\n  };\n\n  LGraphCanvas.prototype.touchHandler = function(event) {\n      //alert(\"foo\");\n      var touches = event.changedTouches,\n          first = touches[0],\n          type = \"\";\n\n      switch (event.type) {\n          case \"touchstart\":\n              type = \"mousedown\";\n              break;\n          case \"touchmove\":\n              type = \"mousemove\";\n              break;\n          case \"touchend\":\n              type = \"mouseup\";\n              break;\n          default:\n              return;\n      }\n\n      //initMouseEvent(type, canBubble, cancelable, view, clickCount,\n      //           screenX, screenY, clientX, clientY, ctrlKey,\n      //           altKey, shiftKey, metaKey, button, relatedTarget);\n      var window = this.getCanvasWindow();\n      var document = window.document;\n\n      var simulatedEvent = document.createEvent(\"MouseEvent\");\n      simulatedEvent.initMouseEvent(\n          type,\n          true,\n          true,\n          window,\n          1,\n          first.screenX,\n          first.screenY,\n          first.clientX,\n          first.clientY,\n          false,\n          false,\n          false,\n          false,\n          0 /*left*/,\n          null\n      );\n      first.target.dispatchEvent(simulatedEvent);\n      event.preventDefault();\n  };\n\n  /* CONTEXT MENU ********************/\n\n  LGraphCanvas.onGroupAdd = function(info, entry, mouse_event) {\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var group = new LiteGraph.LGraphGroup();\n      group.pos = canvas.convertEventToCanvasOffset(mouse_event);\n      canvas.graph.add(group);\n  };\n\n  LGraphCanvas.onMenuAdd = function(node, options, e, prev_menu, callback) {\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var values = LiteGraph.getNodeTypesCategories( canvas.filter );\n      var entries = [];\n      for (var i in values) {\n          if (values[i]) {\n              entries.push({ value: values[i], content: values[i], has_submenu: true });\n          }\n      }\n\n      //show categories\n      var menu = new LiteGraph.ContextMenu( entries, { event: e, callback: inner_clicked, parentMenu: prev_menu }, ref_window );\n\n      function inner_clicked(v, option, e) {\n          var category = v.value;\n          var node_types = LiteGraph.getNodeTypesInCategory( category, canvas.filter );\n          var values = [];\n          for (var i in node_types) {\n              if (!node_types[i].skip_list) {\n                  values.push({\n                      content: node_types[i].title,\n                      value: node_types[i].type\n                  });\n              }\n          }\n\n          new LiteGraph.ContextMenu( values, { event: e, callback: inner_create, parentMenu: menu }, ref_window );\n          return false;\n      }\n\n      function inner_create(v, e) {\n          var first_event = prev_menu.getFirstEvent();\n          var node = LiteGraph.createNode(v.value);\n          if (node) {\n              node.pos = canvas.convertEventToCanvasOffset(first_event);\n              canvas.graph.add(node);\n          }\n    if(callback)\n      callback(node);\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuCollapseAll = function() {};\n\n  LGraphCanvas.onMenuNodeEdit = function() {};\n\n  LGraphCanvas.showMenuNodeOptionalInputs = function(\n      v,\n      options,\n      e,\n      prev_menu,\n      node\n  ) {\n      if (!node) {\n          return;\n      }\n\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var options = node.optional_inputs;\n      if (node.onGetInputs) {\n          options = node.onGetInputs();\n      }\n\n      var entries = [];\n      if (options) {\n          for (var i in options) {\n              var entry = options[i];\n              if (!entry) {\n                  entries.push(null);\n                  continue;\n              }\n              var label = entry[0];\n              if (entry[2] && entry[2].label) {\n                  label = entry[2].label;\n              }\n              var data = { content: label, value: entry };\n              if (entry[1] == LiteGraph.ACTION) {\n                  data.className = \"event\";\n              }\n              entries.push(data);\n          }\n      }\n\n      if (this.onMenuNodeInputs) {\n          entries = this.onMenuNodeInputs(entries);\n      }\n\n      if (!entries.length) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(\n          entries,\n          {\n              event: e,\n              callback: inner_clicked,\n              parentMenu: prev_menu,\n              node: node\n          },\n          ref_window\n      );\n\n      function inner_clicked(v, e, prev) {\n          if (!node) {\n              return;\n          }\n\n          if (v.callback) {\n              v.callback.call(that, node, v, e, prev);\n          }\n\n          if (v.value) {\n              node.addInput(v.value[0], v.value[1], v.value[2]);\n              node.setDirtyCanvas(true, true);\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.showMenuNodeOptionalOutputs = function(\n      v,\n      options,\n      e,\n      prev_menu,\n      node\n  ) {\n      if (!node) {\n          return;\n      }\n\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var options = node.optional_outputs;\n      if (node.onGetOutputs) {\n          options = node.onGetOutputs();\n      }\n\n      var entries = [];\n      if (options) {\n          for (var i in options) {\n              var entry = options[i];\n              if (!entry) {\n                  //separator?\n                  entries.push(null);\n                  continue;\n              }\n\n              if (\n                  node.flags &&\n                  node.flags.skip_repeated_outputs &&\n                  node.findOutputSlot(entry[0]) != -1\n              ) {\n                  continue;\n              } //skip the ones already on\n              var label = entry[0];\n              if (entry[2] && entry[2].label) {\n                  label = entry[2].label;\n              }\n              var data = { content: label, value: entry };\n              if (entry[1] == LiteGraph.EVENT) {\n                  data.className = \"event\";\n              }\n              entries.push(data);\n          }\n      }\n\n      if (this.onMenuNodeOutputs) {\n          entries = this.onMenuNodeOutputs(entries);\n      }\n\n      if (!entries.length) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(\n          entries,\n          {\n              event: e,\n              callback: inner_clicked,\n              parentMenu: prev_menu,\n              node: node\n          },\n          ref_window\n      );\n\n      function inner_clicked(v, e, prev) {\n          if (!node) {\n              return;\n          }\n\n          if (v.callback) {\n              v.callback.call(that, node, v, e, prev);\n          }\n\n          if (!v.value) {\n              return;\n          }\n\n          var value = v.value[1];\n\n          if (\n              value &&\n              (value.constructor === Object || value.constructor === Array)\n          ) {\n              //submenu why?\n              var entries = [];\n              for (var i in value) {\n                  entries.push({ content: i, value: value[i] });\n              }\n              new LiteGraph.ContextMenu(entries, {\n                  event: e,\n                  callback: inner_clicked,\n                  parentMenu: prev_menu,\n                  node: node\n              });\n              return false;\n          } else {\n              node.addOutput(v.value[0], v.value[1], v.value[2]);\n              node.setDirtyCanvas(true, true);\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onShowMenuNodeProperties = function(\n      value,\n      options,\n      e,\n      prev_menu,\n      node\n  ) {\n      if (!node || !node.properties) {\n          return;\n      }\n\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var entries = [];\n      for (var i in node.properties) {\n          var value = node.properties[i] !== undefined ? node.properties[i] : \" \";\n    if( typeof value == \"object\" )\n      value = JSON.stringify(value);\n          //value could contain invalid html characters, clean that\n          value = LGraphCanvas.decodeHTML(value);\n          entries.push({\n              content:\n                  \"<span class='property_name'>\" +\n                  i +\n                  \"</span>\" +\n                  \"<span class='property_value'>\" +\n                  value +\n                  \"</span>\",\n              value: i\n          });\n      }\n      if (!entries.length) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(\n          entries,\n          {\n              event: e,\n              callback: inner_clicked,\n              parentMenu: prev_menu,\n              allow_html: true,\n              node: node\n          },\n          ref_window\n      );\n\n      function inner_clicked(v, options, e, prev) {\n          if (!node) {\n              return;\n          }\n          var rect = this.getBoundingClientRect();\n          canvas.showEditPropertyValue(node, v.value, {\n              position: [rect.left, rect.top]\n          });\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.decodeHTML = function(str) {\n      var e = document.createElement(\"div\");\n      e.innerText = str;\n      return e.innerHTML;\n  };\n\n  LGraphCanvas.onResizeNode = function(value, options, e, menu, node) {\n      if (!node) {\n          return;\n      }\n      node.size = node.computeSize();\n      node.setDirtyCanvas(true, true);\n  };\n\n  LGraphCanvas.prototype.showLinkMenu = function(link, e) {\n      var that = this;\n  console.log(link);\n  var options = [\"Add Node\",null,\"Delete\"];\n      var menu = new LiteGraph.ContextMenu(options, {\n          event: e,\n    title: link.data != null ? link.data.constructor.name : null,\n          callback: inner_clicked\n      });\n\n      function inner_clicked(v,options,e) {\n          switch (v) {\n              case \"Add Node\":\n        LGraphCanvas.onMenuAdd(null, null, e, menu, function(node){\n          console.log(\"node autoconnect\");\n          var node_left = that.graph.getNodeById( link.origin_id );\n          var node_right = that.graph.getNodeById( link.target_id );\n          if(!node.inputs || !node.inputs.length || !node.outputs || !node.outputs.length)\n            return;\n          if( node_left.outputs[ link.origin_slot ].type == node.inputs[0].type && node.outputs[0].type == node_right.inputs[0].type )\n          {\n            node_left.connect( link.origin_slot, node, 0 );\n            node.connect( 0, node_right, link.target_slot );\n            node.pos[0] -= node.size[0] * 0.5;\n          }\n        });\n        break;\n              case \"Delete\":\n                  that.graph.removeLink(link.id);\n                  break;\n              default:\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onShowPropertyEditor = function(item, options, e, menu, node) {\n      var input_html = \"\";\n      var property = item.property || \"title\";\n      var value = node[property];\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"graphdialog\";\n      dialog.innerHTML =\n          \"<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>\";\n      var title = dialog.querySelector(\".name\");\n      title.innerText = property;\n      var input = dialog.querySelector(\"input\");\n      if (input) {\n          input.value = value;\n          input.addEventListener(\"blur\", function(e) {\n              this.focus();\n          });\n          input.addEventListener(\"keydown\", function(e) {\n              if (e.keyCode != 13) {\n                  return;\n              }\n              inner();\n              e.preventDefault();\n              e.stopPropagation();\n          });\n      }\n\n      var graphcanvas = LGraphCanvas.active_canvas;\n      var canvas = graphcanvas.canvas;\n\n      var rect = canvas.getBoundingClientRect();\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (event) {\n          dialog.style.left = event.clientX + offsetx + \"px\";\n          dialog.style.top = event.clientY + offsety + \"px\";\n      } else {\n          dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n          dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n      }\n\n      var button = dialog.querySelector(\"button\");\n      button.addEventListener(\"click\", inner);\n      canvas.parentNode.appendChild(dialog);\n\n      function inner() {\n          setValue(input.value);\n      }\n\n      function setValue(value) {\n          if (item.type == \"Number\") {\n              value = Number(value);\n          } else if (item.type == \"Boolean\") {\n              value = Boolean(value);\n          }\n          node[property] = value;\n          if (dialog.parentNode) {\n              dialog.parentNode.removeChild(dialog);\n          }\n          node.setDirtyCanvas(true, true);\n      }\n  };\n\n  LGraphCanvas.prototype.prompt = function(title, value, callback, event) {\n      var that = this;\n      var input_html = \"\";\n      title = title || \"\";\n\n      var modified = false;\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"graphdialog rounded\";\n      dialog.innerHTML =\n          \"<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>\";\n      dialog.close = function() {\n          that.prompt_box = null;\n          if (dialog.parentNode) {\n              dialog.parentNode.removeChild(dialog);\n          }\n      };\n\n      if (this.ds.scale > 1) {\n          dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n      }\n\n      dialog.addEventListener(\"mouseleave\", function(e) {\n          if (!modified) {\n              dialog.close();\n          }\n      });\n\n      if (that.prompt_box) {\n          that.prompt_box.close();\n      }\n      that.prompt_box = dialog;\n\n      var first = null;\n      var timeout = null;\n      var selected = null;\n\n      var name_element = dialog.querySelector(\".name\");\n      name_element.innerText = title;\n      var value_element = dialog.querySelector(\".value\");\n      value_element.value = value;\n\n      var input = dialog.querySelector(\"input\");\n      input.addEventListener(\"keydown\", function(e) {\n          modified = true;\n          if (e.keyCode == 27) {\n              //ESC\n              dialog.close();\n          } else if (e.keyCode == 13) {\n              if (callback) {\n                  callback(this.value);\n              }\n              dialog.close();\n          } else {\n              return;\n          }\n          e.preventDefault();\n          e.stopPropagation();\n      });\n\n      var button = dialog.querySelector(\"button\");\n      button.addEventListener(\"click\", function(e) {\n          if (callback) {\n              callback(input.value);\n          }\n          that.setDirty(true);\n          dialog.close();\n      });\n\n      var graphcanvas = LGraphCanvas.active_canvas;\n      var canvas = graphcanvas.canvas;\n\n      var rect = canvas.getBoundingClientRect();\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (event) {\n          dialog.style.left = event.clientX + offsetx + \"px\";\n          dialog.style.top = event.clientY + offsety + \"px\";\n      } else {\n          dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n          dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n      }\n\n      canvas.parentNode.appendChild(dialog);\n      setTimeout(function() {\n          input.focus();\n      }, 10);\n\n      return dialog;\n  };\n\n  LGraphCanvas.search_limit = -1;\n  LGraphCanvas.prototype.showSearchBox = function(event) {\n      var that = this;\n      var input_html = \"\";\n      var graphcanvas = LGraphCanvas.active_canvas;\n      var canvas = graphcanvas.canvas;\n      var root_document = canvas.ownerDocument || document;\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"litegraph litesearchbox graphdialog rounded\";\n      dialog.innerHTML =\n          \"<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>\";\n      dialog.close = function() {\n          that.search_box = null;\n          root_document.body.focus();\n    root_document.body.style.overflow = \"\";\n\n          setTimeout(function() {\n              that.canvas.focus();\n          }, 20); //important, if canvas loses focus keys wont be captured\n          if (dialog.parentNode) {\n              dialog.parentNode.removeChild(dialog);\n          }\n      };\n\n      var timeout_close = null;\n\n      if (this.ds.scale > 1) {\n          dialog.style.transform = \"scale(\" + this.ds.scale + \")\";\n      }\n\n      dialog.addEventListener(\"mouseenter\", function(e) {\n          if (timeout_close) {\n              clearTimeout(timeout_close);\n              timeout_close = null;\n          }\n      });\n\n      dialog.addEventListener(\"mouseleave\", function(e) {\n          //dialog.close();\n          timeout_close = setTimeout(function() {\n              dialog.close();\n          }, 500);\n      });\n\n      if (that.search_box) {\n          that.search_box.close();\n      }\n      that.search_box = dialog;\n\n      var helper = dialog.querySelector(\".helper\");\n\n      var first = null;\n      var timeout = null;\n      var selected = null;\n\n      var input = dialog.querySelector(\"input\");\n      if (input) {\n          input.addEventListener(\"blur\", function(e) {\n              this.focus();\n          });\n          input.addEventListener(\"keydown\", function(e) {\n              if (e.keyCode == 38) {\n                  //UP\n                  changeSelection(false);\n              } else if (e.keyCode == 40) {\n                  //DOWN\n                  changeSelection(true);\n              } else if (e.keyCode == 27) {\n                  //ESC\n                  dialog.close();\n              } else if (e.keyCode == 13) {\n                  if (selected) {\n                      select(selected.innerHTML);\n                  } else if (first) {\n                      select(first);\n                  } else {\n                      dialog.close();\n                  }\n              } else {\n                  if (timeout) {\n                      clearInterval(timeout);\n                  }\n                  timeout = setTimeout(refreshHelper, 10);\n                  return;\n              }\n              e.preventDefault();\n              e.stopPropagation();\n      e.stopImmediatePropagation();\n      return true;\n          });\n      }\n\n  if( root_document.fullscreenElement )\n        root_document.fullscreenElement.appendChild(dialog);\n  else\n  {\n      root_document.body.appendChild(dialog);\n    root_document.body.style.overflow = \"hidden\";\n  }\n\n      //compute best position\n      var rect = canvas.getBoundingClientRect();\n\n      var left = ( event ? event.clientX : (rect.left + rect.width * 0.5) ) - 80;\n      var top = ( event ? event.clientY : (rect.top + rect.height * 0.5) ) - 20;\n      dialog.style.left = left + \"px\";\n      dialog.style.top = top + \"px\";\n\n  //To avoid out of screen problems\n  if(event.layerY > (rect.height - 200)) \n          helper.style.maxHeight = (rect.height - event.layerY - 20) + \"px\";\n\n  /*\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (event) {\n          dialog.style.left = event.clientX + offsetx + \"px\";\n          dialog.style.top = event.clientY + offsety + \"px\";\n      } else {\n          dialog.style.left = canvas.width * 0.5 + offsetx + \"px\";\n          dialog.style.top = canvas.height * 0.5 + offsety + \"px\";\n      }\n      canvas.parentNode.appendChild(dialog);\n  */\n\n      input.focus();\n\n      function select(name) {\n          if (name) {\n              if (that.onSearchBoxSelection) {\n                  that.onSearchBoxSelection(name, event, graphcanvas);\n              } else {\n                  var extra = LiteGraph.searchbox_extras[name.toLowerCase()];\n                  if (extra) {\n                      name = extra.type;\n                  }\n\n                  var node = LiteGraph.createNode(name);\n                  if (node) {\n                      node.pos = graphcanvas.convertEventToCanvasOffset(\n                          event\n                      );\n                      graphcanvas.graph.add(node);\n                  }\n\n                  if (extra && extra.data) {\n                      if (extra.data.properties) {\n                          for (var i in extra.data.properties) {\n                              node.addProperty( i, extra.data.properties[i] );\n                          }\n                      }\n                      if (extra.data.inputs) {\n                          node.inputs = [];\n                          for (var i in extra.data.inputs) {\n                              node.addOutput(\n                                  extra.data.inputs[i][0],\n                                  extra.data.inputs[i][1]\n                              );\n                          }\n                      }\n                      if (extra.data.outputs) {\n                          node.outputs = [];\n                          for (var i in extra.data.outputs) {\n                              node.addOutput(\n                                  extra.data.outputs[i][0],\n                                  extra.data.outputs[i][1]\n                              );\n                          }\n                      }\n                      if (extra.data.title) {\n                          node.title = extra.data.title;\n                      }\n                      if (extra.data.json) {\n                          node.configure(extra.data.json);\n                      }\n                  }\n              }\n          }\n\n          dialog.close();\n      }\n\n      function changeSelection(forward) {\n          var prev = selected;\n          if (selected) {\n              selected.classList.remove(\"selected\");\n          }\n          if (!selected) {\n              selected = forward\n                  ? helper.childNodes[0]\n                  : helper.childNodes[helper.childNodes.length];\n          } else {\n              selected = forward\n                  ? selected.nextSibling\n                  : selected.previousSibling;\n              if (!selected) {\n                  selected = prev;\n              }\n          }\n          if (!selected) {\n              return;\n          }\n          selected.classList.add(\"selected\");\n          selected.scrollIntoView({block: \"end\", behavior: \"smooth\"});\n      }\n\n      function refreshHelper() {\n          timeout = null;\n          var str = input.value;\n          first = null;\n          helper.innerHTML = \"\";\n          if (!str) {\n              return;\n          }\n\n          if (that.onSearchBox) {\n              var list = that.onSearchBox(helper, str, graphcanvas);\n              if (list) {\n                  for (var i = 0; i < list.length; ++i) {\n                      addResult(list[i]);\n                  }\n              }\n          } else {\n              var c = 0;\n              str = str.toLowerCase();\n      var filter = graphcanvas.filter || graphcanvas.graph.filter;\n\n              //extras\n              for (var i in LiteGraph.searchbox_extras) {\n                  var extra = LiteGraph.searchbox_extras[i];\n                  if (extra.desc.toLowerCase().indexOf(str) === -1) {\n                      continue;\n                  }\n        var ctor = LiteGraph.registered_node_types[ extra.type ];\n        if( ctor && ctor.filter && ctor.filter != filter )\n          continue;\n                  addResult( extra.desc, \"searchbox_extra\" );\n                  if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n                      break;\n                  }\n              }\n\n      var filtered = null;\n              if (Array.prototype.filter) { //filter supported\n                  var keys = Object.keys( LiteGraph.registered_node_types ); //types\n                  var filtered = keys.filter( inner_test_filter );\n              } else {\n        filtered = [];\n                  for (var i in LiteGraph.registered_node_types) {\n          if( inner_test_filter(i) )\n            filtered.push(i);\n                  }\n              }\n\n      for (var i = 0; i < filtered.length; i++) {\n        addResult(filtered[i]);\n        if ( LGraphCanvas.search_limit !== -1 && c++ > LGraphCanvas.search_limit ) {\n          break;\n        }\n      }\n\n      function inner_test_filter( type )\n      {\n        var ctor = LiteGraph.registered_node_types[ type ];\n        if(filter && ctor.filter != filter )\n          return false;\n        return type.toLowerCase().indexOf(str) !== -1;\n      }\n          }\n\n          function addResult(type, className) {\n              var help = document.createElement(\"div\");\n              if (!first) {\n                  first = type;\n              }\n              help.innerText = type;\n              help.dataset[\"type\"] = escape(type);\n              help.className = \"litegraph lite-search-item\";\n              if (className) {\n                  help.className += \" \" + className;\n              }\n              help.addEventListener(\"click\", function(e) {\n                  select(unescape(this.dataset[\"type\"]));\n              });\n              helper.appendChild(help);\n          }\n      }\n\n      return dialog;\n  };\n\n  LGraphCanvas.prototype.showEditPropertyValue = function(\n      node,\n      property,\n      options\n  ) {\n      if (!node || node.properties[property] === undefined) {\n          return;\n      }\n\n      options = options || {};\n      var that = this;\n\n      var type = \"string\";\n\n      if (node.properties[property] !== null) {\n          type = typeof node.properties[property];\n      }\n\n      var info = null;\n      if (node.getPropertyInfo) {\n          info = node.getPropertyInfo(property);\n      }\n      if (node.properties_info) {\n          for (var i = 0; i < node.properties_info.length; ++i) {\n              if (node.properties_info[i].name == property) {\n                  info = node.properties_info[i];\n                  break;\n              }\n          }\n      }\n\n      if (info !== undefined && info !== null && info.type) {\n          type = info.type;\n      }\n\n      var input_html = \"\";\n\n      if (type == \"string\" || type == \"number\" || type == \"array\" || type == \"object\") {\n          input_html = \"<input autofocus type='text' class='value'/>\";\n      } else if (type == \"enum\" && info.values) {\n          input_html = \"<select autofocus type='text' class='value'>\";\n          for (var i in info.values) {\n              var v = info.values.constructor === Array ? info.values[i] : i;\n              input_html +=\n                  \"<option value='\" +\n                  v +\n                  \"' \" +\n                  (v == node.properties[property] ? \"selected\" : \"\") +\n                  \">\" +\n                  info.values[i] +\n                  \"</option>\";\n          }\n          input_html += \"</select>\";\n      } else if (type == \"boolean\") {\n          input_html =\n              \"<input autofocus type='checkbox' class='value' \" +\n              (node.properties[property] ? \"checked\" : \"\") +\n              \"/>\";\n      } else {\n          console.warn(\"unknown type: \" + type);\n          return;\n      }\n\n      var dialog = this.createDialog(\n          \"<span class='name'>\" +\n              property +\n              \"</span>\" +\n              input_html +\n              \"<button>OK</button>\",\n          options\n      );\n\n      if (type == \"enum\" && info.values) {\n          var input = dialog.querySelector(\"select\");\n          input.addEventListener(\"change\", function(e) {\n              setValue(e.target.value);\n              //var index = e.target.value;\n              //setValue( e.options[e.selectedIndex].value );\n          });\n      } else if (type == \"boolean\") {\n          var input = dialog.querySelector(\"input\");\n          if (input) {\n              input.addEventListener(\"click\", function(e) {\n                  setValue(!!input.checked);\n              });\n          }\n      } else {\n          var input = dialog.querySelector(\"input\");\n          if (input) {\n              input.addEventListener(\"blur\", function(e) {\n                  this.focus();\n              });\n      var v = node.properties[property] !== undefined ? node.properties[property] : \"\";\n      v = JSON.stringify(v);\n              input.value = v;\n              input.addEventListener(\"keydown\", function(e) {\n                  if (e.keyCode != 13) {\n                      return;\n                  }\n                  inner();\n                  e.preventDefault();\n                  e.stopPropagation();\n              });\n          }\n      }\n\n      var button = dialog.querySelector(\"button\");\n      button.addEventListener(\"click\", inner);\n\n      function inner() {\n          setValue(input.value);\n      }\n\n      function setValue(value) {\n          if (typeof node.properties[property] == \"number\") {\n              value = Number(value);\n          }\n          if (type == \"array\" || type == \"object\") {\n              value = JSON.parse(value);\n          }\n          node.properties[property] = value;\n          if (node._graph) {\n              node._graph._version++;\n          }\n          if (node.onPropertyChanged) {\n              node.onPropertyChanged(property, value);\n          }\n          dialog.close();\n          node.setDirtyCanvas(true, true);\n      }\n  };\n\n  LGraphCanvas.prototype.createDialog = function(html, options) {\n      options = options || {};\n\n      var dialog = document.createElement(\"div\");\n      dialog.className = \"graphdialog\";\n      dialog.innerHTML = html;\n\n      var rect = this.canvas.getBoundingClientRect();\n      var offsetx = -20;\n      var offsety = -20;\n      if (rect) {\n          offsetx -= rect.left;\n          offsety -= rect.top;\n      }\n\n      if (options.position) {\n          offsetx += options.position[0];\n          offsety += options.position[1];\n      } else if (options.event) {\n          offsetx += options.event.clientX;\n          offsety += options.event.clientY;\n      } //centered\n      else {\n          offsetx += this.canvas.width * 0.5;\n          offsety += this.canvas.height * 0.5;\n      }\n\n      dialog.style.left = offsetx + \"px\";\n      dialog.style.top = offsety + \"px\";\n\n      this.canvas.parentNode.appendChild(dialog);\n\n      dialog.close = function() {\n          if (this.parentNode) {\n              this.parentNode.removeChild(this);\n          }\n      };\n\n      return dialog;\n  };\n\n  LGraphCanvas.onMenuNodeCollapse = function(value, options, e, menu, node) {\n      node.collapse();\n  };\n\n  LGraphCanvas.onMenuNodePin = function(value, options, e, menu, node) {\n      node.pin();\n  };\n\n  LGraphCanvas.onMenuNodeMode = function(value, options, e, menu, node) {\n      new LiteGraph.ContextMenu(\n          [\"Always\", \"On Event\", \"On Trigger\", \"Never\"],\n          { event: e, callback: inner_clicked, parentMenu: menu, node: node }\n      );\n\n      function inner_clicked(v) {\n          if (!node) {\n              return;\n          }\n          switch (v) {\n              case \"On Event\":\n                  node.mode = LiteGraph.ON_EVENT;\n                  break;\n              case \"On Trigger\":\n                  node.mode = LiteGraph.ON_TRIGGER;\n                  break;\n              case \"Never\":\n                  node.mode = LiteGraph.NEVER;\n                  break;\n              case \"Always\":\n              default:\n                  node.mode = LiteGraph.ALWAYS;\n                  break;\n          }\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuNodeColors = function(value, options, e, menu, node) {\n      if (!node) {\n          throw \"no node for color\";\n      }\n\n      var values = [];\n      values.push({\n          value: null,\n          content:\n              \"<span style='display: block; padding-left: 4px;'>No color</span>\"\n      });\n\n      for (var i in LGraphCanvas.node_colors) {\n          var color = LGraphCanvas.node_colors[i];\n          var value = {\n              value: i,\n              content:\n                  \"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid \" +\n                  color.color +\n                  \"; background-color:\" +\n                  color.bgcolor +\n                  \"'>\" +\n                  i +\n                  \"</span>\"\n          };\n          values.push(value);\n      }\n      new LiteGraph.ContextMenu(values, {\n          event: e,\n          callback: inner_clicked,\n          parentMenu: menu,\n          node: node\n      });\n\n      function inner_clicked(v) {\n          if (!node) {\n              return;\n          }\n\n          var color = v.value ? LGraphCanvas.node_colors[v.value] : null;\n          if (color) {\n              if (node.constructor === LiteGraph.LGraphGroup) {\n                  node.color = color.groupcolor;\n              } else {\n                  node.color = color.color;\n                  node.bgcolor = color.bgcolor;\n              }\n          } else {\n              delete node.color;\n              delete node.bgcolor;\n          }\n          node.setDirtyCanvas(true, true);\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuNodeShapes = function(value, options, e, menu, node) {\n      if (!node) {\n          throw \"no node passed\";\n      }\n\n      new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES, {\n          event: e,\n          callback: inner_clicked,\n          parentMenu: menu,\n          node: node\n      });\n\n      function inner_clicked(v) {\n          if (!node) {\n              return;\n          }\n          node.shape = v;\n          node.setDirtyCanvas(true);\n      }\n\n      return false;\n  };\n\n  LGraphCanvas.onMenuNodeRemove = function(value, options, e, menu, node) {\n      if (!node) {\n          throw \"no node passed\";\n      }\n\n      if (node.removable === false) {\n          return;\n      }\n\n      node.graph.remove(node);\n      node.setDirtyCanvas(true, true);\n  };\n\n  LGraphCanvas.onMenuNodeClone = function(value, options, e, menu, node) {\n      if (node.clonable == false) {\n          return;\n      }\n      var newnode = node.clone();\n      if (!newnode) {\n          return;\n      }\n      newnode.pos = [node.pos[0] + 5, node.pos[1] + 5];\n      node.graph.add(newnode);\n      node.setDirtyCanvas(true, true);\n  };\n\n  LGraphCanvas.node_colors = {\n      red: { color: \"#322\", bgcolor: \"#533\", groupcolor: \"#A88\" },\n      brown: { color: \"#332922\", bgcolor: \"#593930\", groupcolor: \"#b06634\" },\n      green: { color: \"#232\", bgcolor: \"#353\", groupcolor: \"#8A8\" },\n      blue: { color: \"#223\", bgcolor: \"#335\", groupcolor: \"#88A\" },\n      pale_blue: {\n          color: \"#2a363b\",\n          bgcolor: \"#3f5159\",\n          groupcolor: \"#3f789e\"\n      },\n      cyan: { color: \"#233\", bgcolor: \"#355\", groupcolor: \"#8AA\" },\n      purple: { color: \"#323\", bgcolor: \"#535\", groupcolor: \"#a1309b\" },\n      yellow: { color: \"#432\", bgcolor: \"#653\", groupcolor: \"#b58b2a\" },\n      black: { color: \"#222\", bgcolor: \"#000\", groupcolor: \"#444\" }\n  };\n\n  LGraphCanvas.prototype.getCanvasMenuOptions = function() {\n      var options = null;\n      if (this.getMenuOptions) {\n          options = this.getMenuOptions();\n      } else {\n          options = [\n              {\n                  content: \"Add Node\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuAdd\n              },\n              { content: \"Add Group\", callback: LGraphCanvas.onGroupAdd }\n              //{content:\"Collapse All\", callback: LGraphCanvas.onMenuCollapseAll }\n          ];\n\n          if (this._graph_stack && this._graph_stack.length > 0) {\n              options.push(null, {\n                  content: \"Close subgraph\",\n                  callback: this.closeSubgraph.bind(this)\n              });\n          }\n      }\n\n      if (this.getExtraMenuOptions) {\n          var extra = this.getExtraMenuOptions(this, options);\n          if (extra) {\n              options = options.concat(extra);\n          }\n      }\n\n      return options;\n  };\n\n  //called by processContextMenu to extract the menu list\n  LGraphCanvas.prototype.getNodeMenuOptions = function(node) {\n      var options = null;\n\n      if (node.getMenuOptions) {\n          options = node.getMenuOptions(this);\n      } else {\n          options = [\n              {\n                  content: \"Inputs\",\n                  has_submenu: true,\n                  disabled: true,\n                  callback: LGraphCanvas.showMenuNodeOptionalInputs\n              },\n              {\n                  content: \"Outputs\",\n                  has_submenu: true,\n                  disabled: true,\n                  callback: LGraphCanvas.showMenuNodeOptionalOutputs\n              },\n              null,\n              {\n                  content: \"Properties\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onShowMenuNodeProperties\n              },\n              null,\n              {\n                  content: \"Title\",\n                  callback: LGraphCanvas.onShowPropertyEditor\n              },\n              {\n                  content: \"Mode\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuNodeMode\n              },\n              { content: \"Resize\", callback: LGraphCanvas.onResizeNode },\n              {\n                  content: \"Collapse\",\n                  callback: LGraphCanvas.onMenuNodeCollapse\n              },\n              { content: \"Pin\", callback: LGraphCanvas.onMenuNodePin },\n              {\n                  content: \"Colors\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuNodeColors\n              },\n              {\n                  content: \"Shapes\",\n                  has_submenu: true,\n                  callback: LGraphCanvas.onMenuNodeShapes\n              },\n              null\n          ];\n      }\n\n      if (node.onGetInputs) {\n          var inputs = node.onGetInputs();\n          if (inputs && inputs.length) {\n              options[0].disabled = false;\n          }\n      }\n\n      if (node.onGetOutputs) {\n          var outputs = node.onGetOutputs();\n          if (outputs && outputs.length) {\n              options[1].disabled = false;\n          }\n      }\n\n      if (node.getExtraMenuOptions) {\n          var extra = node.getExtraMenuOptions(this);\n          if (extra) {\n              extra.push(null);\n              options = extra.concat(options);\n          }\n      }\n\n      if (node.clonable !== false) {\n          options.push({\n              content: \"Clone\",\n              callback: LGraphCanvas.onMenuNodeClone\n          });\n      }\n      if (node.removable !== false) {\n          options.push(null, {\n              content: \"Remove\",\n              callback: LGraphCanvas.onMenuNodeRemove\n          });\n      }\n\n      if (node.graph && node.graph.onGetNodeMenuOptions) {\n          node.graph.onGetNodeMenuOptions(options, node);\n      }\n\n      return options;\n  };\n\n  LGraphCanvas.prototype.getGroupMenuOptions = function(node) {\n      var o = [\n          { content: \"Title\", callback: LGraphCanvas.onShowPropertyEditor },\n          {\n              content: \"Color\",\n              has_submenu: true,\n              callback: LGraphCanvas.onMenuNodeColors\n          },\n          {\n              content: \"Font size\",\n              property: \"font_size\",\n              type: \"Number\",\n              callback: LGraphCanvas.onShowPropertyEditor\n          },\n          null,\n          { content: \"Remove\", callback: LGraphCanvas.onMenuNodeRemove }\n      ];\n\n      return o;\n  };\n\n  LGraphCanvas.prototype.processContextMenu = function(node, event) {\n      var that = this;\n      var canvas = LGraphCanvas.active_canvas;\n      var ref_window = canvas.getCanvasWindow();\n\n      var menu_info = null;\n      var options = {\n          event: event,\n          callback: inner_option_clicked,\n          extra: node\n      };\n\n  if(node)\n    options.title = node.type;\n\n      //check if mouse is in input\n      var slot = null;\n      if (node) {\n          slot = node.getSlotInPosition(event.canvasX, event.canvasY);\n          LGraphCanvas.active_node = node;\n      }\n\n      if (slot) {\n          //on slot\n          menu_info = [];\n          if (\n              slot &&\n              slot.output &&\n              slot.output.links &&\n              slot.output.links.length\n          ) {\n              menu_info.push({ content: \"Disconnect Links\", slot: slot });\n          }\n          var _slot = slot.input || slot.output;\n          menu_info.push(\n              _slot.locked\n                  ? \"Cannot remove\"\n                  : { content: \"Remove Slot\", slot: slot }\n          );\n          menu_info.push(\n              _slot.nameLocked\n                  ? \"Cannot rename\"\n                  : { content: \"Rename Slot\", slot: slot }\n          );\n          options.title =\n              (slot.input ? slot.input.type : slot.output.type) || \"*\";\n          if (slot.input && slot.input.type == LiteGraph.ACTION) {\n              options.title = \"Action\";\n          }\n          if (slot.output && slot.output.type == LiteGraph.EVENT) {\n              options.title = \"Event\";\n          }\n      } else {\n          if (node) {\n              //on node\n              menu_info = this.getNodeMenuOptions(node);\n          } else {\n              menu_info = this.getCanvasMenuOptions();\n              var group = this.graph.getGroupOnPos(\n                  event.canvasX,\n                  event.canvasY\n              );\n              if (group) {\n                  //on group\n                  menu_info.push(null, {\n                      content: \"Edit Group\",\n                      has_submenu: true,\n                      submenu: {\n                          title: \"Group\",\n                          extra: group,\n                          options: this.getGroupMenuOptions(group)\n                      }\n                  });\n              }\n          }\n      }\n\n      //show menu\n      if (!menu_info) {\n          return;\n      }\n\n      var menu = new LiteGraph.ContextMenu(menu_info, options, ref_window);\n\n      function inner_option_clicked(v, options, e) {\n          if (!v) {\n              return;\n          }\n\n          if (v.content == \"Remove Slot\") {\n              var info = v.slot;\n              if (info.input) {\n                  node.removeInput(info.slot);\n              } else if (info.output) {\n                  node.removeOutput(info.slot);\n              }\n              return;\n          } else if (v.content == \"Disconnect Links\") {\n              var info = v.slot;\n              if (info.output) {\n                  node.disconnectOutput(info.slot);\n              } else if (info.input) {\n                  node.disconnectInput(info.slot);\n              }\n              return;\n          } else if (v.content == \"Rename Slot\") {\n              var info = v.slot;\n              var slot_info = info.input\n                  ? node.getInputInfo(info.slot)\n                  : node.getOutputInfo(info.slot);\n              var dialog = that.createDialog(\n                  \"<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>\",\n                  options\n              );\n              var input = dialog.querySelector(\"input\");\n              if (input && slot_info) {\n                  input.value = slot_info.label || \"\";\n              }\n              dialog\n                  .querySelector(\"button\")\n                  .addEventListener(\"click\", function(e) {\n                      if (input.value) {\n                          if (slot_info) {\n                              slot_info.label = input.value;\n                          }\n                          that.setDirty(true);\n                      }\n                      dialog.close();\n                  });\n          }\n\n          //if(v.callback)\n          //\treturn v.callback.call(that, node, options, e, menu, that, event );\n      }\n  };\n\n  //API *************************************************\n  //like rect but rounded corners\n  if (this.CanvasRenderingContext2D) {\n      CanvasRenderingContext2D.prototype.roundRect = function(\n          x,\n          y,\n          width,\n          height,\n          radius,\n          radius_low\n      ) {\n          if (radius === undefined) {\n              radius = 5;\n          }\n\n          if (radius_low === undefined) {\n              radius_low = radius;\n          }\n\n          this.moveTo(x + radius, y);\n          this.lineTo(x + width - radius, y);\n          this.quadraticCurveTo(x + width, y, x + width, y + radius);\n\n          this.lineTo(x + width, y + height - radius_low);\n          this.quadraticCurveTo(\n              x + width,\n              y + height,\n              x + width - radius_low,\n              y + height\n          );\n          this.lineTo(x + radius_low, y + height);\n          this.quadraticCurveTo(x, y + height, x, y + height - radius_low);\n          this.lineTo(x, y + radius);\n          this.quadraticCurveTo(x, y, x + radius, y);\n      };\n  }\n\n  function compareObjects(a, b) {\n      for (var i in a) {\n          if (a[i] != b[i]) {\n              return false;\n          }\n      }\n      return true;\n  }\n  LiteGraph.compareObjects = compareObjects;\n\n  function distance(a, b) {\n      return Math.sqrt(\n          (b[0] - a[0]) * (b[0] - a[0]) + (b[1] - a[1]) * (b[1] - a[1])\n      );\n  }\n  LiteGraph.distance = distance;\n\n  function colorToString(c) {\n      return (\n          \"rgba(\" +\n          Math.round(c[0] * 255).toFixed() +\n          \",\" +\n          Math.round(c[1] * 255).toFixed() +\n          \",\" +\n          Math.round(c[2] * 255).toFixed() +\n          \",\" +\n          (c.length == 4 ? c[3].toFixed(2) : \"1.0\") +\n          \")\"\n      );\n  }\n  LiteGraph.colorToString = colorToString;\n\n  function isInsideRectangle(x, y, left, top, width, height) {\n      if (left < x && left + width > x && top < y && top + height > y) {\n          return true;\n      }\n      return false;\n  }\n  LiteGraph.isInsideRectangle = isInsideRectangle;\n\n  //[minx,miny,maxx,maxy]\n  function growBounding(bounding, x, y) {\n      if (x < bounding[0]) {\n          bounding[0] = x;\n      } else if (x > bounding[2]) {\n          bounding[2] = x;\n      }\n\n      if (y < bounding[1]) {\n          bounding[1] = y;\n      } else if (y > bounding[3]) {\n          bounding[3] = y;\n      }\n  }\n  LiteGraph.growBounding = growBounding;\n\n  //point inside bounding box\n  function isInsideBounding(p, bb) {\n      if (\n          p[0] < bb[0][0] ||\n          p[1] < bb[0][1] ||\n          p[0] > bb[1][0] ||\n          p[1] > bb[1][1]\n      ) {\n          return false;\n      }\n      return true;\n  }\n  LiteGraph.isInsideBounding = isInsideBounding;\n\n  //bounding overlap, format: [ startx, starty, width, height ]\n  function overlapBounding(a, b) {\n      var A_end_x = a[0] + a[2];\n      var A_end_y = a[1] + a[3];\n      var B_end_x = b[0] + b[2];\n      var B_end_y = b[1] + b[3];\n\n      if (\n          a[0] > B_end_x ||\n          a[1] > B_end_y ||\n          A_end_x < b[0] ||\n          A_end_y < b[1]\n      ) {\n          return false;\n      }\n      return true;\n  }\n  LiteGraph.overlapBounding = overlapBounding;\n\n  //Convert a hex value to its decimal value - the inputted hex must be in the\n  //\tformat of a hex triplet - the kind we use for HTML colours. The function\n  //\twill return an array with three values.\n  function hex2num(hex) {\n      if (hex.charAt(0) == \"#\") {\n          hex = hex.slice(1);\n      } //Remove the '#' char - if there is one.\n      hex = hex.toUpperCase();\n      var hex_alphabets = \"0123456789ABCDEF\";\n      var value = new Array(3);\n      var k = 0;\n      var int1, int2;\n      for (var i = 0; i < 6; i += 2) {\n          int1 = hex_alphabets.indexOf(hex.charAt(i));\n          int2 = hex_alphabets.indexOf(hex.charAt(i + 1));\n          value[k] = int1 * 16 + int2;\n          k++;\n      }\n      return value;\n  }\n\n  LiteGraph.hex2num = hex2num;\n\n  //Give a array with three values as the argument and the function will return\n  //\tthe corresponding hex triplet.\n  function num2hex(triplet) {\n      var hex_alphabets = \"0123456789ABCDEF\";\n      var hex = \"#\";\n      var int1, int2;\n      for (var i = 0; i < 3; i++) {\n          int1 = triplet[i] / 16;\n          int2 = triplet[i] % 16;\n\n          hex += hex_alphabets.charAt(int1) + hex_alphabets.charAt(int2);\n      }\n      return hex;\n  }\n\n  LiteGraph.num2hex = num2hex;\n\n  /* LiteGraph GUI elements used for canvas editing *************************************/\n\n  /**\n   * ContextMenu from LiteGUI\n   *\n   * @class ContextMenu\n   * @constructor\n   * @param {Array} values (allows object { title: \"Nice text\", callback: function ... })\n   * @param {Object} options [optional] Some options:\\\n   * - title: title to show on top of the menu\n   * - callback: function to call when an option is clicked, it receives the item information\n   * - ignore_item_callbacks: ignores the callback inside the item, it just calls the options.callback\n   * - event: you can pass a MouseEvent, this way the ContextMenu appears in that position\n   */\n  function ContextMenu(values, options) {\n      options = options || {};\n      this.options = options;\n      var that = this;\n\n      //to link a menu with its parent\n      if (options.parentMenu) {\n          if (options.parentMenu.constructor !== this.constructor) {\n              console.error(\n                  \"parentMenu must be of class ContextMenu, ignoring it\"\n              );\n              options.parentMenu = null;\n          } else {\n              this.parentMenu = options.parentMenu;\n              this.parentMenu.lock = true;\n              this.parentMenu.current_submenu = this;\n          }\n      }\n\n      if (\n          options.event &&\n          options.event.constructor !== MouseEvent &&\n          options.event.constructor !== CustomEvent &&\n    options.event.constructor !== PointerEvent\n      ) {\n          console.error(\n              \"Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it.\"\n          );\n          options.event = null;\n      }\n\n      var root = document.createElement(\"div\");\n      root.className = \"litegraph litecontextmenu litemenubar-panel\";\n      if (options.className) {\n          root.className += \" \" + options.className;\n      }\n      root.style.minWidth = 100;\n      root.style.minHeight = 100;\n      root.style.pointerEvents = \"none\";\n      setTimeout(function() {\n          root.style.pointerEvents = \"auto\";\n      }, 100); //delay so the mouse up event is not caught by this element\n\n      //this prevents the default context browser menu to open in case this menu was created when pressing right button\n      root.addEventListener(\n          \"mouseup\",\n          function(e) {\n              e.preventDefault();\n              return true;\n          },\n          true\n      );\n      root.addEventListener(\n          \"contextmenu\",\n          function(e) {\n              if (e.button != 2) {\n                  //right button\n                  return false;\n              }\n              e.preventDefault();\n              return false;\n          },\n          true\n      );\n\n      root.addEventListener(\n          \"mousedown\",\n          function(e) {\n              if (e.button == 2) {\n                  that.close();\n                  e.preventDefault();\n                  return true;\n              }\n          },\n          true\n      );\n\n      function on_mouse_wheel(e) {\n          var pos = parseInt(root.style.top);\n          root.style.top =\n              (pos + e.deltaY * options.scroll_speed).toFixed() + \"px\";\n          e.preventDefault();\n          return true;\n      }\n\n      if (!options.scroll_speed) {\n          options.scroll_speed = 0.1;\n      }\n\n      root.addEventListener(\"wheel\", on_mouse_wheel, true);\n      root.addEventListener(\"mousewheel\", on_mouse_wheel, true);\n\n      this.root = root;\n\n      //title\n      if (options.title) {\n          var element = document.createElement(\"div\");\n          element.className = \"litemenu-title\";\n          element.innerHTML = options.title;\n          root.appendChild(element);\n      }\n\n      //entries\n      var num = 0;\n      for (var i in values) {\n          var name = values.constructor == Array ? values[i] : i;\n          if (name != null && name.constructor !== String) {\n              name = name.content === undefined ? String(name) : name.content;\n          }\n          var value = values[i];\n          this.addItem(name, value, options);\n          num++;\n      }\n\n      //close on leave\n      root.addEventListener(\"mouseleave\", function(e) {\n          if (that.lock) {\n              return;\n          }\n          if (root.closing_timer) {\n              clearTimeout(root.closing_timer);\n          }\n          root.closing_timer = setTimeout(that.close.bind(that, e), 500);\n          //that.close(e);\n      });\n\n      root.addEventListener(\"mouseenter\", function(e) {\n          if (root.closing_timer) {\n              clearTimeout(root.closing_timer);\n          }\n      });\n\n      //insert before checking position\n      var root_document = document;\n      if (options.event) {\n          root_document = options.event.target.ownerDocument;\n      }\n\n      if (!root_document) {\n          root_document = document;\n      }\n\n  if( root_document.fullscreenElement )\n        root_document.fullscreenElement.appendChild(root);\n  else\n      root_document.body.appendChild(root);\n\n      //compute best position\n      var left = options.left || 0;\n      var top = options.top || 0;\n      if (options.event) {\n          left = options.event.clientX - 10;\n          top = options.event.clientY - 10;\n          if (options.title) {\n              top -= 20;\n          }\n\n          if (options.parentMenu) {\n              var rect = options.parentMenu.root.getBoundingClientRect();\n              left = rect.left + rect.width;\n          }\n\n          var body_rect = document.body.getBoundingClientRect();\n          var root_rect = root.getBoundingClientRect();\n\n          if (left > body_rect.width - root_rect.width - 10) {\n              left = body_rect.width - root_rect.width - 10;\n          }\n          if (top > body_rect.height - root_rect.height - 10) {\n              top = body_rect.height - root_rect.height - 10;\n          }\n      }\n\n      root.style.left = left + \"px\";\n      root.style.top = top + \"px\";\n\n      if (options.scale) {\n          root.style.transform = \"scale(\" + options.scale + \")\";\n      }\n  }\n\n  ContextMenu.prototype.addItem = function(name, value, options) {\n      var that = this;\n      options = options || {};\n\n      var element = document.createElement(\"div\");\n      element.className = \"litemenu-entry submenu\";\n\n      var disabled = false;\n\n      if (value === null) {\n          element.classList.add(\"separator\");\n          //element.innerHTML = \"<hr/>\"\n          //continue;\n      } else {\n          element.innerHTML = value && value.title ? value.title : name;\n          element.value = value;\n\n          if (value) {\n              if (value.disabled) {\n                  disabled = true;\n                  element.classList.add(\"disabled\");\n              }\n              if (value.submenu || value.has_submenu) {\n                  element.classList.add(\"has_submenu\");\n              }\n          }\n\n          if (typeof value == \"function\") {\n              element.dataset[\"value\"] = name;\n              element.onclick_callback = value;\n          } else {\n              element.dataset[\"value\"] = value;\n          }\n\n          if (value.className) {\n              element.className += \" \" + value.className;\n          }\n      }\n\n      this.root.appendChild(element);\n      if (!disabled) {\n          element.addEventListener(\"click\", inner_onclick);\n      }\n      if (options.autoopen) {\n          element.addEventListener(\"mouseenter\", inner_over);\n      }\n\n      function inner_over(e) {\n          var value = this.value;\n          if (!value || !value.has_submenu) {\n              return;\n          }\n          //if it is a submenu, autoopen like the item was clicked\n          inner_onclick.call(this, e);\n      }\n\n      //menu option clicked\n      function inner_onclick(e) {\n          var value = this.value;\n          var close_parent = true;\n\n          if (that.current_submenu) {\n              that.current_submenu.close(e);\n          }\n\n          //global callback\n          if (options.callback) {\n              var r = options.callback.call(\n                  this,\n                  value,\n                  options,\n                  e,\n                  that,\n                  options.node\n              );\n              if (r === true) {\n                  close_parent = false;\n              }\n          }\n\n          //special cases\n          if (value) {\n              if (\n                  value.callback &&\n                  !options.ignore_item_callbacks &&\n                  value.disabled !== true\n              ) {\n                  //item callback\n                  var r = value.callback.call(\n                      this,\n                      value,\n                      options,\n                      e,\n                      that,\n                      options.extra\n                  );\n                  if (r === true) {\n                      close_parent = false;\n                  }\n              }\n              if (value.submenu) {\n                  if (!value.submenu.options) {\n                      throw \"ContextMenu submenu needs options\";\n                  }\n                  var submenu = new that.constructor(value.submenu.options, {\n                      callback: value.submenu.callback,\n                      event: e,\n                      parentMenu: that,\n                      ignore_item_callbacks:\n                          value.submenu.ignore_item_callbacks,\n                      title: value.submenu.title,\n                      extra: value.submenu.extra,\n                      autoopen: options.autoopen\n                  });\n                  close_parent = false;\n              }\n          }\n\n          if (close_parent && !that.lock) {\n              that.close();\n          }\n      }\n\n      return element;\n  };\n\n  ContextMenu.prototype.close = function(e, ignore_parent_menu) {\n      if (this.root.parentNode) {\n          this.root.parentNode.removeChild(this.root);\n      }\n      if (this.parentMenu && !ignore_parent_menu) {\n          this.parentMenu.lock = false;\n          this.parentMenu.current_submenu = null;\n          if (e === undefined) {\n              this.parentMenu.close();\n          } else if (\n              e &&\n              !ContextMenu.isCursorOverElement(e, this.parentMenu.root)\n          ) {\n              ContextMenu.trigger(this.parentMenu.root, \"mouseleave\", e);\n          }\n      }\n      if (this.current_submenu) {\n          this.current_submenu.close(e, true);\n      }\n\n      if (this.root.closing_timer) {\n          clearTimeout(this.root.closing_timer);\n      }\n  };\n\n  //this code is used to trigger events easily (used in the context menu mouseleave\n  ContextMenu.trigger = function(element, event_name, params, origin) {\n      var evt = document.createEvent(\"CustomEvent\");\n      evt.initCustomEvent(event_name, true, true, params); //canBubble, cancelable, detail\n      evt.srcElement = origin;\n      if (element.dispatchEvent) {\n          element.dispatchEvent(evt);\n      } else if (element.__events) {\n          element.__events.dispatchEvent(evt);\n      }\n      //else nothing seems binded here so nothing to do\n      return evt;\n  };\n\n  //returns the top most menu\n  ContextMenu.prototype.getTopMenu = function() {\n      if (this.options.parentMenu) {\n          return this.options.parentMenu.getTopMenu();\n      }\n      return this;\n  };\n\n  ContextMenu.prototype.getFirstEvent = function() {\n      if (this.options.parentMenu) {\n          return this.options.parentMenu.getFirstEvent();\n      }\n      return this.options.event;\n  };\n\n  ContextMenu.isCursorOverElement = function(event, element) {\n      var left = event.clientX;\n      var top = event.clientY;\n      var rect = element.getBoundingClientRect();\n      if (!rect) {\n          return false;\n      }\n      if (\n          top > rect.top &&\n          top < rect.top + rect.height &&\n          left > rect.left &&\n          left < rect.left + rect.width\n      ) {\n          return true;\n      }\n      return false;\n  };\n\n  LiteGraph.ContextMenu = ContextMenu;\n\n  LiteGraph.closeAllContextMenus = function(ref_window) {\n      ref_window = ref_window || window;\n\n      var elements = ref_window.document.querySelectorAll(\".litecontextmenu\");\n      if (!elements.length) {\n          return;\n      }\n\n      var result = [];\n      for (var i = 0; i < elements.length; i++) {\n          result.push(elements[i]);\n      }\n\n      for (var i in result) {\n          if (result[i].close) {\n              result[i].close();\n          } else if (result[i].parentNode) {\n              result[i].parentNode.removeChild(result[i]);\n          }\n      }\n  };\n\n  LiteGraph.extendClass = function(target, origin) {\n      for (var i in origin) {\n          //copy class properties\n          if (target.hasOwnProperty(i)) {\n              continue;\n          }\n          target[i] = origin[i];\n      }\n\n      if (origin.prototype) {\n          //copy prototype properties\n          for (var i in origin.prototype) {\n              //only enumerable\n              if (!origin.prototype.hasOwnProperty(i)) {\n                  continue;\n              }\n\n              if (target.prototype.hasOwnProperty(i)) {\n                  //avoid overwriting existing ones\n                  continue;\n              }\n\n              //copy getters\n              if (origin.prototype.__lookupGetter__(i)) {\n                  target.prototype.__defineGetter__(\n                      i,\n                      origin.prototype.__lookupGetter__(i)\n                  );\n              } else {\n                  target.prototype[i] = origin.prototype[i];\n              }\n\n              //and setters\n              if (origin.prototype.__lookupSetter__(i)) {\n                  target.prototype.__defineSetter__(\n                      i,\n                      origin.prototype.__lookupSetter__(i)\n                  );\n              }\n          }\n      }\n  };\n\n//used by some widgets to render a curve editor\nfunction CurveEditor( points )\n{\n  this.points = points;\n  this.selected = -1;\n  this.nearest = -1;\n  this.size = null; //stores last size used\n  this.must_update = true;\n  this.margin = 5;\n}\n\nCurveEditor.sampleCurve = function(f,points)\n{\n  if(!points)\n    return;\n  for(var i = 0; i < points.length - 1; ++i)\n  {\n    var p = points[i];\n    var pn = points[i+1];\n    if(pn[0] < f)\n      continue;\n    var r = (pn[0] - p[0]);\n    if( Math.abs(r) < 0.00001 )\n      return p[1];\n    var local_f = (f - p[0]) / r;\n    return p[1] * (1.0 - local_f) + pn[1] * local_f;\n  }\n  return 0;\n}\n\nCurveEditor.prototype.draw = function( ctx, size, graphcanvas, background_color, line_color, inactive )\n{\n  var points = this.points;\n  if(!points)\n    return;\n  this.size = size;\n  var w = size[0] - this.margin * 2;\n  var h = size[1] - this.margin * 2;\n\n  line_color = line_color || \"#666\";\n\n  ctx.save();\n  ctx.translate(this.margin,this.margin);\n\n  if(background_color)\n  {\n    ctx.fillStyle = \"#111\";\n    ctx.fillRect(0,0,w,h);\n    ctx.fillStyle = \"#222\";\n    ctx.fillRect(w*0.5,0,1,h);\n    ctx.strokeStyle = \"#333\";\n    ctx.strokeRect(0,0,w,h);\n  }\n  ctx.strokeStyle = line_color;\n  if(inactive)\n    ctx.globalAlpha = 0.5;\n  ctx.beginPath();\n  for(var i = 0; i < points.length; ++i)\n  {\n    var p = points[i];\n    ctx.lineTo( p[0] * w, (1.0 - p[1]) * h );\n  }\n  ctx.stroke();\n  ctx.globalAlpha = 1;\n  if(!inactive)\n    for(var i = 0; i < points.length; ++i)\n    {\n      var p = points[i];\n      ctx.fillStyle = this.selected == i ? \"#FFF\" : (this.nearest == i ? \"#DDD\" : \"#AAA\");\n      ctx.beginPath();\n      ctx.arc( p[0] * w, (1.0 - p[1]) * h, 2, 0, Math.PI * 2 );\n      ctx.fill();\n    }\n  ctx.restore();\n}\n\n//localpos is mouse in curve editor space\nCurveEditor.prototype.onMouseDown = function( localpos, graphcanvas )\n{\n  var points = this.points;\n  if(!points)\n    return;\n  if( localpos[1] < 0 )\n    return;\n\n  //this.captureInput(true);\n  var w = this.size[0] - this.margin * 2;\n  var h = this.size[1] - this.margin * 2;\n  var x = localpos[0] - this.margin;\n  var y = localpos[1] - this.margin;\n  var pos = [x,y];\n  var max_dist = 30 / graphcanvas.ds.scale;\n  //search closer one\n  this.selected = this.getCloserPoint(pos, max_dist);\n  //create one\n  if(this.selected == -1)\n  {\n    var point = [x / w, 1 - y / h];\n    points.push(point);\n    points.sort(function(a,b){ return a[0] - b[0]; });\n    this.selected = points.indexOf(point);\n    this.must_update = true;\n  }\n  if(this.selected != -1)\n    return true;\n}\n\nCurveEditor.prototype.onMouseMove = function( localpos, graphcanvas )\n{\n  var points = this.points;\n  if(!points)\n    return;\n  var s = this.selected;\n  if(s < 0)\n    return;\n  var x = (localpos[0] - this.margin) / (this.size[0] - this.margin * 2 );\n  var y = (localpos[1] - this.margin) / (this.size[1] - this.margin * 2 );\n  var curvepos = [(localpos[0] - this.margin),(localpos[1] - this.margin)];\n  var max_dist = 30 / graphcanvas.ds.scale;\n  this._nearest = this.getCloserPoint(curvepos, max_dist);\n  var point = points[s];\n  if(point)\n  {\n    var is_edge_point = s == 0 || s == points.length - 1;\n    if( !is_edge_point && (localpos[0] < -10 || localpos[0] > this.size[0] + 10 || localpos[1] < -10 || localpos[1] > this.size[1] + 10) )\n    {\n      points.splice(s,1);\n      this.selected = -1;\n      return;\n    }\n    if( !is_edge_point ) //not edges\n      point[0] = Math.clamp(x,0,1);\n    else\n      point[0] = s == 0 ? 0 : 1;\n    point[1] = 1.0 - Math.clamp(y,0,1);\n    points.sort(function(a,b){ return a[0] - b[0]; });\n    this.selected = points.indexOf(point);\n    this.must_update = true;\n  }\n}\n\nCurveEditor.prototype.onMouseUp = function( localpos, graphcanvas )\n{\n  this.selected = -1;\n  return false;\n}\n\nCurveEditor.prototype.getCloserPoint = function(pos, max_dist)\n{\n  var points = this.points;\n  if(!points)\n    return -1;\n  max_dist = max_dist || 30;\n  var w = (this.size[0] - this.margin * 2);\n  var h = (this.size[1] - this.margin * 2);\n  var num = points.length;\n  var p2 = [0,0];\n  var min_dist = 1000000;\n  var closest = -1;\n  var last_valid = -1;\n  for(var i = 0; i < num; ++i)\n  {\n    var p = points[i];\n    p2[0] = p[0] * w;\n    p2[1] = (1.0 - p[1]) * h;\n    if(p2[0] < pos[0])\n      last_valid = i;\n    var dist = vec2.distance(pos,p2);\n    if(dist > min_dist || dist > max_dist)\n      continue;\n    closest = i;\n    min_dist = dist;\n  }\n  return closest;\n}\n\nLiteGraph.CurveEditor = CurveEditor;\n\n  //used to create nodes from wrapping functions\n  LiteGraph.getParameterNames = function(func) {\n      return (func + \"\")\n          .replace(/[/][/].*$/gm, \"\") // strip single-line comments\n          .replace(/\\s+/g, \"\") // strip white space\n          .replace(/[/][*][^/*]*[*][/]/g, \"\") // strip multi-line comments  /**/\n          .split(\"){\", 1)[0]\n          .replace(/^[^(]*[(]/, \"\") // extract the parameters\n          .replace(/=[^,]+/g, \"\") // strip any ES6 defaults\n          .split(\",\")\n          .filter(Boolean); // split & filter [\"\"]\n  };\n\n  Math.clamp = function(v, a, b) {\n      return a > v ? a : b < v ? b : v;\n  };\n\n  if (typeof window != \"undefined\" && !window[\"requestAnimationFrame\"]) {\n      window.requestAnimationFrame =\n          window.webkitRequestAnimationFrame ||\n          window.mozRequestAnimationFrame ||\n          function(callback) {\n              window.setTimeout(callback, 1000 / 60);\n          };\n  }\n})(this);\n\nif (typeof exports != \"undefined\") {\n  exports.LiteGraph = this.LiteGraph;\n}\n","import GoldenLayout from 'golden-layout';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n// import Markdown from 'react-markdown';\nimport './css/main.css';\nimport 'litegraph.js/css/litegraph.css'\nimport AceEditor from 'react-ace';\nimport 'brace/mode/glsl';\nimport 'brace/theme/tomorrow_night_eighties';\nimport 'brace/ext/language_tools';\n// import { JSONEditor } from 'react-json-editor-viewer';\nimport * as dat from 'dat.gui';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n// import { vec2, vec3, vec4, mat2, mat3, mat4, quat } from 'gl-matrix';\nimport { Modal, Button, FormControl, Dropdown, DropdownButton } from 'react-bootstrap';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { BufferGeometryUtils } from 'three/examples/jsm/utils/BufferGeometryUtils';\n// import { RoughnessMipmapper } from 'three/examples/jsm/utils/RoughnessMipmapper.js';\n\nvar LG = require('./3rdparty/litegraph');\nlet LGraph = LG.LGraph;\nlet LGraphCanvas = LG.LGraphCanvas;\nlet LiteGraph = LG.LiteGraph;\nlet LGraphNode = LG.LGraphNode;\n\nlet isSetsEqual = (a, b) => a.size === b.size && [...a].every(value => b.has(value));\nfunction assert(condition) {\n  if (!condition) {\n    var message = \"Assertion failed\";\n    if (typeof Error !== \"undefined\") {\n      throw new Error(message);\n    }\n    throw message; // Fallback\n  }\n}\n\n// Actually, lets make a global state object\nlet global_state = {};\n// Reference to the litegraph instance\nglobal_state.litegraph = new LGraph();\nfunction init_litegraph(json) {\n  global_state.litegraph.clear();\n  global_state.litegraph.configure(json, false);\n  for (let i in global_state._on_reset_table) {\n    global_state._on_reset_table[i]();\n  }\n}\n\nglobal_state.on_select = null;\nglobal_state.on_deselect = null;\nglobal_state.litegraph_canvas = null;\nglobal_state._after_table = {};\nglobal_state._onselect_table = [];\nglobal_state.exec_after = (cmd_type, fn) => {\n  if (!(cmd_type in global_state._after_table))\n    global_state._after_table[cmd_type] = [];\n  global_state._after_table[cmd_type].push(fn);\n};\nglobal_state.exec_on_select = (onselect, ondeselect) => {\n  global_state._onselect_table.push({ onselect: onselect, ondeselect: ondeselect });\n};\nglobal_state.exec_selected = (nodes) => {\n  for (let j in global_state._onselect_table) {\n    let callback = global_state._onselect_table[j];\n    for (let i in nodes) {\n      callback.onselect(nodes[i]);\n    }\n  }\n};\nglobal_state.exec_deselected = (nodes) => {\n  for (let j in global_state._onselect_table) {\n    let callback = global_state._onselect_table[j];\n    for (let i in nodes) {\n      callback.ondeselect(nodes[i]);\n    }\n  }\n};\nglobal_state.exec = (cmd) => {\n  switch (cmd.type) {\n    case 'add_src': {\n      let src_name = cmd.src_name;\n      assert(!(src_name in global_state.litegraph.config.srcs));\n      global_state.litegraph.config.srcs[src_name] = { code: \"\" };\n    }\n      break;\n    case 'remove_src': {\n      let src_name = cmd.src_name;\n      assert(src_name in global_state.litegraph.config.srcs);\n      delete global_state.litegraph.config.srcs[src_name];\n    }\n      break;\n    default:\n      throw Error(\"unrecognized command\");\n      break;\n  }\n\n  if (cmd.type in global_state._after_table) {\n    for (let i in global_state._after_table[cmd.type]) {\n      // console.log(global_state._after_table[cmd.type][i]);\n      global_state._after_table[cmd.type][i](cmd);\n    }\n  }\n};\nglobal_state.viewport = { width: 512, height: 512 };\nglobal_state._on_reset_table = [];\nglobal_state.on_reset = (fn) => {\n  global_state._on_reset_table.push(fn);\n};\nglobal_state.exec_reset = () => {\n  global_state.litegraph.clear();\n  global_state.litegraph.config.srcs = {};\n  for (let i in global_state._on_reset_table) {\n    global_state._on_reset_table[i]();\n  }\n};\nglobal_state.reload = () => {\n  let json = global_state.litegraph.serialize();\n  global_state.exec_reset();\n  global_state.litegraph.configure(json, false);\n  for (let i in global_state._on_reset_table) {\n    global_state._on_reset_table[i]();\n  }\n};\nglobal_state.get_src = (name) => {\n  assert(name in global_state.litegraph.config.srcs);\n  return global_state.litegraph.config.srcs[name].code;\n};\nglobal_state._scr_change_table = [];\n// Just notify everyone about any change to any source\nglobal_state.on_src_change = (fn) => {\n  // if (!(name in global_state._scr_change_table))\n  //   global_state._scr_change_table[name] = [];\n  // global_state._scr_change_table[name].push(fn);\n  global_state._scr_change_table.push(fn);\n};\nglobal_state.set_src = (name, text) => {\n  global_state.litegraph.config.srcs[name].code = text;\n  global_state._scr_change_table.forEach(fn => fn(name));\n};\nglobal_state.draw_triangle = (gl) => {\n  var pipeline = {\n    vs:\n      `#version 300 es\n      \n      layout (location=0) in vec4 position;\n      layout (location=1) in vec3 color;\n      \n      out vec3 vColor;\n\n      void main() {\n\n          vColor = color;\n          gl_Position = position;\n      }\n      `,\n    ps:\n      `#version 300 es\n      precision highp float;\n      in vec3 vColor;\n      out vec4 fragColor;\n\n      void main() {\n          fragColor = vec4(vColor, 1.0);\n      }`,\n\n  };\n  var vsSource = pipeline.vs;\n  var fsSource = pipeline.ps;\n\n  var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vertexShader, vsSource);\n  gl.compileShader(vertexShader);\n\n  if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(vertexShader));\n  }\n\n  var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fragmentShader, fsSource);\n  gl.compileShader(fragmentShader);\n\n  if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(fragmentShader));\n  }\n\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    console.error(gl.getProgramInfoLog(program));\n  }\n\n  gl.useProgram(program);\n\n  var triangleArray = gl.createVertexArray();\n  gl.bindVertexArray(triangleArray);\n\n  var positions = new Float32Array([\n    -0.5, -0.5, 0.0,\n    0.5, -0.5, 0.0,\n    0.0, 0.5, 0.0\n  ]);\n\n  var positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n  gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(0);\n\n  var colors = new Float32Array([\n    1.0, 0.0, 0.0,\n    0.0, 1.0, 0.0,\n    1.0, 0.0, 0.0\n  ]);\n\n  var colorBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, colors, gl.STATIC_DRAW);\n  gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(1);\n\n  gl.disable(gl.CULL_FACE);\n  gl.frontFace(gl.CW);\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.SCISSOR_TEST);\n  gl.depthFunc(gl.LEQUAL);\n  gl.disable(gl.BLEND);\n  gl.blendFunc(gl.ONE, gl.ONE);\n  gl.drawArrays(gl.TRIANGLES, 0, 3);\n\n  gl.deleteBuffer(positionBuffer);\n  gl.deleteBuffer(colorBuffer);\n  gl.deleteShader(vertexShader);\n  gl.deleteShader(fragmentShader);\n  gl.deleteProgram(program);\n};\nglobal_state.render_texture = (tex, format, flipy) => {\n  let gl = global_state.gl;\n  flipy = flipy || false;\n  var pipeline = {\n    vs:\n      `#version 300 es\n      precision highp float;\n      in vec2 position;\n      out vec2 uv;\n      void main() {\n        uv = 0.5 * (position + 1.0);\n        uv.y = 1.0 - uv.y;\n        gl_Position = vec4(position, 0, 1);\n      }\n      `,\n    ps:\n      `#version 300 es\n      precision highp float;\n      precision highp int;\n      precision highp usampler2D;\n      precision highp isampler2D;\n      in vec2 uv;\n      uniform sampler2D in_tex;\n      out vec4 fragColor;\n      void main() {\n        fragColor = vec4(vec3(texture(in_tex, uv).xyz), 1.0);\n      }`,\n\n  };\n  if (flipy) {\n    pipeline.vs = pipeline.vs.replace(\"uv.y = 1.0 - uv.y;\", \"uv.y = uv.y;\");\n  }\n  if (format) {\n    switch (format) {\n      case \"RGBA32UI\": {\n        pipeline.ps = pipeline.ps.replace(\"uniform sampler2D\", \"uniform usampler2D\");\n      }\n        break;\n      case \"RGBA32F\": {\n      }\n        break;\n      default:\n        throw Error(\"unknown format\");\n    }\n  }\n  var vsSource = pipeline.vs;\n  var fsSource = pipeline.ps;\n\n  var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vertexShader, vsSource);\n  gl.compileShader(vertexShader);\n\n  if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(vertexShader));\n  }\n\n  var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fragmentShader, fsSource);\n  gl.compileShader(fragmentShader);\n\n  if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n    console.error(gl.getShaderInfoLog(fragmentShader));\n  }\n\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n  gl.linkProgram(program);\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    console.error(gl.getProgramInfoLog(program));\n  }\n\n  gl.useProgram(program);\n\n  var triangleArray = gl.createVertexArray();\n  gl.bindVertexArray(triangleArray);\n\n  var positionBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-4, -4, 4, -4, 0, 4]), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(0);\n  gl.activeTexture(gl.TEXTURE0 + 0);\n  gl.bindTexture(gl.TEXTURE_2D, tex);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.uniform1i(gl.getUniformLocation(program, \"in_tex\"), 0);\n  gl.drawArrays(gl.TRIANGLES, 0, 3);\n\n  gl.deleteBuffer(positionBuffer);\n  gl.deleteShader(vertexShader);\n  gl.deleteShader(fragmentShader);\n  gl.deleteProgram(program);\n  gl.deleteVertexArray(triangleArray);\n};\nglobal_state.get_texture_data = (tex, format, width, height) => {\n  let gl = global_state.gl;\n  // create to render to\n  const targetTextureWidth = Math.floor(width) || 256;\n  const targetTextureHeight = Math.floor(height) || 256;\n  const targetTexture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, targetTexture);\n\n  {\n    // define size and format of level 0\n    const level = 0;\n    const internalFormat = gl.RGBA;\n    const border = 0;\n    const format = gl.RGBA;\n    const type = gl.UNSIGNED_BYTE;\n    const data = null;\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n      targetTextureWidth, targetTextureHeight, border,\n      format, type, data);\n\n    // set the filtering so we don't need mips\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  }\n  // Create and bind the framebuffer\n  const fb = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, targetTexture, 0);\n\n\n\n  gl.disable(gl.CULL_FACE);\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.DEPTH_TEST);\n  gl.disable(gl.SCISSOR_TEST);\n  gl.depthFunc(gl.LEQUAL);\n  gl.blendFunc(gl.ONE, gl.ONE);\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n  gl.drawBuffers([gl.COLOR_ATTACHMENT0]);\n  gl.viewport(0, 0, targetTextureWidth, targetTextureHeight);\n  gl.clearColor(0, 0, 1, 1);\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n  global_state.render_texture(tex, format);\n\n  var data = new Uint8Array(targetTextureWidth * targetTextureHeight * 4);\n  gl.readPixels(0, 0, targetTextureWidth, targetTextureHeight, gl.RGBA, gl.UNSIGNED_BYTE, data);\n\n\n  gl.deleteFramebuffer(fb);\n  gl.deleteTexture(targetTexture);\n  // console.log(targetTextureWidth);\n  // console.log(targetTextureHeight);\n  // console.log(targetTextureWidth * targetTextureHeight * 4);\n  let array = new Uint8ClampedArray(data);\n  let image = new ImageData(array, targetTextureWidth, targetTextureHeight);\n  return image;\n};\nglobal_state._dirty_set = new Set();\nglobal_state._dirty_deferred_set = new Set();\nglobal_state.set_dirty = (node) => {\n  // console.log(node + \" is dirty!\");\n  if (node.is_recursive && node.is_recursive())\n    global_state._dirty_deferred_set.add(node);\n  else\n    global_state._dirty_set.add(node);\n};\nglobal_state.update = () => {\n  let set_to_check = new Set(global_state._dirty_set);\n  while (true) {\n    let new_set = new Set();\n    set_to_check.forEach(node => {\n      if (node.outputs)\n        node.outputs.forEach(output => {\n          if (!output.links)\n            return;\n          output.links.forEach(link_id => {\n            let link = global_state.litegraph.links[link_id];\n            // console.log(\"visiting link: \" + link);\n            let target = global_state.litegraph.getNodeById(link.target_id);\n            if (target && !global_state._dirty_set.has(target)) {\n              global_state._dirty_set.add(target);\n              new_set.add(target);\n            }\n          });\n\n\n        });\n    });\n    if (new_set.size == 0)\n      break;\n    set_to_check = new_set;\n  }\n  // console.log(global_state._dirty_set);\n  let sorted_list = [];\n  let backlog = new Set();\n  var loop_counter = 0;\n  while (true) {\n    let to_remove = new Set();\n    global_state._dirty_set.forEach(node => {\n      let has_dirty_input = false;\n      if (node.inputs)\n        node.inputs.forEach(input => {\n          if (input.link) {\n            var input_node = global_state.litegraph.getNodeById(input.link.input_id);\n            if (global_state._dirty_set.has(input_node))\n              has_dirty_input = true;\n          }\n        });\n      if (!has_dirty_input) {\n        backlog.add(node);\n        sorted_list.push(node);\n      }\n    });\n    backlog.forEach(node => global_state._dirty_set.delete(node));\n    backlog.clear();\n    if (global_state._dirty_set.size == 0)\n      break;\n    loop_counter += 1;\n    if (loop_counter > 1000)\n      throw Error(\"[Error] Recursion detected. Exiting loop\");\n  }\n  sorted_list.forEach(node => { if (node.update) node.update(); node.notify(); });\n  global_state._dirty_deferred_set.forEach(node => { if (node.update) node.update(); });\n  global_state._dirty_deferred_set.clear();\n};\nglobal_state.periodic_update = setInterval(global_state.update, 200);\nglobal_state.toposort = () => {\n  let sorted = [];\n  let sorted_set = new Set();\n  let unsorted_set = new Set();\n  let unsorted = [];\n  global_state.litegraph._nodes.forEach(node => {\n    if (!node.is_recursive || !node.is_recursive()) {\n      unsorted_set.add(node);\n      unsorted.push(node);\n    }\n  });\n\n\n  while (unsorted.length) {\n    let node = unsorted.shift();\n    var is_ready = true;\n    for (let i in node.inputs) {\n      let link_id = node.inputs[i].link;\n      if (link_id) {\n        var link_info = global_state.litegraph.links[link_id];\n        if (link_info) {\n          let target_node = global_state.litegraph.getNodeById(link_info.origin_id);\n          if (unsorted_set.has(target_node)) {\n            is_ready = false;\n            break;\n          }\n        }\n      }\n    }\n    if (is_ready) {\n      sorted.push(node);\n      sorted_set.add(node);\n      unsorted_set.delete(node);\n    } else {\n      unsorted.push(node);\n    }\n  }\n  global_state.litegraph._nodes.forEach(node => {\n    if (node.is_recursive && node.is_recursive()) {\n      // console.log(node);\n      sorted.push(node);\n    }\n  });\n  return sorted;\n};\nglobal_state.frame_count = 0;\nglobal_state.draw = () => {\n  let sorted_nodes = global_state.toposort();\n  // console.log(sorted_nodes);\n  sorted_nodes.forEach(node => { if (node.gl_init) node.gl_init(global_state.gl) });\n  sorted_nodes.forEach(node => { if (node.gl_render) node.gl_render(global_state.gl) });\n  Array.from(sorted_nodes).reverse().forEach(node => { if (node.gl_release) node.gl_release(global_state.gl) });\n  global_state.litegraph_canvas.setDirty(true);\n  global_state.frame_count += 1;\n  // global_state.periodic_draw = setTimeout(global_state.draw, 100);\n};\nglobal_state.update_thumbnails = () => {\n  global_state.litegraph_canvas.setDirty(true);\n};\n// TODO:\n// * drawcall node\n//   * input attribute stream\n//      * per vertex/instance\n//   * input uniform hvalues(matrices, vector, float, ints, textures+texture sizes)\n// * value nodes\n//   * camera node(generates look,up,left vectors and view/projection/inverse matrices)\n// * update propagation?\n\nlet graph_list = ['default_graph.json', 'ltc.json', 'feedback_test.json'];\n\nclass LoadGraphButton extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = { visible: false };\n    this.myInput = { value: \"\" };\n  }\n  setShow = (vis) => {\n    this.setState({ visible: vis });\n  }\n  handleClose = () => this.setShow(false);\n  handleShow = () => this.setShow(true);\n  handleApply = () => {\n    // console.log(this.myInput.value);\n    this.props.on_submit(this.myInput.value);\n    this.setShow(false);\n  }\n  render() {\n    return (\n      <>\n        <Button variant=\"primary\" onClick={this.handleShow}>\n          Load Graph\n      </Button>\n\n        <Modal show={this.state.visible} onHide={this.handleClose}>\n          <Modal.Header closeButton>\n            <Modal.Title>Choose source</Modal.Title>\n          </Modal.Header>\n          <Modal.Footer>\n            <Button variant=\"secondary\" onClick={this.handleClose}>\n              Cancel\n          </Button>\n            <DropdownButton id=\"dropdown-item-button\" title=\"Dropdown button\">\n              {graph_list.map(\n                variant => (\n                  <Dropdown.Item key={variant} onClick={() => {\n                    fetch(variant)\n                      .then(response => response.text())\n                      .then(text => {\n                        init_litegraph(JSON.parse(text));\n                      });\n\n                  }}>{variant}</Dropdown.Item>\n                ),\n              )}\n\n            </DropdownButton>\n          </Modal.Footer>\n        </Modal>\n      </>\n    );\n  }\n}\n\nvar gltf_loader = new GLTFLoader();\n\nclass MyLGraphNode extends LGraphNode {\n  constructor() {\n    super();\n    this.subscribers = new Set();\n  }\n  is_recursive = () => false;\n  subscribe = (node) => { this.subscribers.add(node) }\n  unsubscribe = (node) => { this.subscribers.delete(node) }\n  notify = () => { this.subscribers.forEach(node => { if (node.set_dirty) node.set_dirty() }) }\n  set_dirty = () => { global_state.set_dirty(this); }\n  onConfigure = () => { if (this.update) this.set_dirty(); }\n  clean_inputs = () => {\n    let len = this.inputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeInput(i);\n    }\n  }\n  clean_outputs = () => {\n    let len = this.outputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeOutput(i);\n    }\n  }\n  onRemoved = () => {\n    global_state._dirty_set.delete(this);\n  }\n  set_inputs = (new_outputs) => {\n    let last_attributes = new Set();\n    this.inputs.forEach(input => last_attributes.add(input.type + \" \" + input.name));\n    if (!isSetsEqual(last_attributes, new_outputs)) {\n      last_attributes.forEach(attr => { if (!new_outputs.has(attr)) { this.removeInputByName(attr.split(\" \")[1]) } });\n      new_outputs.forEach(attr => {\n        if (!last_attributes.has(attr)) {\n          this.addInput(attr.split(\" \")[1], attr.split(\" \")[0])\n        }\n      });\n    }\n  }\n  set_outputs = (new_outputs) => {\n    let last_attributes = new Set();\n    this.outputs.forEach(input => last_attributes.add(input.type + \" \" + input.name));\n    if (!isSetsEqual(last_attributes, new_outputs)) {\n      last_attributes.forEach(attr => { if (!new_outputs.has(attr)) { this.removeOutputByName(attr.split(\" \")[1]) } });\n      new_outputs.forEach(attr => {\n        if (!last_attributes.has(attr)) {\n          this.addOutput(attr.split(\" \")[1], attr.split(\" \")[0])\n        }\n      });\n    }\n  }\n}\n\nclass FrameCountNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Frame count\";\n\n    this.addWidget(\"button\", \"reset\", null, (v) => { global_state.frame_count = 0; }, {});\n    this.addOutput(\"0\", \"uniform_t\");\n  }\n  get_value = (slot) => {\n    return global_state.frame_count;\n  }\n  onDrawBackground = (ctx) => {\n    if (global_state.frame_count == 0)\n      this.outputs[0].label = \"0\";\n    else\n      this.outputs[0].label = global_state.frame_count;\n  }\n}\n\nclass Mesh {\n  init = (attributes, indices) => {\n    this.attributes = attributes;\n    this.indices = indices;\n  }\n\n  init_gltf = (mesh) => {\n    assert(mesh.type == \"Mesh\");\n    BufferGeometryUtils.computeTangents(mesh.geometry);\n    this.attributes = {};\n    Object.keys(mesh.geometry.attributes).forEach(attr_name => {\n      let raw_attr = mesh.geometry.attributes[attr_name];\n      let attr = {};\n      attr.data = raw_attr.array;\n      assert(raw_attr.normalized == false);\n      switch (raw_attr.itemSize) {\n        case 1: attr.type = \"float\"; break;\n        case 2: attr.type = \"vec2\"; break;\n        case 3: attr.type = \"vec3\"; break;\n        case 4: attr.type = \"vec4\"; break;\n        default: throw Error();\n      }\n      this.attributes[attr_name] = attr;\n    });\n    this.indices = {};\n    this.indices.data = mesh.geometry.index.array;\n    this.indices.type = \"uint16\";\n    this.pbr_material = mesh.material;\n    this.images = [];\n    Object.keys(this.pbr_material).forEach(field => {\n      if (\n        this.pbr_material[field] &&\n        typeof (this.pbr_material[field]) == \"object\" &&\n        \"image\" in this.pbr_material[field]) {\n        this.images.push({ name: field, img: this.pbr_material[field].image });\n      }\n    });\n\n    // console.log(mesh.geometry);\n  }\n\n  get_attrib_data = (name) => {\n    return this.attributes[name];\n  }\n\n  get_index_data = () => {\n    return this.indices;\n  }\n}\n\nclass ModelNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Model\";\n    this.properties = {\n      fileurl: null,\n    };\n    this.onPropertyChange = (prop, val) => {\n      if (prop == \"fileurl\") {\n\n      }\n    };\n    this.addOutput(\"mesh\", \"mesh_t\");\n    this.meshes = [];\n    // let url = 'models/gltf/dieselpunk_hovercraft/scene.gltf';\n    let url = 'models/LeePerrySmith/LeePerrySmith.gltf';\n    gltf_loader.load(url, (gltf) => {\n      console.log(gltf);\n      this.gltf = gltf;\n      this.traverse(gltf.scene);\n    });\n    this.yoffset = 0;\n  }\n\n  traverse = (node) => {\n    if (node.type == \"Mesh\") {\n      let mesh = new Mesh();\n      mesh.init_gltf(node);\n      this.meshes.push(mesh);\n    } else {\n      node.children.forEach(child => this.traverse(child));\n    }\n  }\n\n  get_meshes = () => {\n    return this.meshes;\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n  }\n\n  display = (propnode) => {\n    var canvas1 = document.createElement(\"canvas\");\n    var canvas2 = document.createElement(\"canvas\");\n    var div = document.createElement(\"div\");\n    div.appendChild(canvas1);\n    div.style.cssText = \"margin-top: 16px;\";\n    {\n      var context = canvas1.getContext('webgl2', { alpha: false });\n      var renderer = new THREE.WebGLRenderer({ canvas: canvas1, context: context });\n      var controls;\n      var camera, scene;\n      camera = new THREE.PerspectiveCamera(45, 1.0, 0.25, 20);\n      camera.position.set(- 1.8, 0.6, 2.7);\n\n      scene = new THREE.Scene();\n      var render = function () {\n        let parent = propnode.datgui.domElement.parentNode;\n        if (parent) {\n          canvas1.classList.add('margin_16');\n          renderer.setSize(parent.offsetWidth - 32, parent.offsetWidth - 32);\n        }\n        else\n          renderer.setSize(512, 512);\n        renderer.render(scene, camera);\n      };\n      var pmremGenerator = new THREE.PMREMGenerator(renderer);\n      pmremGenerator.compileEquirectangularShader();\n      new RGBELoader()\n        .setDataType(THREE.UnsignedByteType)\n        .setPath('textures/equirectangular/')\n        .load('venice_sunset_1k.hdr', (texture) => {\n\n          var envMap = pmremGenerator.fromEquirectangular(texture).texture;\n\n          scene.background = envMap;\n          scene.environment = envMap;\n\n          texture.dispose();\n          pmremGenerator.dispose();\n          scene.add(this.gltf.scene);\n\n          render();\n\n        });\n\n      renderer.setPixelRatio(1.0);\n\n      renderer.outputEncoding = THREE.sRGBEncoding;\n\n      let offset = 1.25;\n      const boundingBox = new THREE.Box3();\n      boundingBox.setFromObject(this.gltf.scene);\n      const size = boundingBox.getSize();\n      const maxDim = Math.max(size.x, size.y, size.z);\n      const fov = camera.fov * (Math.PI / 180);\n      let cameraZ = Math.abs(maxDim / 4 * Math.tan(fov * 2));\n      cameraZ *= offset;\n      // camera.position.z = cameraZ;\n      const minZ = boundingBox.min.z;\n      const cameraToFarEdge = (minZ < 0) ? -minZ + cameraZ : cameraZ - minZ;\n\n      controls = new OrbitControls(camera, renderer.domElement);\n      controls.addEventListener('change', render);\n      controls.minDistance = maxDim;\n      controls.maxDistance = 1000;\n      controls.target.set(0, 0, 0);\n      controls.update();\n\n      camera.aspect = 1.0;\n      camera.far = 1000;\n      camera.far = cameraToFarEdge * 3;\n\n      camera.updateProjectionMatrix();\n\n\n      renderer.render(scene, camera);\n    }\n    div.appendChild(canvas2);\n\n    // let folder = propnode.datgui.addFolder(\"Attributes\");\n    // for (let i in this.attributes) {\n    //   let tmp = {\n    //     prop: () => { },\n    //   };\n    //   folder.add(tmp, \"prop\").name(i);\n    // }\n    // folder.open();\n    propnode.datgui.domElement.appendChild(div);\n    div.width = 512;\n    // {\n    //   let ctx = canvas2.getContext(\"2d\");\n    //   var yoffset = 0;\n    //   var xoffset = 64;\n    //   var border = 16;\n    //   var size = 256;\n    //   canvas2.width = xoffset + size;\n    //   var height = 0;\n    //   var images = [];\n    //   Object.keys(this.pbr_material).forEach(field => {\n    //     if (\n    //       this.pbr_material[field] &&\n    //       typeof (this.pbr_material[field]) == \"object\" &&\n    //       \"image\" in this.pbr_material[field]) {\n    //       images.push({ name: field, img: this.pbr_material[field].image });\n    //       height += size + border;\n    //     }\n    //   });\n    //   canvas2.height = height;\n    //   div.height = height + 256;\n\n    //   images.forEach(img => {\n    //     ctx.fillStyle = \"white\";\n    //     ctx.fillText(img.name, 0, yoffset + 16);\n    //     ctx.drawImage(\n    //       img.img\n    //       , xoffset, yoffset, size, size);\n    //     yoffset += size + border;\n    //   });\n    // }\n  }\n}\n\nclass GLComponent extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.graph = new LGraph();\n    this.canvas = null;\n  }\n\n  componentDidMount() {\n    this.canvas = document.getElementById(\"myglcanvas\");\n    this.gl = this.canvas.getContext('webgl2', { alpha: false });\n\n    // return;\n    let gl = this.gl;\n    const ext = gl.getExtension('EXT_color_buffer_float');\n    if (!ext) {\n      return alert('need EXT_color_buffer_float');\n    }\n    // console.log(ext);\n    global_state.glcanvas = this.canvas;\n    global_state.gl = gl;\n    global_state.draw_triangle(gl);\n  }\n\n  exec_graph = () => {\n\n  }\n\n  onResize = () => {\n    this.canvas.width = this.canvas.parentNode.offsetWidth;\n    this.canvas.height = this.canvas.parentNode.offsetHeight;\n    // this.canvas.resize();\n  }\n\n  render() {\n\n    return (\n      <canvas id='myglcanvas' style={{ width: '100%', height: '100%' }}></canvas>\n\n    );\n  }\n}\n\nclass BackBufferNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.addInput(\"in\", \"uniform_t\");\n    this.properties = {};\n    this.title = \"Back Buffer\";\n    let list = global_state.litegraph.findNodesByType(\"gfx/BackBufferNode\");\n    // Remove all backbuffer nodes\n    // This enforces only one backbuffer node per graph\n    if (list.length > 0) {\n      for (let i = 0; i < list.length; i++) {\n        global_state.litegraph.remove(list[i]);\n      }\n    }\n    this.thumbnail = null;\n    this.viewport = { width: 128, height: 128 };\n    // this.button = this.addWidget(\"button\", \"draw\", null, (v) => { this.draw(); }, {});\n  }\n  gl_render = (gl) => {\n    let in_node = this.getInputNodeByName(\"in\");\n    if (!in_node)\n      return;\n    let input_link = this.getInputLinkByName(\"in\");\n    let tex = in_node.get_texture(input_link.origin_slot);\n    this.update_thumbnails();\n    let canvas = global_state.glcanvas;\n    var displayWidth = canvas.clientWidth;\n    var displayHeight = canvas.clientHeight;\n\n    if (displayWidth && displayHeight) {\n      if (canvas.width != displayWidth ||\n        canvas.height != displayHeight) {\n        canvas.width = displayWidth;\n        canvas.height = displayHeight;\n      }\n    }\n    gl.disable(gl.CULL_FACE);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.blendFunc(gl.ONE, gl.ONE);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.drawBuffers([gl.BACK]);\n    gl.viewport(0, 0, canvas.width, canvas.height);\n    gl.clearColor(0, 0, 1, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    global_state.render_texture(tex, \"RGBA32F\", true);\n  }\n\n  update_thumbnails = () => {\n    let in_node = this.getInputNodeByName(\"in\");\n    if (!in_node)\n      return;\n    let input_link = this.getInputLinkByName(\"in\");\n    let tex = in_node.get_texture(input_link.origin_slot);\n    this.thumbnail = null;\n    let image_data = global_state.get_texture_data(tex, \"RGBA32F\",\n      this.viewport.width, this.viewport.height);\n    let tmp_canvas = document.createElement(\"canvas\");\n    let tmp_canvasContext = tmp_canvas.getContext(\"2d\");\n    tmp_canvas.width = image_data.width;\n    tmp_canvas.height = image_data.height;\n    tmp_canvasContext.putImageData(image_data, 0, 0);\n    var img = document.createElement(\"img\");\n    img.src = tmp_canvas.toDataURL(\"image/png\");\n    this.thumbnail = img;\n    global_state.update_thumbnails();\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n    var yoffset = 16;\n    var xoffset = 16;\n    var border = 16;\n    var size = this.size[0] - border * 2;\n    this.viewport.width = size;\n    this.viewport.height = size;\n\n    if (this.thumbnail) {\n      ctx.drawImage(this.thumbnail, xoffset, yoffset, size, size);\n    } else {\n      ctx.fillRect(xoffset, yoffset, size, size);\n    }\n    this.size[1] = size + border * 2;\n\n  }\n}\n\nclass PipelineNode extends MyLGraphNode {\n  constructor() {\n    super();\n\n    this.properties = {\n      vs: null,\n      ps: null,\n      attributes: null,\n      uniforms: null\n    };\n    this.addOutput(\"out\", \"pipeline_t\");\n    this.title = \"Pipeline\";\n    this.valid = false;\n    global_state.exec_after('remove_src', (cmd) => {\n      if (cmd.src_name == this.vs) {\n        this.set_vs(null);\n      }\n      if (cmd.src_name == this.ps) {\n        this.set_ps(null);\n      }\n    });\n    global_state.on_src_change((src_name) => {\n      // console.log(\"pipeline has received an update on \" + src_name);\n      if (src_name == this.properties.vs) {\n        this.set_dirty();\n      }\n      if (src_name == this.properties.ps) {\n        this.set_dirty();\n      }\n    });\n  }\n\n  set_vs = (vs) => {\n    this.properties.vs = vs;\n  }\n\n  set_ps = (ps) => {\n    this.properties.ps = ps;\n  }\n\n  clean_inputs = () => {\n    let len = this.inputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeInput(i);\n    }\n  }\n\n  is_valid = () => {\n    return this.valid;\n  }\n\n  get_uniform_location = (gl, name) => {\n    return gl.getUniformLocation(this.gl.program, name);\n  }\n\n  gl_init = (gl) => {\n    if (!this.is_valid)\n      return false;\n    assert(!(\"gl\" in this));\n    this.gl = { vs: null, ps: null, program: null };\n    let vs_source = global_state.get_src(this.properties.vs);\n    this.gl.vs = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(this.gl.vs, vs_source);\n    gl.compileShader(this.gl.vs);\n\n    if (!gl.getShaderParameter(this.gl.vs, gl.COMPILE_STATUS)) {\n      console.error(gl.getShaderInfoLog(this.gl.vs));\n      this.gl_release(gl);\n      return false;\n    }\n\n    let ps_source = global_state.get_src(this.properties.ps);\n    this.gl.ps = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(this.gl.ps, ps_source);\n    gl.compileShader(this.gl.ps);\n\n    if (!gl.getShaderParameter(this.gl.ps, gl.COMPILE_STATUS)) {\n      console.error(gl.getShaderInfoLog(this.gl.ps));\n      this.gl_release(gl);\n      return false;\n    }\n\n    this.gl.program = gl.createProgram();\n    gl.attachShader(this.gl.program, this.gl.ps);\n    gl.attachShader(this.gl.program, this.gl.vs);\n    gl.linkProgram(this.gl.program);\n\n    if (!gl.getProgramParameter(this.gl.program, gl.LINK_STATUS)) {\n      console.error(gl.getProgramInfoLog(this.gl.program));\n      this.gl_release(gl);\n      return false;\n    }\n  }\n\n  bind = (gl) => {\n    gl.useProgram(this.gl.program);\n    gl.disable(gl.CULL_FACE);\n    gl.frontFace(gl.CW);\n    gl.depthMask(true);\n    gl.enable(gl.DEPTH_TEST);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.disable(gl.BLEND);\n    gl.blendFunc(gl.ONE, gl.ONE);\n    return true;\n  }\n\n  get_attrib_location = (gl, name) => {\n    if (!this.gl || !this.gl.program)\n      return null;\n    return gl.getAttribLocation(this.gl.program, name);\n  }\n\n  gl_release = (gl) => {\n    if (!(\"gl\" in this))\n      return;\n    if (this.gl.vs != null) gl.deleteShader(this.gl.vs);\n    if (this.gl.ps != null) gl.deleteShader(this.gl.ps);\n    if (this.gl.program != null) gl.deleteProgram(this.gl.program);\n    delete this.gl;\n  }\n\n  display = (propnode) => {\n\n    let src_list = [];\n    // console.log(pipeline);\n    let datgui_state = {\n      select_vs: this.properties.vs,\n      select_ps: this.properties.ps,\n    };\n    Object.keys(global_state.litegraph.config.srcs).forEach(e => src_list.push(e));\n    propnode.datgui.add(datgui_state, 'select_vs', src_list)\n      .onChange((v) => this.set_vs(v));\n    propnode.datgui.add(datgui_state, 'select_ps', src_list)\n      .onChange((v) => this.set_ps(v));\n  }\n\n  update = () => {\n    this.parse_shaders();\n  }\n\n  get_info = () => {\n    if (!this.valid)\n      this.parse_shaders();\n    return { attributes: this.properties.attributes, uniforms: this.properties.uniforms, valid: this.valid };\n  }\n\n  parse_shaders = () => {\n    // this.clean_inputs();\n    this.valid = false;\n    let uniform_set = new Set();\n\n    this.properties.attributes = [];\n    this.properties.uniforms = [];\n    if (this.properties.vs != null) {\n      try {\n        // Parse vertex shader for attributes\n        if (typeof window.glslang == \"undefined\")\n          throw Error(\"glslang is not ready\");\n        let str = window.glslang.parse_attributes(global_state.get_src(this.properties.vs), \"vertex\");\n        let json = JSON.parse(str);\n        // console.log(str);\n        for (var i = 0; i < json.attributes.length - 1; i++) {\n          let attrib = json.attributes[i];\n          this.properties.attributes.push({ name: attrib.name, type: attrib.type });\n        }\n        for (var i = 0; i < json.uniforms.length - 1; i++) {\n          let uniform = json.uniforms[i];\n          if (uniform_set.has(uniform.name))\n            continue;\n          // names starting with '_' are builtins\n          if (uniform.name[0] == \"_\")\n            continue;\n          uniform_set.add(uniform.name);\n          this.properties.uniforms.push({ name: uniform.name, type: uniform.type });\n        }\n        // ps uniform parsing\n        {\n          let str = window.glslang.parse_attributes(global_state.get_src(this.properties.ps), \"fragment\");\n          let json = JSON.parse(str);\n          // console.log(str);\n          for (var i = 0; i < json.uniforms.length - 1; i++) {\n            let uniform = json.uniforms[i];\n            if (uniform_set.has(uniform.name))\n              continue;\n            // names starting with '_' are builtins\n            if (uniform.name[0] == \"_\")\n              continue;\n            uniform_set.add(uniform.name);\n            this.properties.uniforms.push({ name: uniform.name, type: uniform.type });\n          }\n        }\n        this.valid = true;\n      } catch (e) {\n        console.log(e);\n        return null;\n      }\n    }\n  }\n\n  onSelected() {\n  }\n\n  onDeselected() {\n  }\n\n}\n\nclass VertexBufferNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Vertex Buffer\";\n    this.properties = {\n      src: null\n    };\n    global_state.on_src_change((src_name) => {\n      if (src_name == this.properties.src) {\n        this.set_dirty();\n      }\n    });\n    global_state.exec_after('remove_src', (cmd) => {\n      if (cmd.src_name == this.properties.src) {\n        this.set_src(null);\n      }\n    });\n    this.buf = { attributes: {} };\n    this.set_dirty();\n    this.addOutput(\"mesh\", \"mesh_t\");\n  }\n\n  display = (propnode) => {\n    let src_list = [];\n    let datgui_state = {\n      src: this.properties.src,\n    };\n    Object.keys(global_state.litegraph.config.srcs).forEach(e => src_list.push(e));\n    propnode.datgui.add(datgui_state, 'src', src_list)\n      .onChange((v) => this.set_src(v));\n    let folder = propnode.datgui.addFolder(\"Attributes\");\n    if (this.buf) {\n      for (let i in this.buf.attributes) {\n        let tmp = {\n          prop: () => { },\n        };\n        folder.add(tmp, \"prop\").name(i);\n      }\n    }\n    folder.open();\n  }\n\n  set_src = (name) => {\n    this.properties.src = name;\n    this.set_dirty();\n  }\n\n  get_meshes = () => {\n    return [this.mesh];\n  }\n\n  parse_src = () => {\n    if (!this.properties.src) {\n      return;\n    }\n    let text = global_state.get_src(this.properties.src);\n    if (!text) {\n      this.properties.src = null;\n      return;\n    }\n    try {\n      let json = JSON.parse(text);\n      assert(json);\n      assert(json.attributes);\n      let mesh = new Mesh();\n      mesh.init(json.attributes, json.indices);\n      this.mesh = mesh;\n    } catch (e) {\n      console.log(e);\n      this.mesh = null;\n    }\n  }\n\n  update = () => {\n    this.parse_src();\n  }\n}\n\nclass TextureBufferNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Texture Buffer\";\n    this.properties = {\n      src: null\n    };\n    this.properties = {\n      src: null\n    };\n    global_state.on_src_change((src_name) => {\n      if (src_name == this.properties.src) {\n        this.set_dirty();\n      }\n    });\n    global_state.exec_after('remove_src', (cmd) => {\n      if (cmd.src_name == this.properties.src) {\n        this.set_src(null);\n      }\n    });\n    this.buf = {};\n    this.thumbnail = null;\n    this.set_dirty();\n  }\n\n  display = (propnode) => {\n    let src_list = [];\n    let datgui_state = {\n      src: this.properties.src,\n    };\n    Object.keys(global_state.litegraph.config.srcs).forEach(e => src_list.push(e));\n    propnode.datgui.add(datgui_state, 'src', src_list)\n      .onChange((v) => this.set_src(v));\n  }\n\n  set_src = (name) => {\n    this.properties.src = name;\n    this.set_dirty();\n  }\n\n  get_buffer = (slot) => {\n    return this.buf;\n  }\n\n  parse_src = () => {\n    if (!this.properties.src) {\n      this.clean_outputs();\n      return;\n    }\n    let text = global_state.get_src(this.properties.src);\n    if (!text) {\n      this.properties.src = null;\n      this.clean_outputs();\n      return;\n    }\n    try {\n      let json = JSON.parse(text);\n      assert(json);\n      assert(json.data && json.format && json.width && json.height);\n      let new_outputs = new Set();\n      new_outputs.add(\"uniform_t texture\");\n      this.set_outputs(new_outputs);\n      this.buf = json;\n    } catch (e) {\n      console.error(\"Error while parsing json\");\n      console.error(e);\n    }\n  }\n\n  get_texture = (loc) => {\n    return this.gl.texture;\n  }\n\n  gl_init = (gl) => {\n    var texture = gl.createTexture();\n    this.gl = {};\n    this.gl.texture = texture;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    const level = 0;\n    var internalFormat = gl.RGBA32F;\n    const width = this.buf.width;\n    const height = this.buf.height;\n    const border = 0;\n    var format = gl.RGBA;\n    var type = gl.FLOAT;\n    var data = null;\n    switch (this.buf.format) {\n      case \"RGBA32F\": {\n        type = gl.FLOAT;\n        internalFormat = gl.RGBA32F;\n        format = gl.RGBA;\n        data = new Float32Array(this.buf.data);\n      }\n        break;\n      case \"RGBA32UI\": {\n        type = gl.UNSIGNED_INT;\n        internalFormat = gl.RGBA32UI;\n        format = gl.RGBA_INTEGER;\n        data = new Uint32Array(this.buf.data);\n      }\n        break;\n      default: throw Error('Unsupported format. Please add!');\n    };\n    // console.log(data);\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border,\n      format, type, data);\n\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_BASE_LEVEL, 0);\n    // gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAX_LEVEL, Math.log2(width));\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    // gl.generateMipmap(gl.TEXTURE_2D);\n\n  }\n\n  gl_release = (gl) => {\n    if (this.gl && this.gl.texture)\n      gl.deleteTexture(this.gl.texture);\n    delete this.gl;\n  }\n\n  update = () => {\n    this.parse_src();\n    this.update_thumbnails(global_state.gl);\n  }\n\n  update_thumbnails = (gl) => {\n    this.thumbnail = null;\n    if (!this.buf.data)\n      return;\n    this.gl_init(gl);\n    let image_data = global_state.get_texture_data(this.gl.texture, this.buf.format);\n    this.gl_release(gl);\n    let tmp_canvas = document.createElement(\"canvas\");\n    let tmp_canvasContext = tmp_canvas.getContext(\"2d\");\n    tmp_canvas.width = image_data.width;\n    tmp_canvas.height = image_data.height;\n    tmp_canvasContext.putImageData(image_data, 0, 0);\n    var img = document.createElement(\"img\");\n    img.src = tmp_canvas.toDataURL(\"image/png\");\n    this.thumbnail = img;\n    global_state.update_thumbnails();\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n    var yoffset = 16;\n    var xoffset = 16;\n    var border = 16;\n    var size = this.size[0] - border * 2;\n    if (this.thumbnail) {\n      ctx.drawImage(this.thumbnail, xoffset, yoffset, size, size);\n    } else {\n      ctx.fillRect(xoffset, yoffset, size, size);\n    }\n    this.size[1] = size + border * 2;\n  }\n\n}\n\nclass DrawCallNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.addOutput(\"out\", \"drawcall_t\");\n    this.addInput(\"pipeline\", \"pipeline_t\");\n    this.addInput(\"mesh\", \"mesh_t\");\n    this.title = \"Draw Call\";\n    this.attributes = [];\n    this.uniforms = [];\n    this.onConnectionsChange = (c_type, target_slot, flag, link_info, input) => {\n      // if (input.type == \"pipeline_t\") {\n      this.set_dirty();\n      // } else {\n      // return false;\n      // }\n    };\n    // this.onConnectInput = (target_slot, output_type, output) => {\n    //   if (output_type == \"pipeline_t\") {\n    //     return true;\n    //   } else {\n    //     if ()\n    //     return false;\n    //   }\n    // };\n  }\n\n  update_inputs = () => {\n    let pipeline = this.getInputNodeByName(\"pipeline\");\n    var sat = new Set();\n\n    if (pipeline) {\n      let pipeline_info = pipeline.get_info();\n      if (!pipeline_info.valid)\n        return;\n      this.attributes = pipeline_info.attributes;\n      this.uniforms = pipeline_info.uniforms;\n      this.uniforms.forEach(a => sat.add(\"uniform_t \" + a.name));\n      if (this.properties.default_uniforms) {\n        let to_remove = [];\n        Object.keys(this.properties.default_uniforms).forEach(uni_name => {\n          if (!sat.has(\"uniform_t \" + uni_name))\n            to_remove.push(uni_name);\n        });\n        to_remove.forEach(uni_name => {\n          console.log(\"[INFO] Found stale default value for \" + uni_name);\n          delete this.properties.default_uniforms[uni_name]\n        }\n        );\n      }\n    }\n    sat.add(\"pipeline_t pipeline\");\n    sat.add(\"mesh_t mesh\");\n    this.set_inputs(sat);\n  }\n\n  gl_init = (gl) => {\n    let pipeline = this.getInputNodeByName(\"pipeline\");\n    if (pipeline == null)\n      return;\n    let mesh_input = this.getInputNodeByName(\"mesh\");\n    if (!mesh_input)\n      return;\n    this.gl = {};\n    this.gl.arrays = [];\n    this.gl.buffers = [];\n    let meshes = mesh_input.get_meshes();\n    meshes.forEach(mesh => {\n      let arr = gl.createVertexArray();\n      this.gl.arrays.push(arr);\n      gl.bindVertexArray(arr);\n\n      for (let i in this.attributes) {\n        let attrib = this.attributes[i];\n        let out_attrib = mesh.get_attrib_data(attrib.name);\n        if (!out_attrib)\n          continue;\n        assert(out_attrib.type == attrib.type);\n        let data = out_attrib.data;\n        var gl_buffer = gl.createBuffer();\n        this.gl.buffers.push(gl_buffer);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl_buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n        let loc = pipeline.get_attrib_location(gl, attrib.name);\n        if (loc < 0)\n          continue;\n        var comps = -1;\n        switch (attrib.type) {\n          case \"vec2\":\n            comps = 2;\n            break;\n          case \"vec3\":\n            comps = 3;\n            break;\n          default:\n            throw Error(\"unrecognized type\");\n        };\n        gl.vertexAttribPointer(loc, comps, gl.FLOAT, false, 0, 0);\n        gl.enableVertexAttribArray(loc);\n      }\n      arr.draw_size = 3;\n      {\n        let buf = mesh.get_index_data();\n        assert(\"data\" in buf);\n        const indexBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n        this.gl.buffers.push(indexBuffer);\n        assert(buf.type == \"uint16\");\n        gl.bufferData(\n          gl.ELEMENT_ARRAY_BUFFER,\n          new Uint16Array(buf.data),\n          gl.STATIC_DRAW\n        );\n        arr.draw_size = buf.data.length;\n\n      }\n      arr.index_type = gl.UNSIGNED_SHORT;\n    });\n  }\n\n  display = (propnode) => {\n    if (this.uniforms) {\n      let datgui_state = {\n      };\n      let new_rt = propnode.datgui.addFolder(\"Uniforms\");\n      let add_vec = (name, comps) => {\n        let strs = [\".x\", \".y\", \".z\", \".w\"];\n        if (!(\"default_uniforms\" in this.properties)) {\n          this.properties[\"default_uniforms\"] = {};\n        }\n        if (!(name in this.properties.default_uniforms)) {\n          this.properties.default_uniforms[name] = [];\n        }\n        if (this.properties.default_uniforms[name].length != comps) {\n          this.properties.default_uniforms[name] = new Array(comps).fill(0.0);;\n        }\n        for (var i = 0; i < comps; i++) {\n          let id = i;\n          datgui_state[name + strs[i]] = this.properties.default_uniforms[name][i];\n          new_rt.add(datgui_state, name + strs[i]).step(0.05)\n            .onChange(v => this.properties.default_uniforms[name][id] = v);\n        }\n      };\n      this.uniforms.forEach(uni => {\n        switch (uni.type) {\n          case \"float\":\n            add_vec(uni.name, 1);\n            break;\n          case \"vec2\":\n            add_vec(uni.name, 2);\n            break;\n          case \"vec3\":\n            add_vec(uni.name, 3);\n            break;\n        };\n      });\n\n      new_rt.open();\n    }\n  }\n\n  gl_draw = (gl) => {\n    let pipeline = this.getInputNodeByName(\"pipeline\");\n    if (pipeline == null)\n      return;\n    pipeline.bind(gl);\n    var tu_cnt = 0;\n    // builtins\n    {\n      let loc = pipeline.get_uniform_location(gl, \"_resolution\");\n\n      if (loc) {\n        let viewport = gl.getParameter(gl.VIEWPORT);\n        gl.uniform2fv(loc, [viewport[2] - viewport[0], viewport[3] - viewport[1]]);\n      }\n    }\n    for (let i in this.uniforms) {\n      let uni = this.uniforms[i];\n      let loc = pipeline.get_uniform_location(gl, uni.name);\n      if (!loc)\n        continue;\n      let tu = tu_cnt;\n      if (uni.type == \"texture\") {\n        gl.activeTexture(gl.TEXTURE0 + tu);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        gl.uniform1i(loc, tu);\n        tu_cnt += 1;\n      }\n      let input = this.getInputNodeByName(uni.name);\n      if (!input)\n        continue;\n      let input_link = this.getInputLinkByName(uni.name);\n      if (uni.type == \"texture\") {\n        let texture = input.get_texture(input_link.origin_slot);\n        gl.activeTexture(gl.TEXTURE0 + tu);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.uniform1i(loc, tu);\n      } else {\n        let val = input.get_value(input_link.origin_slot);\n        switch (uni.type) {\n          case \"int\":\n            gl.uniform1i(loc, val);\n            break;\n          default:\n            throw Error(\"Unimplemented\");\n        };\n      }\n    }\n    this.gl.arrays.forEach(arr => {\n      gl.bindVertexArray(arr);\n\n      gl.drawElements(gl.TRIANGLES, arr.draw_size, arr.index_type, 0);\n    });\n\n\n  }\n\n  gl_release = (gl) => {\n    this.gl.buffers.forEach(buf => gl.deleteBuffer(buf));\n    this.gl.arrays.forEach(buf => gl.deleteVertexArray(buf));\n    delete this.gl;\n  }\n\n  update = () => {\n    this.update_inputs();\n  }\n\n  onSelected() {\n  }\n\n  onDeselected() {\n  }\n\n}\n\nclass FeedbackNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.title = \"Feedback\";\n    this.addInput(\"in\", \"uniform_t\");\n    this.addOutput(\"out\", \"uniform_t\");\n    this.gl = { tex: null };\n    this.addWidget(\"button\", \"reset\", null, (v) => { this.reset(); }, {});\n  }\n  reset = () => {\n    let gl = global_state.gl;\n    if (this.gl.tex)\n      gl.deleteTexture(this.gl.tex);\n    this.gl.tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this.gl.tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, 1, 1);\n  }\n  is_recursive = () => true;\n  get_texture = () => {\n    if (!this.gl.tex) {\n      this.reset();\n    }\n    return this.gl.tex;\n  }\n  gl_render = (gl) => {\n    if (this.gl.tex)\n      gl.deleteTexture(this.gl.tex);\n    this.gl = { tex: null };\n    let input_link = this.getInputLinkByName(\"in\");\n    if (!input_link)\n      return;\n    this.gl.tex = this.getInputNodeByName(\"in\").clone_texture(input_link.origin_slot);\n  }\n}\n\nclass PassNode extends MyLGraphNode {\n  constructor() {\n    super();\n    this.button = this.addWidget(\"button\", \"Add DC\", null, (v) => { this.addDC(); }, {});\n    this.title = \"Pass\";\n    this.properties = {\n      viewport: { width: 512, height: 512 },\n      rts: [],\n      depth: null,\n      dc_cnt: 0,\n    };\n    this.yoffset = 100;\n    this.onPropertyChange = (prop, val) => {\n      this.update_outputs();\n    };\n  }\n\n  gl_render = (gl) => {\n    this.bind(gl);\n    this.inputs.forEach(input => {\n\n      if (input.type == \"drawcall_t\") {\n        let link = global_state.litegraph.links[input.link];\n        if (!link)\n          return;\n        let dc = global_state.litegraph.getNodeById(link.origin_id);\n        // console.log(dc);\n        dc.gl_draw(gl);\n      }\n    });\n    this.update_thumbnails(gl);\n  }\n\n  clear_outputs = () => {\n    let len = this.outputs.length;\n    for (let i = len - 1; i >= 0; i--) {\n      this.removeOutput(i);\n    }\n    this.properties.dc_cnt = 0;\n  }\n\n  update_outputs = () => {\n    this.clear_outputs();\n    for (let i = 0; i < this.properties.rts.length; ++i) {\n      this.addOutput(\"rt#\" + i, \"uniform_t\");\n    }\n    if (this.properties.depth != null) {\n      this.addOutput(\"depth\", \"uniform_t\");\n    }\n  }\n\n  push_rt = (params) => {\n    let rt_params = {};\n    rt_params.format = params.format;\n    this.properties.rts.push(rt_params)\n    this.update_outputs();\n  }\n\n  pop_rt = () => {\n    // for (let i = this.properties.rts.length - 1; i >= 0; i--) {\n    //   delete this.properties.rts[i];\n    //   break;\n    // }\n    if (this.properties.rts.length == 0)\n      return;\n    this.properties.rts.pop();\n    this.update_outputs();\n  }\n\n  add_depth = (params) => {\n    if (this.properties.depth != null)\n      return;\n    let d_params = {};\n    d_params.format = params.format;\n    this.properties.depth = d_params;\n    this.update_outputs();\n  }\n\n  remove_depth = () => {\n    if (this.properties.depth == null)\n      return;\n    this.properties.depth = null;\n    this.update_outputs();\n  }\n\n  set_width = (width) => {\n    this.properties.viewport.width = width;\n  }\n\n  set_height = (height) => {\n    this.properties.viewport.height = height;\n  }\n\n  onExecute() {\n    // var A = this.getInputData(0);\n    // if (A === undefined)\n    //   A = 0;\n    // var B = this.getInputData(1);\n    // if (B === undefined)\n    //   B = 0;\n    // this.setOutputData(0, \"texture_0\");\n  }\n\n  gl_init = (gl) => {\n    this.gl = { fb: null, rts: [] };\n    this.gl.fb = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.gl.fb);\n    assert(this.properties.rts.length != 0 || this.properties.depth != null);\n    this.draw_buffers = [];\n    this.gl.rts = [];\n    for (let i = 0; i < this.properties.rts.length; ++i) {\n      const tex = this.gen_texture(gl, i);\n      this.gl.rts.push(tex);\n      this.draw_buffers.push(gl.COLOR_ATTACHMENT0 + i);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i, gl.TEXTURE_2D, tex, 0);\n    }\n\n    if (this.properties.depth != null) {\n      const tex = this.gen_texture(gl, this.properties.rts.length);\n      this.gl.depth = tex;\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, tex, 0);\n    }\n    var status = gl.checkFramebufferStatus(gl.DRAW_FRAMEBUFFER);\n    if (status != gl.FRAMEBUFFER_COMPLETE) {\n      throw Error('fb status: ' + status.toString(16));\n    }\n  }\n\n  clone_texture = (id) => {\n    let gl = global_state.gl;\n    // create to render to\n    const targetTextureWidth = this.properties.viewport.width;\n    const targetTextureHeight = this.properties.viewport.height;\n    const targetTexture = this.gen_texture(gl, id);\n    const srcTexture = this.get_texture(id);\n    // Create and bind the framebuffer\n    const fb = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, targetTexture, 0);\n\n    gl.disable(gl.CULL_FACE);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.DEPTH_TEST);\n    gl.disable(gl.SCISSOR_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.blendFunc(gl.ONE, gl.ONE);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n    gl.drawBuffers([gl.COLOR_ATTACHMENT0]);\n    gl.viewport(0, 0, targetTextureWidth, targetTextureHeight);\n    gl.clearColor(0, 0, 1, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    global_state.render_texture(srcTexture);\n\n    gl.deleteFramebuffer(fb);\n    return targetTexture;\n  }\n\n  gen_texture = (gl, id) => {\n    if (id >= this.properties.rts.length) {\n      let rt = this.properties.depth;\n      const tex = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, tex);\n      var format = null;\n\n      switch (rt.format) {\n        case \"D16\": {\n          format = gl.DEPTH_COMPONENT16;\n        }\n          break;\n        case \"D32\": {\n          format = gl.DEPTH_COMPONENT32F;\n        }\n          break;\n        default:\n          throw Error(\"unknown format\");\n      }\n      // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n      gl.texStorage2D(gl.TEXTURE_2D, 1, format,\n        this.properties.viewport.width, this.properties.viewport.height);\n      return tex;\n    } else {\n      let rt = this.properties.rts[id];\n      const tex = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, tex);\n      var format = null;\n      switch (rt.format) {\n        case \"RGBA8\": {\n          format = gl.RGBA8;\n        }\n          break;\n        case \"RGBA32F\": {\n          format = gl.RGBA32F;\n        }\n          break;\n        default:\n          throw Error(\"unknown format\");\n      }\n      // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n      gl.texStorage2D(gl.TEXTURE_2D, 1, format,\n        this.properties.viewport.width, this.properties.viewport.height);\n      return tex;\n    }\n  }\n\n  get_texture = (id) => {\n    if (id >= this.properties.rts.length)\n      return this.gl.depth;\n    return this.gl.rts[id];\n  }\n\n  bind = (gl) => {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.gl.fb);\n    gl.drawBuffers(this.draw_buffers);\n    gl.viewport(0, 0, this.properties.viewport.width, this.properties.viewport.height);\n    gl.clearColor(0, 0, 0, 1);\n    gl.clearDepth(1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  }\n\n  update_thumbnails = (gl) => {\n    this.thumbnails = [];\n    let rts = [...this.gl.rts];\n    if (this.gl.depth)\n      rts.push(this.gl.depth);\n    for (let i in rts) {\n      let image_data = global_state.get_texture_data(rts[i]);\n\n      let tmp_canvas = document.createElement(\"canvas\");\n      let tmp_canvasContext = tmp_canvas.getContext(\"2d\");\n      tmp_canvas.width = image_data.width;\n      tmp_canvas.height = image_data.height;\n      tmp_canvasContext.putImageData(image_data, 0, 0);\n      var img = document.createElement(\"img\");\n      img.src = tmp_canvas.toDataURL(\"image/png\");\n      img.onload = () => { global_state.update_thumbnails() };\n      this.thumbnails.push(img);\n    }\n    if (this.gl.depth)\n      this.depth_thumbnail = this.thumbnails[this.thumbnails.length - 1];\n    global_state.update_thumbnails();\n  }\n\n  gl_release = (gl) => {\n    if (!(\"gl\" in this))\n      return;\n    if (this.gl.vfbs != null) gl.deleteFramebuffer(this.gl.fb);\n    for (let i = 0; i < this.gl.rts.length; ++i) {\n      let tex = this.gl.rts[i];\n      gl.deleteTexture(tex);\n    }\n    if (this.gl.depth)\n      gl.deleteTexture(this.gl.depth);\n    delete this.gl;\n  }\n\n  display = (propnode) => {\n\n    let tmp_rt_state = {\n      format: \"RGBA8\",\n    };\n    let tmp_d_state = {\n      format: \"D16\",\n    };\n    let datgui_state = {\n      width: this.properties.viewport.width,\n      height: this.properties.viewport.height,\n      push: () => {\n        this.push_rt(tmp_rt_state);\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n      pop: () => {\n        this.pop_rt();\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n      add_depth: () => {\n        this.add_depth(tmp_d_state);\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n      remove_depth: () => {\n        this.remove_depth();\n        propnode.clear_gui();\n        propnode.display_node(this);\n      },\n    };\n    let rts = propnode.datgui.addFolder(\"Render targets\");\n    for (let i in this.properties.rts) {\n      let rt = this.properties.rts[i];\n      let rt_state = {\n        format: rt.format,\n      };\n      rts.add(rt_state, 'format');\n    }\n    if (this.properties.depth != null) {\n      let rt_state = {\n        format: this.properties.depth.format,\n      };\n      rts.add(rt_state, 'format');\n    }\n    rts.open();\n    let new_rt = propnode.datgui.addFolder(\"Add render target\");\n    new_rt.add(tmp_rt_state, 'format', [\"RGBA8\", \"RGBA32F\"]);\n    new_rt.add(datgui_state, 'push');\n    new_rt.add(datgui_state, 'pop');\n    new_rt.open();\n    let new_d = propnode.datgui.addFolder(\"Add depth target\");\n    new_d.add(tmp_d_state, 'format', [\"D16\", \"D32\"]);\n    new_d.add(datgui_state, 'add_depth');\n    new_d.add(datgui_state, 'remove_depth');\n    new_d.open();\n    let vp = propnode.datgui.addFolder(\"Viewport\");\n    vp.add(datgui_state, 'width', 128, 1024 * 2, 16).onChange((v) => this.set_width(v));;\n    vp.add(datgui_state, 'height', 128, 1024 * 2, 16).onChange((v) => this.set_height(v));;\n    vp.open();\n\n    // this.datgui.add(this.datgui_state, 'select_vs', this.src_list)\n    //   .onChange((v) => pipeline.set_vs(v));\n    // this.datgui.add(this.datgui_state, 'select_ps', this.src_list)\n    //   .onChange((v) => pipeline.set_ps(v));\n\n  }\n\n  onDrawBackground(ctx) {\n    if (this.flags.collapsed) {\n      return;\n    }\n\n    ctx.fillStyle = \"#000\";\n    var yoffset = 32 + this.inputs.length * 20;\n    var xoffset = 16;\n    var border = 16;\n    var size = this.size[0] - border * 2;;\n    for (let i in this.properties.rts) {\n      if (\"thumbnails\" in this && i < this.thumbnails.length) {\n        ctx.drawImage(this.thumbnails[i], xoffset, yoffset, size, size);\n\n      } else {\n        ctx.fillRect(xoffset, yoffset, size, size);\n      }\n      yoffset += size + border;\n    }\n    if (this.properties.depth != null) {\n      if (\"depth_thumbnail\" in this) {\n        ctx.drawImage(this.depth_thumbnail, xoffset, yoffset, size, size);\n\n      } else {\n        ctx.fillRect(xoffset, yoffset, size, size);\n      }\n      yoffset += size + border;\n    }\n    // this.size[0] = xoffset + size + border;\n    this.size[1] = yoffset;\n    // ctx.fillRect(0, 0, size[0], size[1]);\n    ctx.strokeStyle = \"#555\";\n\n\n  }\n\n\n\n  addDC() {\n    this.addInput(\"DC#\" + this.properties.dc_cnt, \"drawcall_t\");\n    this.properties.dc_cnt += 1;\n  }\n\n  onMouseDown(e, local_pos) {\n\n    // this.addOutput(\"A-B\", \"number\");\n  }\n\n}\n\nclass GraphNodeComponent extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.graph = global_state.litegraph;\n    this.onResize = this.onResize.bind(this);\n    this.dumpJson = this.dumpJson.bind(this);\n  }\n\n  componentDidMount() {\n\n    global_state.litegraph_canvas = new LGraphCanvas(\"#tmp_canvas\", this.graph);\n    global_state._selected_nodes = {};\n    global_state.litegraph_canvas.onSelectionChange = (\n      nodes\n    ) => {\n      // console.log(\"selection changed to\"); console.log(nodes);\n      let new_selected = [];\n      let new_deselected = [];\n      for (let i in nodes) {\n        let node = nodes[i];\n        if (!(node.id in global_state._selected_nodes)) {\n          new_selected.push(node);\n        }\n      }\n      for (let i in global_state._selected_nodes) {\n        let node = global_state._selected_nodes[i];\n        if (!(node.id in nodes)) {\n          new_deselected.push(node);\n        }\n      }\n      global_state._selected_nodes = { ...nodes };\n      // console.log(\"new_selected\"); console.log(new_selected);\n      // console.log(\"new_deselected\"); console.log(new_deselected);\n      global_state.exec_selected(new_selected);\n      global_state.exec_deselected(new_deselected);\n    };\n    // global_state.litegraph_canvas.onNodeSelected = (\n    //   node\n    // ) => {\n    //   console.log(\"selected\" + node);\n    //   global_state.exec_selected([node]);\n    // };\n\n    // global_state.litegraph_canvas.onNodeDeselected = (\n    //   node\n    // ) => {\n    //   console.log(\"deselected\" + node);\n    //   global_state.exec_deselected([node]);\n    // };\n\n\n    this.graph.start();\n\n    this.props.glContainer.on('resize', this.onResize);\n    global_state.litegraph_canvas.resize();\n\n    // Register nodesw\n    LiteGraph.registerNodeType(\"gfx/PassNode\", PassNode);\n    LiteGraph.registerNodeType(\"gfx/BackBufferNode\", BackBufferNode);\n    LiteGraph.registerNodeType(\"gfx/DrawCallNode\", DrawCallNode);\n    LiteGraph.registerNodeType(\"gfx/PipelineNode\", PipelineNode);\n    LiteGraph.registerNodeType(\"gfx/VertexBufferNode\", VertexBufferNode);\n    LiteGraph.registerNodeType(\"gfx/ModelNode\", ModelNode);\n    LiteGraph.registerNodeType(\"gfx/TextureBufferNode\", TextureBufferNode);\n    LiteGraph.registerNodeType(\"gfx/FeedbackNode\", FeedbackNode);\n    LiteGraph.registerNodeType(\"gfx/FrameCountNode\", FrameCountNode);\n    // Load default json scene\n    fetch('default_graph.json')\n      .then(response => response.text())\n      .then(text => {\n        init_litegraph(JSON.parse(text));\n      });\n    this.onResize();\n    window.addEventListener('message', event => {\n      try {\n        let json = JSON.parse(event.data);\n        if (\"type\" in json) {\n          if (json.type == \"set(graph.json)\") {\n            let graph_json =  JSON.parse(json.data);\n            init_litegraph(graph_json);\n          } else if (json.type == \"get(graph.json)\") {\n            let json = this.graph.serialize();\n            let str = JSON.stringify(json)\n            let msg = {};\n            msg.data = str;\n            msg.type = \"graph.json\";\n            if (window.parent != window)\n              window.parent.postMessage(JSON.stringify(msg), '*');\n          } else\n            console.log(\"unrecoginez command type: \" + json.type);\n        } else\n          console.log(\"unrecoginez command: \" + event);\n      } catch (e) {\n\n      }\n\n    });\n  }\n\n  onResize = () => {\n    let parent = document.getElementById(\"tmp_canvas_container\");\n    global_state.litegraph_canvas.resize(parent.offsetWidth, parent.offsetHeight - 70);\n  }\n\n  dumpJson() {\n   \n    // console.log();\n    // https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript?page=1&tab=votes#tab-top\n    function copyTextToClipboard(text) {\n      var textArea = document.createElement(\"textarea\");\n      textArea.style.position = 'fixed';\n      textArea.style.top = 0;\n      textArea.style.left = 0;\n      textArea.style.width = '2em';\n      textArea.style.height = '2em';\n      textArea.style.padding = 0;\n      textArea.style.border = 'none';\n      textArea.style.outline = 'none';\n      textArea.style.boxShadow = 'none';\n      textArea.style.background = 'transparent';\n      textArea.value = text;\n      document.body.appendChild(textArea);\n      textArea.focus();\n      textArea.select();\n      try {\n        var successful = document.execCommand('copy');\n        var msg = successful ? 'successful' : 'unsuccessful';\n        console.log('Copying text command was ' + msg);\n      } catch (err) {\n        console.log('Oops, unable to copy');\n      }\n\n      document.body.removeChild(textArea);\n    }\n    let json = this.graph.serialize();\n    let str = JSON.stringify(json)\n    // let msg = {};\n    // msg.data = str;\n    // msg.type = \"graph.json\";\n    // if (window.parent != window)\n    //   window.parent.postMessage(JSON.stringify(msg), '*');\n    copyTextToClipboard(str);\n\n  }\n\n  render() {\n\n    return (\n      <div style={{ width: '100%', height: '100%' }} id=\"tmp_canvas_container\">\n        <Button style={{ margin: 10 }} onClick={this.dumpJson}>\n          Copy to clipboard\n                </Button>\n        <Button style={{ margin: 10 }} onClick={() => { console.log(global_state.litegraph_canvas.selected_nodes); }}>\n          Dump Selected\n                </Button>\n        <Button variant=\"danger\" style={{ margin: 10 }} onClick={() => { global_state.exec_reset(); }}>\n          Clear\n                </Button>\n\n        <Button style={{ margin: 10 }} onClick={() => {\n          // console.log(global_state.toposort());\n          global_state.draw();\n        }} variant=\"success\" >\n          Next Frame\n                </Button>\n        <LoadGraphButton />\n        <canvas id='tmp_canvas' style={{ border: '1px solid' }}></canvas>\n      </div>\n    );\n  }\n}\n\n{/* <Button style={{ margin: 10 }} onClick={() => { global_state.update(); }}>\nforce update\n      </Button>\n<Button style={{ margin: 10 }} onClick={() => { global_state.reload(); }}>\nforce reload\n      </Button> */}\n\n// A button that spawns a modal window with text input and submit button\n// @TODO: validation\nclass CreateSrc extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = { visible: false };\n    this.myInput = { value: \"\" };\n  }\n  setShow = (vis) => {\n    this.setState({ visible: vis });\n  }\n  handleClose = () => this.setShow(false);\n  handleShow = () => this.setShow(true);\n  handleApply = () => {\n    // console.log(this.myInput.value);\n    this.props.on_submit(this.myInput.value);\n    this.setShow(false);\n  }\n  render() {\n    return (\n      <>\n        <Button variant=\"primary\" onClick={this.handleShow}>\n          New Source\n      </Button>\n\n        <Modal show={this.state.visible} onHide={this.handleClose}>\n          <Modal.Header closeButton>\n            <Modal.Title>Enter name</Modal.Title>\n          </Modal.Header>\n          <FormControl type=\"text\" placeholder=\"source name\" onChange={e => this.myInput.value = e.target.value} />\n          <Modal.Footer>\n            <Button variant=\"secondary\" onClick={this.handleClose}>\n              Cancel\n          </Button>\n            <Button variant=\"primary\" onClick={() => this.handleApply()}>\n              Create\n          </Button>\n          </Modal.Footer>\n        </Modal>\n      </>\n    );\n  }\n}\n\nclass TextEditorComponent extends React.Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.onChange = this.onChange.bind(this);\n    this.onResize = this.onResize.bind(this);\n    this.selected_src = null;\n    global_state.exec_after('remove_src', (cmd) => {\n      // console.log(cmd);\n      if (cmd.src_name == this.selected_src) {\n        this.edit_src(null);\n        this.rebuildGui();\n      }\n    });\n    global_state.on_reset(() => {\n      this.edit_src(null);\n      this.rebuildGui();\n    });\n\n  }\n\n  rebuildGui = () => {\n    this.datgui = new dat.GUI({ autoPlace: false });\n    this.src_list = [];\n    this.datgui_state = {\n      select_src: this.selected_src,\n      remove_src: () => { this.remove_src(); },\n    };\n    if (\"srcs\" in global_state.litegraph.config)\n      Object.keys(global_state.litegraph.config.srcs).forEach(e => this.src_list.push(e));\n    this.datgui.src_list = this.datgui.add(this.datgui_state, 'select_src', this.src_list)\n      .onChange((v) => this.edit_src(v));\n    this.datgui.add(this.datgui_state, 'remove_src');\n\n    var customContainer = document.getElementById('teditor_gui_container');\n    var child = customContainer.lastElementChild;\n    while (child) {\n      customContainer.removeChild(child);\n      child = customContainer.lastElementChild;\n    }\n    customContainer.appendChild(this.datgui.domElement);\n  }\n\n  componentDidMount() {\n    this.props.glContainer.on('resize', this.onResize);\n    this.edit_src(null);\n    this.rebuildGui();\n    // ace.require(\"ace/ext/language_tools\");\n\n  }\n\n  edit_src = (name) => {\n    if (name == null) {\n      this.selected_src = null;\n      this.refs.editor.editor.setValue(\"\");\n      return;\n    }\n    assert(name in global_state.litegraph.config.srcs);\n    this.selected_src = name;\n    this.refs.editor.editor.setValue(global_state.litegraph.config.srcs[name].code);\n    this.refs.editor.editor.setOptions({\n      // fontFamily: \"Consolas\",\n      // enableSnippets: true,\n      // enableBasicAutocompletion: true,\n      // enableLiveAutocompletion: true,\n      fontSize: \"8pt\"\n    });\n    this.refs.editor.editor.setAutoScrollEditorIntoView(true);\n    this.refs.editor.editor.getSession().setOptions({\n      tabSize: 2,\n      useSoftTabs: true,\n      navigateWithinSoftTabs: true\n\n    });\n  }\n\n  add_src = (name) => {\n    global_state.exec({ type: 'add_src', src_name: name });\n    this.edit_src(name);\n    this.rebuildGui();\n\n  }\n\n  remove_src = () => {\n    if (this.selected_src == null)\n      return;\n    global_state.exec({ type: 'remove_src', src_name: this.selected_src });\n\n  }\n\n  onChange(newValue) {\n    if (this.selected_src == null)\n      return;\n    global_state.set_src(this.selected_src, newValue);\n  }\n\n  onResize() {\n    this.refs.editor.editor.resize();\n  }\n\n  render() {\n\n    return (\n      <div className=\"ace_editor_container\">\n        <CreateSrc on_submit={(name) => this.add_src(name)} />\n        <div id=\"teditor_gui_container\">\n\n        </div>\n        <AceEditor\n          value={this.text}\n          ref=\"editor\"\n          mode=\"glsl\"\n          theme=\"tomorrow_night_eighties\"\n          onChange={this.onChange}\n          name=\"UNIQUE_ID_OF_DIV\"\n          editorProps={{\n            $blockScrolling: true\n          }}\n          enableBasicAutocompletion={true}\n          enableLiveAutocompletion={true}\n          autoScrollEditorIntoView={false}\n          wrapEnabled={false}\n          height=\"calc(100% - 100px)\"\n          width=\"calc(100%)\"\n        />\n      </div>\n    );\n  }\n}\n\nclass PropertiesNode extends React.Component {\n\n  constructor(props, context) {\n    super(props, context);\n    this.selected_node = null;\n    global_state.exec_on_select((selected_node) => {\n      this.selected_node = selected_node;\n      this.display_node(selected_node);\n      selected_node.subscribe(this);\n    },\n      (deselected_node) => {\n        if (this.selected_node == deselected_node) {\n          this.selected_node = null;\n          this.clear_gui();\n          deselected_node.unsubscribe(this);\n        }\n      });\n    global_state.exec_after('remove_src', (cmd) => {\n      this.clear_gui();\n      this.display_node(this.selected_node);\n    });\n    global_state.exec_after('add_src', (cmd) => {\n      this.clear_gui();\n      this.display_node(this.selected_node);\n    });\n    global_state.on_reset(() => {\n      this.clear_gui();\n    });\n    this.subscribers = new Set();\n  }\n\n  subscribe = (node) => { this.subscribers.add(node) }\n  unsubscribe = (node) => { this.subscribers.delete(node) }\n  notify = () => { this.subscribers.forEach(node => { if (node.set_dirty) node.set_dirty() }) }\n  set_dirty = () => { global_state.set_dirty(this); }\n\n  update = () => {\n    this.clear_gui();\n    this.display_node(this.selected_node);\n  }\n\n  clear_gui = () => {\n    var customContainer = document.getElementById('PropertiesNodeWrapper');\n    var child = customContainer.lastElementChild;\n    while (child) {\n      customContainer.removeChild(child);\n      child = customContainer.lastElementChild;\n    }\n  }\n\n  display_node = (node) => {\n    if (node == null)\n      return;\n    this.datgui = new dat.GUI({ autoPlace: false });\n    if (\"display\" in node) {\n      node.display(this);\n    }\n    var customContainer = document.getElementById('PropertiesNodeWrapper');\n    customContainer.appendChild(this.datgui.domElement);\n    // if (this.selected_node != null) {\n    //   if (this.selected_node.type == \"gfx/PipelineNode\") {\n    //     this.display_pipeline(node);\n    //   } else if (this.selected_node.type == \"gfx/PassNode\") {\n    //     this.display_pass(node);\n    //   }\n    // }\n  }\n\n  componentDidMount() {\n\n  }\n\n  render() {\n\n    return (\n      <div id='PropertiesNodeWrapper'>\n      </div>\n    );\n  }\n}\n\nclass GoldenLayoutWrapper extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n\n  }\n\n  componentDidMount() {\n    this.globals = {};\n    // Build basic golden-layout config\n    const config = {\n      content: [{\n        type: 'row',\n        content: [\n          {\n            type: 'column',\n            content: [\n              {\n                type: 'react-component',\n                isClosable: false,\n                component: 'TextEditor',\n                title: 'Text Editor',\n\n                props: { globals: () => this.globals }\n\n\n              },\n              {\n                type: 'stack',\n                width: 84,\n                height: 40,\n                content: [\n                  {\n                    type: 'react-component',\n                    isClosable: false,\n                    component: 'PropertiesNode',\n                    title: 'Properties',\n                    props: { globals: () => this.globals }\n\n                  },\n                  {\n\n                    type: 'react-component',\n                    isClosable: false,\n                    component: 'GLW',\n                    title: 'Back Buffer',\n                    props: { globals: () => this.globals }\n\n                  },\n                ]\n              }\n            ]\n          },\n          {\n            type: 'react-component',\n            isClosable: false,\n            component: 'Graphs',\n            title: 'Graphs',\n            props: { globals: () => this.globals },\n            width: 145\n\n          },\n\n\n        ]\n      }]\n    };\n\n    var layout = new GoldenLayout(config, this.layout);\n    this.layout = layout;\n    layout.registerComponent('Graphs', GraphNodeComponent\n    );\n    layout.registerComponent('GLW', GLComponent\n    );\n    layout.registerComponent('TextEditor',\n      TextEditorComponent\n    );\n    layout.registerComponent('PropertiesNode',\n      PropertiesNode\n    );\n\n    layout.init();\n    window.React = React;\n    window.ReactDOM = ReactDOM;\n    window.addEventListener('resize', () => {\n      layout.updateSize();\n    });\n\n  }\n\n  render() {\n\n    return (\n      <div className='goldenLayout'\n        ref={input => this.layout = input} >\n      </div>\n    );\n  }\n}\n\n\nexport default GoldenLayoutWrapper;","import GoldenLayoutWrapper from './app';\nimport React, { useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\n\nReactDOM.render(\n  <GoldenLayoutWrapper />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}